import e,{useState as t,useRef as a,useEffect as n}from"react";import{startOfDay as r,endOfDay as o,differenceInDays as i,differenceInYears as s,differenceInQuarters as c,differenceInMonths as l,differenceInWeeks as u,isWithinInterval as d,format as f,getWeek as m,addDays as v,startOfQuarter as h,addQuarters as g,startOfYear as D,addYears as w}from"date-fns";var E,p,y=function(){return y=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},y.apply(this,arguments)};function M(e,t,a){if(a||2===arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}function k(e,t){return void 0===t&&(t="default"),e.toLocaleString(t,{month:"short"})}function b(e,t,a){if(void 0===t&&(t=p.FULL_DATE),void 0===a&&(a="default"),!(e instanceof Date)||isNaN(e.getTime()))return"Invalid date";switch(t){case p.MONTH_YEAR:return e.toLocaleString(a,{month:"short",year:"2-digit"});case p.SHORT_DATE:return e.toLocaleString(a,{month:"short",day:"numeric"});case p.FULL_DATE:default:return e.toLocaleString(a,{month:"short",day:"numeric",year:"numeric"})}}function x(e,t){var a=[];if(!(e instanceof Date&&t instanceof Date))return console.warn("getMonthsBetween: Invalid date parameters"),[new Date];for(var n=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),i=t.getMonth(),s=n;s<=o;s++)for(var c=s===o?i:11,l=s===n?r:0;l<=c;l++)a.push(new Date(s,l,1));return a}function T(e,t){return new Date(e,t+1,0).getDate()}function N(){return[1,8,15,22,29]}function A(e,t,a){if(!(e.startDate instanceof Date&&e.endDate instanceof Date))return console.warn("calculateTaskPosition: Invalid task dates",e),{left:"0%",width:"10%"};var n=x(new Date(t.getFullYear(),t.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)),r=n.length,o=e.startDate.getFullYear(),i=e.startDate.getMonth(),s=n.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===i})),c=s<0?0:s,l=e.endDate.getFullYear(),u=e.endDate.getMonth(),d=n.findIndex((function(e){return e.getFullYear()===l&&e.getMonth()===u})),f=((d<0?n.length-1:d)-c+1)/r*100;return{left:"".concat(c/r*100,"%"),width:"".concat(f,"%")}}function Y(e){if(!Array.isArray(e))return console.warn("detectTaskOverlaps: Invalid tasks array"),[];var t=e.filter((function(e){return e&&e.startDate instanceof Date&&e.endDate instanceof Date}));if(0===t.length)return[];var a=[];return t.forEach((function(e){for(var t=!1,n=0;n<a.length;n++){if(!a[n].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){a[n].push(e),t=!0;break}}t||a.push([e])})),a}function R(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.startDate instanceof Date&&(a?e.startDate<t&&(t=new Date(e.startDate)):(t=new Date(e.startDate),a=!0))}))})),!a){var n=new Date;return new Date(n.getFullYear(),n.getMonth()-1,1)}return new Date(t.getFullYear(),t.getMonth(),1)}function O(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.endDate instanceof Date&&(a?e.endDate>t&&(t=new Date(e.endDate)):(t=new Date(e.endDate),a=!0))}))})),!a){var n=new Date;return new Date(n.getFullYear(),n.getMonth()+2,0)}return new Date(t.getFullYear(),t.getMonth()+1,0)}function H(e,t,a){if(void 0===a&&(a="default"),!(e instanceof Date&&t instanceof Date))return"Invalid date range";var n=b(e,p.SHORT_DATE,a),r=b(t,p.SHORT_DATE,a);return"".concat(n," - ").concat(r)}function F(e,t){var a;if(!(e instanceof Date&&t instanceof Date))return 0;e>t&&(e=(a=[t,e])[0],t=a[1]);var n=Math.abs(t.getTime()-e.getTime());return Math.ceil(n/864e5)}"function"==typeof SuppressedError&&SuppressedError,function(e){e.DAY="day",e.WEEK="week",e.MONTH="month",e.QUARTER="quarter",e.YEAR="year"}(E||(E={})),function(e){e.MONTH_YEAR="month-year",e.FULL_DATE="full-date",e.SHORT_DATE="short-date"}(p||(p={}));var I=function(){function e(){}return e.detectOverlaps=function(e,t){var a=this;if(void 0===t&&(t=E.MONTH),!Array.isArray(e)||0===e.length)return[];var n=M([],e,!0).sort((function(e,t){return e.startDate&&t.startDate?e.startDate.getTime()-t.startDate.getTime():0})),r=[];return n.forEach((function(e){for(var n=!1,o=0;o<r.length;o++){if(!r[o].some((function(n){return a.tasksVisuallyOverlap(e,n,t)}))){r[o].push(e),n=!0;break}}n||r.push([e])})),r},e.tasksVisuallyOverlap=function(e,t,a){if(void 0===a&&(a=E.MONTH),!(e.startDate&&e.endDate&&t.startDate&&t.endDate))return!1;var n=e.startDate.getTime(),r=e.endDate.getTime(),o=t.startDate.getTime(),i=t.endDate.getTime(),s=this.getCollisionBufferByViewMode(a);return n+s<i-s&&r-s>o+s||Math.abs(n-o)<2*s||Math.abs(r-i)<2*s},e.getCollisionBufferByViewMode=function(e){var t=36e5,a=24*t;switch(e){case E.DAY:return t;case E.WEEK:return 4*t;case E.MONTH:return 12*t;case E.QUARTER:return a;case E.YEAR:return 2*a;default:return 12*t}},e.wouldCollide=function(e,t,a,n){var r=this;return void 0===a&&(a=E.MONTH),t.some((function(t){return t.id!==e.id&&t.id!==n&&r.tasksVisuallyOverlap(e,t,a)}))},e.getPreviewArrangement=function(e,t,a){void 0===a&&(a=E.MONTH);var n=t.map((function(t){return t.id===e.id?e:t}));return this.detectOverlaps(n,a)},e}(),P=function(){function e(){}return e.calculateDatesFromPosition=function(e,t,a,n,i,s,c){void 0===c&&(c=E.MONTH);try{var l=isNaN(e)?0:e,u=isNaN(t)||t<20?20:t,d=a.getTime(),f=(n.getTime()-d)/(i*s),m=l*f,v=u*f,h=new Date(d+m),g=new Date(d+m+v);return h=r(h),g=o(g),h<a&&(h=new Date(a)),g>n&&(g=new Date(n)),{newStartDate:h,newEndDate:g}}catch(e){return console.error("Error calculating dates from position:",e),{newStartDate:new Date(a),newEndDate:new Date(n)}}},e.createUpdatedTask=function(e,t,a){return y(y({},e),{startDate:new Date(t),endDate:new Date(a)})},e.calculateTaskPixelPosition=function(e,t,a,n,r,o){var i;void 0===o&&(o=E.MONTH);try{if(!(e.startDate instanceof Date&&e.endDate instanceof Date))throw new Error("Invalid dates in task");var s=Math.max(e.startDate.getTime(),t.getTime()),c=Math.min(e.endDate.getTime(),a.getTime()),l=t.getTime(),u=a.getTime()-l,d=n*r,f=(s-l)/u*d,m=(c-s)/u*d,v=((i={})[E.DAY]=20,i[E.WEEK]=20,i[E.MONTH]=20,i[E.QUARTER]=30,i[E.YEAR]=40,i)[o]||20;m=Math.max(v,m);var h=d-f;return{leftPx:f,widthPx:m=Math.min(h,m)}}catch(t){return console.error("Error calculating task position:",t,e),{leftPx:0,widthPx:20}}},e.getLiveDatesFromElement=function(e,t,a,n,r,o){void 0===o&&(o=E.MONTH);try{if(!e)return{startDate:new Date(t),endDate:new Date(a)};var i=parseFloat(e.style.left||"0"),s=parseFloat(e.style.width||"0"),c=this.calculateDatesFromPosition(i,s,t,a,n,r,o);return{startDate:c.newStartDate,endDate:c.newEndDate}}catch(e){return console.error("Error getting live dates:",e),{startDate:new Date(t),endDate:new Date(a)}}},e.formatDate=function(e,t,a){if(void 0===t&&(t="default"),void 0===a&&(a=E.MONTH),!(e instanceof Date)||isNaN(e.getTime()))return"Invalid date";var n;switch(a){case E.DAY:case E.WEEK:case E.MONTH:n={year:"numeric",month:"short",day:"numeric"};break;case E.QUARTER:n={year:"numeric",month:"short"};break;case E.YEAR:n={year:"numeric"};break;default:n={year:"numeric",month:"short",day:"numeric"}}return e.toLocaleDateString(t,n)},e.getDuration=function(e,t,a){void 0===a&&(a=E.MONTH);try{if(!(e instanceof Date)||!(t instanceof Date)||isNaN(e.getTime())||isNaN(t.getTime()))return{value:0,unit:"days"};var n=e<t?e:t,r=e<t?t:e;switch(a){case E.DAY:var o=i(r,n)+1;return{value:o,unit:1===o?"day":"days"};case E.WEEK:var d=u(r,n)+1;return{value:d,unit:1===d?"week":"weeks"};case E.MONTH:var f=l(r,n)+1;return{value:f,unit:1===f?"month":"months"};case E.QUARTER:var m=c(r,n)+1;return{value:m,unit:1===m?"quarter":"quarters"};case E.YEAR:var v=s(r,n)+1;return{value:v,unit:1===v?"year":"years"};default:var h=i(r,n)+1;return{value:h,unit:1===h?"day":"days"}}}catch(e){return console.error("Error calculating duration:",e),{value:0,unit:"days"}}},e.datesOverlap=function(e,t,a,n){return d(e,{start:a,end:n})||d(t,{start:a,end:n})||d(a,{start:e,end:t})||d(n,{start:e,end:t})},e}(),S=function(t){var a=t.task,n=t.leftPx,r=t.widthPx,o=t.topPx,i=t.isHovered,s=t.isDragging,c=t.editMode,l=t.showProgress,u=void 0!==l&&l,d=t.instanceId,f=t.onMouseDown,m=t.onMouseEnter,v=t.onMouseLeave,h=t.onClick,g=(i||s)&&c;if(!a||!a.id)return console.warn("TaskItem: Invalid task data",a),null;var D=a.color||"bg-gantt-task";return e.createElement("div",{className:"absolute h-8 rounded ".concat(D," flex items-center px-2 text-xs text-gantt-task-text font-medium ").concat(c?"cursor-move":"cursor-pointer"),style:{left:"".concat(Math.max(0,n),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(o,"px")},onClick:function(e){return h(e,a)},onMouseDown:function(e){return f(e,a,"move")},onMouseEnter:function(e){return m(e,a)},onMouseLeave:v,"data-testid":"task-".concat(a.id),"data-task-id":a.id,"data-instance-id":d},g&&e.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-l",onMouseDown:function(e){e.stopPropagation(),f(e,a,"resize-left")}}),e.createElement("div",{className:"truncate select-none"},a.name||"Unnamed Task"),u&&"number"==typeof a.percent&&e.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 dark:bg-opacity-30 rounded-full overflow-hidden"},e.createElement("div",{className:"h-full bg-white dark:bg-gray-200 rounded-full",style:{width:"".concat(a.percent,"%")}})),g&&e.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-r",onMouseDown:function(e){e.stopPropagation(),f(e,a,"resize-right")}}))},L=function(t){var a=t.task,n=t.position,r=t.dragType,o=t.taskId,i=t.startDate,s=t.endDate,c=t.totalMonths,l=t.monthWidth,u=t.showProgress,d=void 0!==u&&u,m=t.instanceId,v=t.className,h=void 0===v?"":v,g=t.viewMode,D=void 0===g?E.MONTH:g,w=a.startDate,p=a.endDate;try{var y=o||a.id,M=document.querySelector('[data-task-id="'.concat(y,'"][data-instance-id="').concat(m,'"]'));if(M&&(r||M.style.left||M.style.width)){var k=P.getLiveDatesFromElement(M,i,s,c,l,D);w=k.startDate,p=k.endDate}}catch(e){console.error("Error calculating live dates for tooltip:",e)}var b=P.getDuration(w,p,D),x=function(e){return e instanceof Date&&!isNaN(e.getTime())?D===E.DAY?f(e,"EEE, MMM d, yyyy"):f(e,"MMM d, yyyy"):"Invalid date"},T=function(){if(!r)return null;switch(r){case"move":return"Moving task...";case"resize-left":return"Adjusting start date...";case"resize-right":return"Adjusting end date...";default:return null}}();return e.createElement("div",{className:"rmg-task-tooltip absolute z-20 bg-[var(--rmg-tooltip-bg,#ffffff)] text-[var(--rmg-tooltip-text,#1f2937)] border border-[var(--rmg-tooltip-border,#e5e7eb)] rounded-md shadow-md p-2 text-xs select-none ".concat(h),style:{left:"".concat(n.x,"px"),top:"".concat(n.y-40,"px"),minWidth:"200px"}},e.createElement("div",{className:"font-bold mb-1"},a.name||"Unnamed Task"),T&&e.createElement("div",{className:"text-xs text-blue-500 dark:text-blue-400 mb-1 italic"},T),e.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},e.createElement("div",{className:"font-semibold"},"Start:"),e.createElement("div",null,x(w)),e.createElement("div",{className:"font-semibold"},"End:"),e.createElement("div",null,x(p)),e.createElement("div",{className:"font-semibold"},"Duration:"),e.createElement("div",null,b.value," ",b.unit),d&&"number"==typeof a.percent&&e.createElement(e.Fragment,null,e.createElement("div",{className:"font-semibold"},"Progress:"),e.createElement("div",null,a.percent,"%")),a.dependencies&&a.dependencies.length>0&&e.createElement(e.Fragment,null,e.createElement("div",{className:"font-semibold"},"Dependencies:"),e.createElement("div",null,a.dependencies.join(", ")))))},C=function(r){var o=r.taskGroup,i=r.startDate,s=r.endDate,c=r.totalMonths,l=r.monthWidth,u=r.editMode,d=void 0===u||u,f=r.showProgress,m=void 0!==f&&f,v=r.className,h=void 0===v?"":v,g=r.tooltipClassName,D=void 0===g?"":g,w=r.onTaskUpdate,p=r.onTaskClick,M=r.onTaskSelect,k=r.viewMode,b=void 0===k?E.MONTH:k;if(!o||!o.id||!Array.isArray(o.tasks))return console.warn("TaskRow: Invalid task group data",o),e.createElement("div",{className:"relative h-16 text-gantt-text"},"Invalid task group data");var x=i instanceof Date?i:new Date,T=s instanceof Date?s:new Date,N=t(null),A=N[0],Y=N[1],R=t(null),O=R[0],H=R[1],F=t(null),C=F[0],W=F[1],U=t(0),K=U[0],Q=U[1],z=t({x:0,y:0}),_=z[0],j=z[1],B=t(null),q=B[0],G=B[1],V=t(null),X=V[0],J=V[1],Z=a(null),$=a(null),ee=a(null),te=a("task-row-".concat(Math.random().toString(36).substring(2,11))),ae=function(e){G(e),ee.current=e},ne=q?I.getPreviewArrangement(q,o.tasks,b):I.detectOverlaps(o.tasks,b),re=Math.max(60,40*ne.length+20),oe=function(e,t){p&&!O&&p(t,o),M&&M(t,!0)},ie=function(e,t){O||(Y(t),ce(e))},se=function(){O||Y(null)},ce=function(e){if(Z.current){var t=Z.current.getBoundingClientRect();j({x:e.clientX-t.left+20,y:e.clientY-t.top})}},le=function(e,t,a){if(d){e.preventDefault(),e.stopPropagation();var n=document.querySelector('[data-task-id="'.concat(t.id,'"][data-instance-id="').concat(te.current,'"]'));n&&(J({left:parseFloat(n.style.left||"0"),width:parseFloat(n.style.width||"0"),startDate:new Date(t.startDate),endDate:new Date(t.endDate)}),H(t),W(a),Q(e.clientX),G(t),function(e){H(e),$.current=e}(t),ae(t),document.addEventListener("mouseup",me),document.addEventListener("mousemove",ue))}},ue=function(e){if(e instanceof MouseEvent&&A&&Z.current){var t=e,a=Z.current.getBoundingClientRect();j({x:t.clientX-a.left+20,y:t.clientY-a.top})}else e instanceof MouseEvent||ce(e);if(O&&C&&X&&Z.current)try{var n=document.querySelector('[data-task-id="'.concat(O.id,'"][data-instance-id="').concat(te.current,'"]'));if(!n)return;var r=e.clientX-K,o=c*l,i=X.left,s=X.width;switch(C){case"move":i=Math.max(0,Math.min(o-X.width,X.left+r)),b===E.DAY&&(i=Math.round(i/l)*l),n.style.left="".concat(i,"px");break;case"resize-left":var u=X.width-20,d=Math.min(u,r);i=Math.max(0,X.left+d),b===E.DAY&&(i=Math.round(i/l)*l);var f=X.left+X.width;s=Math.max(20,f-i),n.style.left="".concat(i,"px"),n.style.width="".concat(s,"px");break;case"resize-right":if(s=Math.max(20,Math.min(o-X.left,X.width+r)),b===E.DAY){var m=X.left+s,v=Math.round(m/l)*l;s=Math.max(20,v-X.left)}n.style.width="".concat(s,"px")}var h=de(x,T,b)/o,g=x.getTime()+i*h,D=x.getTime()+(i+s)*h,w=fe(new Date(g),new Date(D),b),p=w.newStartDate,M=w.newEndDate,k=y(y({},O),{startDate:p,endDate:M});G(k),ae(k)}catch(e){console.error("Error in handleMouseMove:",e)}},de=function(e,t,a){var n=e.getTime(),r=t.getTime()-n;return E.YEAR,r},fe=function(e,t,a){var n=new Date(e),r=new Date(t);switch(a){case E.DAY:n.setHours(0,0,0,0),r.setHours(23,59,59,999);case E.WEEK:case E.MONTH:case E.QUARTER:case E.YEAR:}return{newStartDate:n,newEndDate:r}},me=function(){try{var e=$.current,t=ee.current;e&&t&&w&&w(o.id,t)}catch(e){console.error("Error in handleMouseUp:",e)}finally{H(null),W(null),G(null),J(null),$.current=null,ee.current=null,document.removeEventListener("mouseup",me),document.removeEventListener("mousemove",ue)}};return n((function(){return function(){document.removeEventListener("mouseup",me),document.removeEventListener("mousemove",ue)}}),[]),o.tasks&&0!==o.tasks.length?e.createElement("div",{className:"relative border-b border-gantt-border ".concat(h),style:{height:"".concat(re,"px")},onMouseMove:function(e){return ue(e)},onMouseLeave:function(){return Y(null)},ref:Z,"data-testid":"task-row-".concat(o.id),"data-instance-id":te.current},ne.map((function(t,a){return e.createElement(e.Fragment,{key:"task-row-".concat(a)},t.map((function(t){try{if(!(t&&t.id&&t.startDate instanceof Date&&t.endDate instanceof Date))return console.warn("Invalid task data:",t),null;var n=P.calculateTaskPixelPosition(t,x,T,c,l,b),r=n.leftPx,o=n.widthPx,i=(null==A?void 0:A.id)===t.id,s=(null==O?void 0:O.id)===t.id,u=40*a+10;return e.createElement(S,{key:"task-".concat(t.id),task:t,leftPx:r,widthPx:o,topPx:u,isHovered:i,isDragging:s,editMode:d,showProgress:m,instanceId:te.current,onMouseDown:le,onMouseEnter:ie,onMouseLeave:se,onClick:oe})}catch(e){return console.error("Error rendering task:",e,t),null}})))})),(A||O)&&e.createElement(L,{task:q||O||A,position:_,dragType:C,taskId:null==O?void 0:O.id,startDate:x,endDate:T,totalMonths:c,monthWidth:l,showProgress:m,instanceId:te.current,className:D,viewMode:b})):e.createElement("div",{className:"relative h-16 text-gantt-text"},"No tasks available")},W=function(t){var a=t.months,n=t.currentMonthIndex,r=(t.locale,t.className),o=void 0===r?"":r,i=t.viewMode,s=void 0===i?E.MONTH:i,c=t.unitWidth,l=void 0===c?150:c,u=[E.DAY,E.WEEK].includes(s),d=function(){if(![E.DAY,E.WEEK].includes(s)||0===a.length)return[];var e=[],t=new Date(a[0]),n=0;return a.forEach((function(a){a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()?n+=1:(e.push({date:t,span:n}),t=new Date(a),n=1)})),n>0&&e.push({date:t,span:n}),e}();return e.createElement("div",{className:"rmg-timeline ".concat(o),style:{"--gantt-unit-width":"".concat(l,"px")}},u&&e.createElement("div",{className:"flex border-b border-gantt-border"},d.map((function(t,a){return e.createElement("div",{key:"higher-level-".concat(a),className:"flex-shrink-0 p-2 font-semibold text-center text-gantt-text border-r border-gantt-border h-10",style:{width:"".concat(t.span*l,"px")},"data-timeunit-higher":t.date.toISOString()},function(e){if(!(e instanceof Date))return"";switch(s){case E.DAY:case E.WEEK:}return f(e,"MMM yyyy",{locale:void 0})}(t.date))}))),e.createElement("div",{className:"flex border-b border-gantt-border"},a.map((function(t,a){return e.createElement("div",{key:"timeunit-".concat(a),className:"".concat("w-[var(--gantt-unit-width)]"," flex-shrink-0 p-2 font-semibold text-center text-gantt-text ").concat(a===n?"bg-gantt-highlight":""," ").concat(u?"border-r border-gantt-border":""," h-10"),"data-timeunit":t.toISOString()},function(e){if(!(e instanceof Date))return"";switch(s){case E.DAY:return f(e,"d",{locale:void 0});case E.WEEK:var t=m(e);return"W".concat(t);case E.MONTH:return f(e,"MMM yyyy",{locale:void 0});case E.QUARTER:var a=Math.floor(e.getMonth()/3)+1;return"Q".concat(a," ").concat(e.getFullYear());case E.YEAR:return e.getFullYear().toString();default:return f(e,"MMM yyyy",{locale:void 0})}}(t))}))))},U=function(t){var a=t.currentMonthIndex,n=t.height,r=t.markerClass,o=void 0===r?"bg-red-500":r,i=t.label,s=void 0===i?"Today":i,c=t.dayOfMonth,l=t.className,u=void 0===l?"":l,d=t.viewMode,f=void 0===d?E.MONTH:d,m=t.unitWidth,v=void 0===m?150:m;if(a<0)return null;var h=function(){var e=new Date;switch(c||e.getDate(),f){case E.DAY:return a*v+v/2;case E.WEEK:var t=e.getDay();return a*v+v*(t/7);case E.MONTH:t=e.getDay();return a*v+v*(t/7);case E.QUARTER:var n=e.getMonth()%3;return a*v+v*(n/3);case E.YEAR:var r=e.getMonth();return a*v+v*(r/12);default:return a*v+v/2}}();return e.createElement("div",{className:"absolute top-0 w-px ".concat(o," z-10 ").concat(u),style:{left:"".concat(h,"px"),height:"".concat(n,"px")},"data-testid":"today-marker"},e.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(o," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},s))},K=function(t){var a=t.tasks,n=void 0===a?[]:a,r=t.headerLabel,o=void 0===r?"Resources":r,i=t.showIcon,s=void 0!==i&&i,c=t.showTaskCount,l=void 0!==c&&c,u=t.showDescription,d=void 0===u||u,f=t.rowHeight,m=void 0===f?40:f,v=t.className,h=void 0===v?"":v,g=t.onGroupClick,D=t.viewMode,w=Array.isArray(n)?n:[],p=D===E.DAY||D===E.WEEK;return e.createElement("div",{className:"rmg-task-list w-40 flex-shrink-0 z-10 bg-gantt-bg shadow-sm ".concat(h)},p?e.createElement(e.Fragment,null,e.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"}),e.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},o)):e.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},o),w.map((function(t){if(!t)return null;var a=function(e){if(!e.tasks||!Array.isArray(e.tasks))return 60;var t=Y(e.tasks);return Math.max(60,t.length*m+20)}(t);return e.createElement("div",{key:"task-group-".concat(t.id||"unknown"),className:"p-2 border-r border-b border-gantt-border font-medium text-gantt-text bg-gantt-bg hover:bg-gantt-highlight transition-colors duration-150",style:{height:"".concat(a,"px")},onClick:function(){return e=t,void(g&&g(e));var e},"data-testid":"task-group-".concat(t.id||"unknown")},e.createElement("div",{className:"flex items-center"},s&&t.icon&&e.createElement("span",{className:"mr-2",dangerouslySetInnerHTML:{__html:t.icon}}),e.createElement("div",{className:"font-medium truncate"},t.name||"Unnamed")),d&&t.description&&e.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate"},t.description),l&&t.tasks&&t.tasks.length>0&&e.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1"},t.tasks.length," ",1===t.tasks.length?"task":"tasks"))})))},Q=function(r){var o=r.tasks,i=void 0===o?[]:o,s=r.startDate,c=r.endDate,l=r.title,u=void 0===l?"Project Timeline":l,d=r.currentDate,f=void 0===d?new Date:d,m=r.showCurrentDateMarker,p=void 0===m||m,k=r.todayLabel,b=void 0===k?"Today":k,T=r.editMode,N=void 0===T||T,A=r.headerLabel,H=void 0===A?"Resources":A,F=r.showProgress,I=void 0!==F&&F,P=r.darkMode,S=void 0!==P&&P,L=r.locale,Q=void 0===L?"default":L,_=r.styles,j=void 0===_?{}:_,B=r.viewMode,q=void 0===B?E.MONTH:B,G=r.onTaskUpdate,V=r.onTaskClick,X=r.onTaskSelect;r.onTaskDoubleClick;var J=r.onGroupClick,Z=r.fontSize,$=r.rowHeight,ee=void 0===$?40:$;r.timeStep;var te=a(null),ae=a(null),ne=t(q),re=ne[0],oe=ne[1],ie=t([]);ie[0];var se=ie[1],ce=t(150),le=ce[0],ue=ce[1],de=s||R(i),fe=c||O(i),me=function(e,t){for(var a=[],n=new Date(e);n<=t;)a.push(new Date(n)),n=v(n,1);return a},ve=function(e,t){for(var a=[],n=new Date(e);n<=t;)a.push(new Date(n)),n=v(n,7);return a},he=function(e,t){for(var a=[],n=h(new Date(e));n<=t;)a.push(new Date(n)),n=g(n,1);return a},ge=function(e,t){for(var a=[],n=D(new Date(e));n<=t;)a.push(new Date(n)),n=w(n,1);return a},De=function(){switch(re){case E.DAY:return me(de,fe);case E.WEEK:return ve(de,fe);case E.MONTH:return x(de,fe);case E.QUARTER:return he(de,fe);case E.YEAR:return ge(de,fe);default:return x(de,fe)}}(),we=De.length,Ee=function(){var e=new Date;switch(re){case E.DAY:return De.findIndex((function(t){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case E.WEEK:return De.findIndex((function(t){var a=new Date(t);return a.setDate(t.getDate()+6),e>=t&&e<=a}));case E.MONTH:return De.findIndex((function(t){return t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case E.QUARTER:var t=Math.floor(e.getMonth()/3);return De.findIndex((function(a){return Math.floor(a.getMonth()/3)===t&&a.getFullYear()===e.getFullYear()}));case E.YEAR:return De.findIndex((function(t){return t.getFullYear()===e.getFullYear()}));default:return-1}}(),pe=function(e,t){if(G)try{var a=y(y({},t),{startDate:t.startDate instanceof Date?t.startDate:new Date(t.startDate),endDate:t.endDate instanceof Date?t.endDate:new Date(t.endDate)});G(e,a)}catch(e){console.error("Error in handleTaskUpdate:",e)}},ye=function(e,t){if(V)try{V(e,t)}catch(e){console.error("Error in handleTaskClick:",e)}},Me=function(e,t){if(se((function(a){return t?M(M([],a,!0),[e.id],!1):a.filter((function(t){return t!==e.id}))})),X)try{X(e,t)}catch(e){console.error("Error in onTaskSelect handler:",e)}},ke=function(e){switch(oe(e),e){case E.DAY:ue(40);break;case E.WEEK:ue(80);break;case E.MONTH:ue(150);break;case E.QUARTER:ue(180);break;case E.YEAR:ue(200);break;default:ue(150)}};n((function(){ke(q)}),[q]);var be,xe={fontSize:Z||"inherit"},Te=S?"dark":"",Ne=y(y({},{container:"",title:"",header:"",taskList:"",timeline:"",taskRow:"",todayMarker:"",tooltip:""}),j);return e.createElement("div",{ref:te,className:"rmg-gantt-chart w-full bg-gantt-bg text-gantt-text rounded-xl shadow-lg overflow-hidden ".concat(Te," ").concat(Ne.container),style:y(y({},xe),{"--gantt-unit-width":"".concat(le,"px")}),"data-testid":"gantt-chart"},e.createElement("div",{className:"p-6 border-b border-gantt-border"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("h1",{className:"text-2xl font-bold text-gantt-text ".concat(Ne.title)},u),e.createElement("div",{className:"flex space-x-2"},e.createElement(z,{activeMode:re,onChange:ke,darkMode:S})))),e.createElement("div",{className:"relative flex"},e.createElement(K,{tasks:i,headerLabel:H,onGroupClick:J,className:Ne.taskList,viewMode:re}),e.createElement("div",{ref:ae,className:"flex-grow overflow-x-auto"},e.createElement("div",{className:"min-w-max"},e.createElement(W,{months:De,currentMonthIndex:Ee,locale:Q,className:Ne.timeline,viewMode:re,unitWidth:le}),e.createElement("div",{className:"relative"},p&&Ee>=0&&e.createElement(U,{currentMonthIndex:Ee,height:(be=0,i.forEach((function(e){if(e&&Array.isArray(e.tasks)){var t=Y(e.tasks);be+=Math.max(60,t.length*ee+20)}else be+=60})),be),label:b,dayOfMonth:f.getDate(),className:Ne.todayMarker,viewMode:re,unitWidth:le}),i.map((function(t){return t&&t.id?e.createElement(C,{key:"task-row-".concat(t.id),taskGroup:t,startDate:de,endDate:fe,totalMonths:we,monthWidth:le,editMode:N,showProgress:I,onTaskUpdate:pe,onTaskClick:ye,onTaskSelect:Me,className:Ne.taskRow,tooltipClassName:Ne.tooltip,viewMode:re}):null})))))))},z=function(t){var a=t.activeMode,n=t.onChange,r=t.darkMode,o="px-3 py-1 text-sm font-medium rounded transition-colors duration-200 ".concat(r?"hover:bg-gray-700":"hover:bg-gray-200"),i="bg-indigo-600 text-white",s=r?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700";return e.createElement("div",{className:"flex rounded-md shadow-sm"},e.createElement("button",{className:"".concat(o," rounded-l-md ").concat(a===E.DAY?i:s),onClick:function(){return n(E.DAY)}},"Day"),e.createElement("button",{className:"".concat(o," border-l ").concat(a===E.WEEK?i:s),onClick:function(){return n(E.WEEK)}},"Week"),e.createElement("button",{className:"".concat(o," border-l ").concat(a===E.MONTH?i:s),onClick:function(){return n(E.MONTH)}},"Month"),e.createElement("button",{className:"".concat(o," border-l ").concat(a===E.QUARTER?i:s),onClick:function(){return n(E.QUARTER)}},"Quarter"),e.createElement("button",{className:"".concat(o," rounded-r-md border-l ").concat(a===E.YEAR?i:s),onClick:function(){return n(E.YEAR)}},"Year"))};export{I as CollisionManager,p as DateDisplayFormat,Q as GanttChart,S as TaskItem,K as TaskList,P as TaskManager,C as TaskRow,W as Timeline,U as TodayMarker,L as Tooltip,E as ViewMode,F as calculateDuration,A as calculateTaskPosition,Y as detectTaskOverlaps,R as findEarliestDate,O as findLatestDate,b as formatDate,H as formatDateRange,k as formatMonth,T as getDaysInMonth,x as getMonthsBetween,N as getStandardDayMarkers};
//# sourceMappingURL=index.esm.js.map
