import t,{useRef as e,useState as a,useEffect as n,useCallback as r}from"react";import{differenceInDays as o,differenceInYears as i,differenceInQuarters as s,differenceInMonths as l,differenceInWeeks as c,isValid as d,format as u,getWeek as g,startOfDay as h,endOfDay as m,isWithinInterval as f,addDays as v,startOfQuarter as p,addQuarters as w,startOfYear as k,addYears as D}from"date-fns";var T,M,y=function(){return y=Object.assign||function(t){for(var e,a=1,n=arguments.length;a<n;a++)for(var r in e=arguments[a])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},y.apply(this,arguments)};function E(t,e,a){if(a||2===arguments.length)for(var n,r=0,o=e.length;r<o;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))}function b(t,e){var a=[];if(!(t instanceof Date&&e instanceof Date))return[new Date];for(var n=t.getFullYear(),r=t.getMonth(),o=e.getFullYear(),i=e.getMonth(),s=n;s<=o;s++)for(var l=s===o?i:11,c=s===n?r:0;c<=l;c++)a.push(new Date(s,c,1));return a}"function"==typeof SuppressedError&&SuppressedError,function(t){t.DAY="day",t.WEEK="week",t.MONTH="month",t.QUARTER="quarter",t.YEAR="year"}(T||(T={})),function(t){t.MONTH_YEAR="month-year",t.FULL_DATE="full-date",t.SHORT_DATE="short-date"}(M||(M={}));var x=function(e){var a=e.months,n=e.currentMonthIndex,r=(e.locale,e.className),o=void 0===r?"":r,i=e.viewMode,s=void 0===i?T.MONTH:i,l=e.unitWidth,c=void 0===l?150:l,h=[T.DAY,T.WEEK].includes(s),m=function(){if(![T.DAY,T.WEEK].includes(s)||0===a.length)return[];var t=[],e=new Date(a[0]),n=0;return a.forEach((function(a){a.getMonth()===e.getMonth()&&a.getFullYear()===e.getFullYear()?n+=1:(t.push({date:e,span:n}),e=new Date(a),n=1)})),n>0&&t.push({date:e,span:n}),t}();return t.createElement("div",{className:"rmg-timeline ".concat(o),style:{"--gantt-unit-width":"".concat(c,"px")}},h&&t.createElement("div",{className:"flex border-b border-gantt-border"},m.map((function(e,a){return t.createElement("div",{key:"higher-level-".concat(a),className:"flex-shrink-0 p-2 font-semibold text-center text-gantt-text border-r border-gantt-border h-10",style:{width:"".concat(e.span*c,"px")},"data-timeunit-higher":e.date.toISOString()},function(t){if(!(t instanceof Date))return"";switch(s){case T.DAY:case T.WEEK:}return u(t,"MMM yyyy",{locale:void 0})}(e.date))}))),t.createElement("div",{className:"flex border-b border-gantt-border"},a.map((function(e,a){return t.createElement("div",{key:"timeunit-".concat(a),className:"".concat("w-[var(--gantt-unit-width)]"," flex-shrink-0 p-2 font-semibold text-center text-gantt-text ").concat(a===n?"bg-gantt-highlight":""," ").concat(h?"border-r border-gantt-border":""," h-10"),"data-timeunit":e.toISOString()},function(t){if(!(t instanceof Date&&d(t)))return"";switch(s){case T.DAY:return u(t,"d",{locale:void 0});case T.WEEK:var e=g(t);return"W".concat(e);case T.MONTH:return u(t,"MMM yyyy",{locale:void 0});case T.QUARTER:var a=Math.floor(t.getMonth()/3)+1;return"Q".concat(a," ").concat(t.getFullYear());case T.YEAR:return t.getFullYear().toString();default:return u(t,"MMM yyyy",{locale:void 0})}}(e))}))))},N=function(e){var a=e.currentMonthIndex,n=e.height,r=e.markerClass,o=void 0===r?"bg-red-500":r,i=e.label,s=void 0===i?"Today":i,l=e.dayOfMonth,c=e.className,d=void 0===c?"":c,u=e.viewMode,g=void 0===u?T.MONTH:u,h=e.unitWidth,m=void 0===h?150:h;if(a<0)return null;var f=function(){var t=new Date;switch(l||t.getDate(),g){case T.DAY:return a*m+m/2;case T.WEEK:var e=t.getDay();return a*m+m*(e/7);case T.MONTH:var n=t.getDay();return a*m+m*(n/7);case T.QUARTER:var r=t.getMonth()%3;return a*m+m*(r/3);case T.YEAR:var o=t.getMonth();return a*m+m*(o/12);default:return a*m+m/2}}();return t.createElement("div",{className:"absolute top-0 w-px ".concat(o," z-10 ").concat(d),style:{left:"".concat(f,"px"),height:"".concat(n,"px")},"data-testid":"today-marker"},t.createElement("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 ".concat(o," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},s))},A=function(){function t(){}return t.detectOverlaps=function(t,e){var a=this;if(void 0===e&&(e=T.MONTH),!Array.isArray(t)||0===t.length)return[];var n=E([],t,!0).sort((function(t,e){return t.startDate&&e.startDate?t.startDate.getTime()-e.startDate.getTime():0})),r=[];return n.forEach((function(t){for(var n=!1,o=0;o<r.length;o++){if(!r[o].some((function(n){return a.tasksVisuallyOverlap(t,n,e)}))){r[o].push(t),n=!0;break}}n||r.push([t])})),r},t.tasksVisuallyOverlap=function(t,e,a){if(void 0===a&&(a=T.MONTH),!(t.startDate&&t.endDate&&e.startDate&&e.endDate))return!1;var n=t.startDate.getTime(),r=t.endDate.getTime(),o=e.startDate.getTime(),i=e.endDate.getTime(),s=this.getCollisionBufferByViewMode(a);return n+s<i-s&&r-s>o+s||Math.abs(n-o)<2*s||Math.abs(r-i)<2*s},t.getCollisionBufferByViewMode=function(t){var e=36e5,a=24*e;switch(t){case T.DAY:return e;case T.WEEK:return 4*e;case T.MONTH:return 12*e;case T.QUARTER:return a;case T.YEAR:return 2*a;default:return 12*e}},t.wouldCollide=function(t,e,a,n){var r=this;return void 0===a&&(a=T.MONTH),e.some((function(e){return e.id!==t.id&&e.id!==n&&r.tasksVisuallyOverlap(t,e,a)}))},t.getPreviewArrangement=function(t,e,a){void 0===a&&(a=T.MONTH);var n=e.map((function(e){return e.id===t.id?t:e}));return this.detectOverlaps(n,a)},t}(),S=function(){function t(){}return t.calculateDatesFromPosition=function(t,e,a,n,r,o,i){void 0===i&&(i=T.MONTH);try{var s=isNaN(t)?0:t,l=isNaN(e)||e<20?20:e,c=a.getTime(),d=(n.getTime()-c)/(r*o),u=s*d,g=l*d,f=new Date(c+u),v=new Date(c+u+g);if(i===T.DAY){var p=Math.round(t/o),w=Math.max(1,Math.round(e/o)),k=new Date(a);k.setHours(0,0,0,0),(f=new Date(k)).setDate(k.getDate()+p),f.setHours(0,0,0,0),(v=new Date(f)).setDate(f.getDate()+w-1),v.setHours(23,59,59,999)}else f=h(f),v=m(v);return f<a&&(f=new Date(a)),v>n&&(v=new Date(n)),{newStartDate:f,newEndDate:v}}catch(t){return console.error("Error calculating dates from position:",t),{newStartDate:new Date(a),newEndDate:new Date(n)}}},t.createUpdatedTask=function(t,e,a){return y(y({},t),{startDate:new Date(e),endDate:new Date(a)})},t.calculateTaskPixelPosition=function(t,e,a,n,r,o){var i;void 0===o&&(o=T.MONTH);try{if(!(t.startDate instanceof Date&&t.endDate instanceof Date))throw new Error("Invalid dates in task");var s=e.getTime(),l=a.getTime(),c=Math.max(t.startDate.getTime(),e.getTime()),d=Math.min(t.endDate.getTime(),a.getTime());if(o===T.DAY){var u=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0).getTime(),g=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999).getTime();s=u,l=g;var h=new Date(new Date(c).getFullYear(),new Date(c).getMonth(),new Date(c).getDate(),0,0,0,0).getTime(),m=new Date(new Date(d).getFullYear(),new Date(d).getMonth(),new Date(d).getDate(),23,59,59,999).getTime();c=h,d=m}var f=l-s,v=n*r,p=(c-s)/f*v,w=(d-c)/f*v;o===T.DAY&&(p=Math.round(p/r)*r,w=Math.max(r,Math.round(w/r)*r));var k=((i={})[T.DAY]=20,i[T.WEEK]=20,i[T.MONTH]=20,i[T.QUARTER]=30,i[T.YEAR]=40,i)[o]||20;w=Math.max(k,w);var D=v-p;return{leftPx:p,widthPx:w=Math.min(D,w)}}catch(t){return console.error("Error calculating task position:",t),{leftPx:0,widthPx:20}}},t.getLiveDatesFromElement=function(t,e,a,n,r,o){void 0===o&&(o=T.MONTH);try{if(!t)return{startDate:new Date(e),endDate:new Date(a)};var i=parseFloat(t.style.left||"0"),s=parseFloat(t.style.width||"0"),l=this.calculateDatesFromPosition(i,s,e,a,n,r,o);return{startDate:l.newStartDate,endDate:l.newEndDate}}catch(t){return console.error("Error getting live dates:",t),{startDate:new Date(e),endDate:new Date(a)}}},t.datesOverlap=function(t,e,a,n){return f(t,{start:a,end:n})||f(e,{start:a,end:n})||f(a,{start:t,end:e})||f(n,{start:t,end:e})},t}(),P=function(e){var a=e.task,n=e.position,r=e.dragType,d=e.taskId,g=e.startDate,h=e.endDate,m=e.totalMonths,f=e.monthWidth,v=e.showProgress,p=void 0!==v&&v,w=e.instanceId,k=e.className,D=void 0===k?"":k,M=e.viewMode,y=void 0===M?T.MONTH:M,E=e.renderTooltip,b=a.startDate,x=a.endDate;try{var N=d||a.id,A=document.querySelector('[data-task-id="'.concat(N,'"][data-instance-id="').concat(w,'"]'));if(A&&(r||A.style.left||A.style.width)){var P=S.getLiveDatesFromElement(A,g,h,m,f,y);b=P.startDate,x=P.endDate}}catch(t){console.error("Error calculating live dates for tooltip:",t)}var Y=function(t,e,a){void 0===a&&(a=T.MONTH);try{if(!(t instanceof Date)||!(e instanceof Date)||isNaN(t.getTime())||isNaN(e.getTime()))return{value:0,unit:"days"};var n=t<e?t:e,r=t<e?e:t;switch(a){case T.DAY:var d=o(r,n)+1;return{value:d,unit:1===d?"day":"days"};case T.WEEK:var u=c(r,n)+1;return{value:u,unit:1===u?"week":"weeks"};case T.MONTH:var g=l(r,n)+1;return{value:g,unit:1===g?"month":"months"};case T.QUARTER:var h=s(r,n)+1;return{value:h,unit:1===h?"quarter":"quarters"};case T.YEAR:var m=i(r,n)+1;return{value:m,unit:1===m?"year":"years"};default:var f=o(r,n)+1;return{value:f,unit:1===f?"day":"days"}}}catch(t){return console.error("Error calculating duration:",t),{value:0,unit:"days"}}}(b,x,y),C=function(t){return t instanceof Date&&!isNaN(t.getTime())?y===T.DAY?u(t,"EEE, MMM d, yyyy"):u(t,"MMM d, yyyy"):"Invalid date"},R=function(){if(!r)return null;switch(r){case"move":return"Moving task...";case"resize-left":return"Adjusting start date...";case"resize-right":return"Adjusting end date...";default:return null}}();return E?t.createElement("div",{className:"rmg-task-tooltip absolute z-20 ".concat(D),style:{left:"".concat(n.x,"px"),top:"".concat(n.y-40,"px")}},E({task:a,position:n,dragType:r,startDate:b,endDate:x,viewMode:y})):t.createElement("div",{className:"rmg-task-tooltip absolute z-20 bg-[var(--rmg-tooltip-bg,#ffffff)] text-[var(--rmg-tooltip-text,#1f2937)] border border-[var(--rmg-tooltip-border,#e5e7eb)] rounded-md shadow-md p-2 text-xs select-none ".concat(D),style:{left:"".concat(n.x,"px"),top:"".concat(n.y-40,"px"),minWidth:"200px"}},t.createElement("div",{className:"font-bold mb-1"},a.name||"Unnamed Task"),R&&t.createElement("div",{className:"text-xs text-blue-500 dark:text-blue-400 mb-1 italic"},R),t.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},t.createElement("div",{className:"font-semibold"},"Start:"),t.createElement("div",null,C(b)),t.createElement("div",{className:"font-semibold"},"End:"),t.createElement("div",null,C(x)),t.createElement("div",{className:"font-semibold"},"Duration:"),t.createElement("div",null,Y.value," ",Y.unit),p&&"number"==typeof a.percent&&t.createElement(t.Fragment,null,t.createElement("div",{className:"font-semibold"},"Progress:"),t.createElement("div",null,a.percent,"%")),a.dependencies&&a.dependencies.length>0&&t.createElement(t.Fragment,null,t.createElement("div",{className:"font-semibold"},"Dependencies:"),t.createElement("div",null,a.dependencies.join(", ")))))},Y=function(r){var o=r.activeMode,i=r.onChange,s=r.darkMode,l=r.availableModes,c=[{id:T.DAY,label:"Day"},{id:T.WEEK,label:"Week"},{id:T.MONTH,label:"Month"},{id:T.QUARTER,label:"Quarter"},{id:T.YEAR,label:"Year"}],d=l?c.filter((function(t){return l.includes(t.id)})):c,u=e(null),g=a({left:"0px",width:"0px"}),h=g[0],m=g[1];n((function(){var t=function(){if(u.current){var t=u.current.querySelector('[aria-selected="true"]');if(t){var e=t,a=e.offsetLeft,n=e.offsetWidth;m({left:"".concat(a,"px"),width:"".concat(n,"px")})}}};return t(),window.addEventListener("resize",t),function(){return window.removeEventListener("resize",t)}}),[o]);var f="\n        relative inline-flex rounded-full p-0.5\n        ".concat(s?"bg-gray-800/80":"bg-gray-100/90","\n        transition-all duration-300 ease-in-out shadow-sm\n        border ").concat(s?"border-gray-700":"border-gray-200","\n    ");return t.createElement("div",{className:"relative flex items-center"},t.createElement("div",{ref:u,className:f,role:"tablist","aria-label":"View mode options"},t.createElement("span",{className:"\n                        absolute z-0 inset-0.5 rounded-full\n                        transition-all duration-300 ease-out transform\n                        ".concat(s?"bg-indigo-600":"bg-indigo-500","\n                    "),style:h,"aria-hidden":"true"}),d.map((function(e){return t.createElement("button",{key:e.id,role:"tab","aria-selected":o===e.id,"aria-controls":"panel-".concat(e.id),className:"".concat((a=o===e.id,"\n        relative z-10 px-3 py-1 text-xs font-medium\n        transition-all duration-200 ease-in-out\n        ".concat(a?"text-white":s?"text-gray-400 hover:text-gray-200":"text-gray-500 hover:text-gray-700","\n        focus:outline-none\n    "))," rounded-full"),onClick:function(){return i(e.id)}},e.label);var a}))))},C=function(o){var i=o.task,s=o.leftPx,l=o.widthPx,c=o.topPx,d=o.isHovered,u=o.isDragging,g=o.editMode,h=o.showProgress,m=void 0!==h&&h,f=o.instanceId,v=o.renderTask,p=o.getTaskColor,w=o.onMouseDown,k=o.onMouseEnter,D=o.onMouseLeave,T=o.onClick,M=o.onProgressUpdate,E=(d||u)&&g,b=e(null),x=e(null),N=a(!1),A=N[0],S=N[1],P=a(i.percent||0),Y=P[0],C=P[1];if(!i||!i.id)return null;var R=i.color||"bg-gantt-task",F="",H="text-gantt-task-text";if(p){var O=p({task:i,isHovered:d,isDragging:u});R=O.backgroundColor,F=O.borderColor||"",H=O.textColor||H}var L=r((function(t){if(A&&x.current&&b.current){var e=b.current.getBoundingClientRect(),a=e.width-2,n=Math.max(0,Math.min(a,t.clientX-e.left)),r=Math.round(n/a*100);C(Math.max(0,Math.min(100,r)))}}),[A]),W=r((function(){A&&(S(!1),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",W),M&&Y!==i.percent&&M(i,Y))}),[A,M,Y,i]);if(n((function(){C(i.percent||0)}),[i.percent]),n((function(){return function(){document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",W)}}),[L,W]),v){var I=v({task:i,leftPx:s,widthPx:l,topPx:c,isHovered:d,isDragging:u,editMode:g,showProgress:m});return t.createElement("div",{ref:b,className:"absolute",style:{left:"".concat(Math.max(0,s),"px"),width:"".concat(Math.max(20,l),"px"),top:"".concat(c,"px")},onClick:function(t){return T(t,i)},onMouseDown:function(t){return w(t,i,"move")},onMouseEnter:function(t){return k(t,i)},onMouseLeave:D,"data-testid":"task-".concat(i.id),"data-task-id":i.id,"data-instance-id":f,"data-dragging":u?"true":"false"},I)}var U=R.startsWith("bg-")?{}:{backgroundColor:R},z=R.startsWith("bg-")?R:"",K=F?F.startsWith("border-")?{}:{borderColor:F,borderWidth:"1px"}:{},Q=F&&F.startsWith("border-")?F:"";return t.createElement("div",{ref:b,className:"absolute h-8 rounded ".concat(z," ").concat(Q," ").concat(H," flex items-center px-2 text-xs font-medium ").concat(g?"cursor-move":"cursor-pointer"," ").concat(u?"shadow-lg":""),style:y(y(y({left:"".concat(Math.max(0,s),"px"),width:"".concat(Math.max(20,l),"px"),top:"".concat(c,"px")},U),K),{willChange:u?"transform, left, width":"auto"}),onClick:function(t){return T(t,i)},onMouseDown:function(t){return w(t,i,"move")},onMouseEnter:function(t){return k(t,i)},onMouseLeave:D,"data-testid":"task-".concat(i.id),"data-task-id":i.id,"data-instance-id":f,"data-dragging":u?"true":"false"},E&&t.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-l rmg-resize-handle",onMouseDown:function(t){t.stopPropagation(),w(t,i,"resize-left")}}),t.createElement("div",{className:"truncate select-none"},i.name||"Unnamed Task"),m&&"number"==typeof Y&&t.createElement("div",{ref:x,className:"absolute bottom-1 left-1 right-1 h-2 bg-black bg-opacity-20 dark:bg-opacity-30 rounded-full overflow-hidden ".concat(g?"cursor-pointer":""),onClick:function(t){if(g&&m&&M){t.stopPropagation();var e=t.currentTarget.clientWidth,a=t.nativeEvent.offsetX,n=Math.round(a/e*100);C(n),M(i,n)}}},t.createElement("div",{className:"h-full bg-white dark:bg-gray-200 rounded-full relative",style:{width:"".concat(Y,"%")}},g&&(d||A)&&t.createElement("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-1/2 h-4 w-4 rounded-full bg-white border-2 ".concat(F||R.startsWith("bg-")?Q||z:"border-blue-500"," cursor-ew-resize shadow-sm hover:shadow-md transition-shadow ").concat(A?"scale-110":""),onMouseDown:function(t){g&&m&&(t.stopPropagation(),t.preventDefault(),S(!0),document.addEventListener("mousemove",L),document.addEventListener("mouseup",W))}}))),E&&t.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-r rmg-resize-handle",onMouseDown:function(t){t.stopPropagation(),w(t,i,"resize-right")}}))},R=function(e){var a=e.tasks,n=void 0===a?[]:a,r=e.headerLabel,o=void 0===r?"Resources":r,i=e.showIcon,s=void 0!==i&&i,l=e.showTaskCount,c=void 0!==l&&l,d=e.showDescription,u=void 0===d||d,g=e.rowHeight,h=void 0===g?40:g,m=e.className,f=void 0===m?"":m,v=e.onGroupClick,p=e.viewMode,w=Array.isArray(n)?n:[],k=p===T.DAY||p===T.WEEK;return t.createElement("div",{className:"rmg-task-list w-40 flex-shrink-0 z-10 bg-gantt-bg shadow-sm ".concat(f)},k?t.createElement(t.Fragment,null,t.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"}),t.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},o)):t.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},o),w.map((function(e){if(!e)return null;var a=function(t){if(!t.tasks||!Array.isArray(t.tasks))return 60;var e=A.detectOverlaps(t.tasks,p);return Math.max(60,e.length*h+20)}(e);return t.createElement("div",{key:"task-group-".concat(e.id||"unknown"),className:"p-2 border-r border-b border-gantt-border font-medium text-gantt-text bg-gantt-bg hover:bg-gantt-highlight transition-colors duration-150",style:{height:"".concat(a,"px")},onClick:function(){return t=e,void(v&&v(t));var t},"data-testid":"task-group-".concat(e.id||"unknown")},t.createElement("div",{className:"flex items-center"},s&&e.icon&&t.createElement("span",{className:"mr-2",dangerouslySetInnerHTML:{__html:e.icon}}),t.createElement("div",{className:"font-medium truncate"},e.name||"Unnamed")),u&&e.description&&t.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate"},e.description),c&&e.tasks&&e.tasks.length>0&&t.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1"},e.tasks.length," ",1===e.tasks.length?"task":"tasks"))})))},F=function(){function t(t,e,a){void 0===a&&(a=.25);var n=this;this.currentPosition=t,this.targetPosition=e,this.animationSpeed=a,this.animationFrameId=null,this.lastUpdateTime=0,this.velocity={left:0,width:0},this.animate=function(){var t=Date.now(),e=t-n.lastUpdateTime;n.lastUpdateTime=t;var a=Math.max(.1,Math.min(1,n.animationSpeed)),r=n.currentPosition.left+(n.targetPosition.left-n.currentPosition.left)*a,o=n.currentPosition.width+(n.targetPosition.width-n.currentPosition.width)*a;n.velocity.left=(r-n.currentPosition.left)/(e||16),n.velocity.width=(o-n.currentPosition.width)/(e||16),n.currentPosition={left:r,width:o},n.updateCallback&&n.updateCallback(n.currentPosition),n.animationFrameId=requestAnimationFrame(n.animate)}}return t.prototype.startAnimation=function(t){this.updateCallback=t,this.lastUpdateTime=Date.now(),this.animate()},t.prototype.stopAnimation=function(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)},t.prototype.updateTargetPosition=function(t){this.targetPosition=t,null===this.animationFrameId&&this.updateCallback&&this.startAnimation(this.updateCallback)},t}(),H=function(){function t(t,e){this.scrolling=!1,this.speed=0,this.direction=null,this.scrollTimerId=null,this.containerRef=t,this.onChange=e}return t.prototype.checkForScrolling=function(t){var e=this.containerRef.current;if(e){var a=e.getBoundingClientRect(),n=null,r=0;t<a.left+40?(n="left",r=Math.max(1,Math.round((40-(t-a.left))/10))):t>a.right-40&&(n="right",r=Math.max(1,Math.round((t-(a.right-40))/10))),this.direction=n,this.speed=r,n&&!this.scrolling?this.startScrolling():!n&&this.scrolling&&this.stopScrolling()}},t.prototype.startScrolling=function(){var t=this;if(!this.scrolling){this.scrolling=!0,this.onChange&&this.onChange(!0);var e=function(){if(t.scrolling&&t.containerRef.current){var a=t.containerRef.current,n=a.scrollLeft,r=a.scrollWidth-a.clientWidth;if("left"===t.direction){if(n<=0)return void t.stopScrolling();a.scrollLeft=Math.max(0,n-t.speed)}else if("right"===t.direction){if(n>=r)return void t.stopScrolling();a.scrollLeft=Math.min(r,n+t.speed)}t.scrolling&&(t.scrollTimerId=requestAnimationFrame(e))}};this.scrollTimerId=requestAnimationFrame(e)}},t.prototype.stopScrolling=function(){this.scrolling=!1,this.onChange&&this.onChange(!1),null!==this.scrollTimerId&&(cancelAnimationFrame(this.scrollTimerId),this.scrollTimerId=null)},t}(),O=function(){function t(t,e,a){this.state={hoveredTask:null,draggingTask:null,dragType:null,dragStartX:0,tooltipPosition:{x:0,y:0},previewTask:null,initialTaskState:null},this.taskGroup=t,this.viewMode=e,this.updateCallback=a}return t.prototype.getTaskRows=function(){return this.state.previewTask?A.getPreviewArrangement(this.state.previewTask,this.taskGroup.tasks,this.viewMode):A.detectOverlaps(this.taskGroup.tasks,this.viewMode)},t.prototype.getState=function(){return this.state},t.prototype.updateState=function(t){this.state=y(y({},this.state),t),this.updateCallback(this.state)},t.prototype.startTaskDrag=function(t,e,a,n,r){this.updateState({draggingTask:t,dragType:e,dragStartX:a,previewTask:t,initialTaskState:{left:n,width:r,startDate:new Date(t.startDate),endDate:new Date(t.endDate)}})},t.prototype.endTaskDrag=function(){this.updateState({draggingTask:null,dragType:null,previewTask:null,initialTaskState:null})},t.prototype.setHoveredTask=function(t,e){var a={hoveredTask:t};e&&(a.tooltipPosition=e),this.updateState(a)},t.prototype.updatePreviewTask=function(t){this.updateState({previewTask:t})},t}(),L=function(o){var i,s=o.taskGroup,l=o.startDate,c=o.endDate,d=o.totalMonths,u=o.monthWidth,g=o.editMode,h=void 0===g||g,m=o.showProgress,f=void 0!==m&&m,v=o.className,p=void 0===v?"":v,w=o.tooltipClassName,k=void 0===w?"":w,D=o.onTaskUpdate,M=o.onTaskClick,E=o.onTaskSelect,b=o.onAutoScrollChange,x=o.viewMode,N=void 0===x?T.MONTH:x,A=o.scrollContainerRef,Y=o.smoothDragging,R=void 0===Y||Y;o.movementThreshold;var L=o.animationSpeed,W=void 0===L?.25:L,I=o.renderTask,U=o.renderTooltip,z=o.getTaskColor;if(!s||!s.id||!Array.isArray(s.tasks))return t.createElement("div",{className:"relative h-16 text-gantt-text"},"Invalid task group data");var K=l instanceof Date?l:new Date,Q=c instanceof Date?c:new Date,V=a({hoveredTask:null,draggingTask:null,dragType:null,dragStartX:0,tooltipPosition:{x:0,y:0},previewTask:null,initialTaskState:null}),q=V[0],G=V[1],X=e(null),B=e(null),j=e("task-row-".concat(Math.random().toString(36).substring(2,11))),_=e(new O(s,N,G)).current,J=e(new H(A,b)).current,Z=e(null),$=_.getTaskRows(),tt=Math.max(60,40*$.length+20),et=R&&N!==T.DAY,at=r((function(t,e){if(q.draggingTask)try{var a=S.calculateDatesFromPosition(t,e,K,Q,d,u,N),n=a.newStartDate,r=a.newEndDate,o=S.createUpdatedTask(q.draggingTask,n,r);_.updatePreviewTask(o)}catch(t){console.error("Error updating dates:",t)}}),[q.draggingTask,K,Q,d,u,N]),nt=r((function(){if(B.current&&q.initialTaskState&&q.draggingTask){var t=q.previewTask;if(t){var e=K.getTime(),a=Q.getTime();if(t.startDate.getTime()<e&&(t=y(y({},t),{startDate:new Date(e)})),t.endDate.getTime()>a&&(t=y(y({},t),{endDate:new Date(a)})),D&&t)try{D(s.id,t)}catch(t){console.error("Error in onTaskUpdate:",t)}}}}),[q,K,Q,D,s.id]),rt=r((function(t,e){M&&!q.draggingTask&&M(e,s),E&&E(e,!0)}),[M,E,q.draggingTask,s]),ot=r((function(t,e){if(!q.draggingTask&&X.current){var a=X.current.getBoundingClientRect();_.setHoveredTask(e,{x:t.clientX-a.left+20,y:t.clientY-a.top})}}),[q.draggingTask,_]),it=r((function(){q.draggingTask||_.setHoveredTask(null)}),[q.draggingTask,_]),st=r((function(t,e,a){if(h){t.preventDefault(),t.stopPropagation();var n=document.querySelector('[data-task-id="'.concat(e.id,'"][data-instance-id="').concat(j.current,'"]'));if(n){B.current=n;var r=parseFloat(n.style.left||"0"),o=parseFloat(n.style.width||"0");n.setAttribute("data-dragging","true"),n.style.transition="none",_.startTaskDrag(e,a,t.clientX,r,o),et&&(Z.current=new F({left:r,width:o},{left:r,width:o},W),Z.current.startAnimation((function(t){B.current&&(B.current.style.left="".concat(t.left,"px"),B.current.style.width="".concat(t.width,"px"),at(t.left,t.width))}))),document.addEventListener("mouseup",ct),document.addEventListener("mousemove",lt)}}}),[h,et,W,at]),lt=r((function(t){var e=(MouseEvent,t.clientX),a=(MouseEvent,t.clientY);if(t instanceof MouseEvent&&q.hoveredTask&&X.current){var n=X.current.getBoundingClientRect();_.setHoveredTask(q.hoveredTask,{x:e-n.left+20,y:a-n.top})}if(q.draggingTask&&(null==A?void 0:A.current)&&J.checkForScrolling(e),q.draggingTask&&q.dragType&&q.initialTaskState&&X.current)try{var r=e-q.dragStartX,o=d*u,i=q.initialTaskState.left,s=q.initialTaskState.width;switch(q.dragType){case"move":i=Math.max(0,Math.min(o-q.initialTaskState.width,q.initialTaskState.left+r)),N===T.DAY&&(i=Math.round(i/u)*u);break;case"resize-left":var l=q.initialTaskState.width-20,c=Math.min(l,r);i=Math.max(0,q.initialTaskState.left+c),N===T.DAY&&(i=Math.round(i/u)*u);var g=q.initialTaskState.left+q.initialTaskState.width;s=Math.max(20,g-i),N===T.DAY&&(s=Math.round(s/u)*u,s=Math.max(u,s));break;case"resize-right":s=Math.max(20,Math.min(o-q.initialTaskState.left,q.initialTaskState.width+r)),N===T.DAY&&(s=Math.round(s/u)*u,s=Math.max(u,s))}N===T.DAY&&B.current?(B.current.style.left="".concat(i,"px"),B.current.style.width="".concat(s,"px"),at(i,s)):et&&Z.current?Z.current.updateTargetPosition({left:i,width:s}):B.current&&(B.current.style.left="".concat(i,"px"),B.current.style.width="".concat(s,"px"),at(i,s))}catch(t){console.error("Error in handleMouseMove:",t)}}),[q,A,_,u,d,N,et,at]),ct=r((function(){try{Z.current&&(Z.current.stopAnimation(),Z.current=null),nt(),B.current&&(B.current.setAttribute("data-dragging","false"),setTimeout((function(){B.current&&(B.current.style.transition="")}),200))}finally{J.stopScrolling(),_.endTaskDrag(),B.current=null,document.removeEventListener("mouseup",ct),document.removeEventListener("mousemove",lt)}}),[nt,_,J]),dt=r((function(t,e){if(D&&s.id)try{var a=y(y({},t),{percent:e});D(s.id,a)}catch(t){console.error("Error updating task progress:",t)}}),[D,s.id]);return n((function(){return function(){document.removeEventListener("mouseup",ct),document.removeEventListener("mousemove",lt),J.stopScrolling(),Z.current&&Z.current.stopAnimation()}}),[ct,lt,J]),s.tasks&&0!==s.tasks.length?t.createElement("div",{className:"relative border-b border-gantt-border ".concat(p),style:{height:"".concat(tt,"px")},onMouseMove:function(t){return lt(t)},onMouseLeave:it,ref:X,"data-testid":"task-row-".concat(s.id),"data-instance-id":j.current},$.map((function(e,a){return t.createElement(t.Fragment,{key:"task-row-".concat(a)},e.map((function(e){var n,r;try{if(!(e&&e.id&&e.startDate instanceof Date&&e.endDate instanceof Date))return null;var o=S.calculateTaskPixelPosition(e,K,Q,d,u,N),i=o.leftPx,s=o.widthPx,l=(null===(n=q.hoveredTask)||void 0===n?void 0:n.id)===e.id,c=(null===(r=q.draggingTask)||void 0===r?void 0:r.id)===e.id,g=40*a+10;return t.createElement(C,{key:"task-".concat(e.id),task:e,leftPx:i,widthPx:s,topPx:g,isHovered:l,isDragging:c,editMode:h,showProgress:f,instanceId:j.current,onMouseDown:st,onMouseEnter:ot,onMouseLeave:it,onClick:rt,renderTask:I,getTaskColor:z,onProgressUpdate:dt})}catch(t){return console.error("Error rendering task:",t),null}})))})),(q.hoveredTask||q.draggingTask)&&t.createElement(P,{task:q.previewTask||q.draggingTask||q.hoveredTask,position:q.tooltipPosition,dragType:q.dragType,taskId:null===(i=q.draggingTask)||void 0===i?void 0:i.id,startDate:K,endDate:Q,totalMonths:d,monthWidth:u,showProgress:f,instanceId:j.current,className:k,viewMode:N,renderTooltip:U})):t.createElement("div",{className:"relative h-16 text-gantt-text"},"No tasks available")},W=function(r){var o=r.tasks,i=void 0===o?[]:o,s=r.startDate,l=r.endDate,c=r.title,d=void 0===c?"Project Timeline":c,u=r.currentDate,g=void 0===u?new Date:u,h=r.showCurrentDateMarker,m=void 0===h||h,f=r.todayLabel,M=void 0===f?"Today":f,A=r.editMode,S=void 0===A||A,P=r.headerLabel,C=void 0===P?"Resources":P,F=r.showProgress,H=void 0!==F&&F,O=r.darkMode,W=void 0!==O&&O,I=r.locale,U=void 0===I?"default":I,z=r.styles,K=void 0===z?{}:z,Q=r.viewMode,V=void 0===Q?T.MONTH:Q,q=r.showViewModeSelector,G=void 0===q||q,X=r.smoothDragging,B=void 0===X||X,j=r.movementThreshold,_=void 0===j?3:j,J=r.animationSpeed,Z=void 0===J?.25:J,$=r.renderTaskList,tt=r.renderTask,et=r.renderTooltip,at=r.renderViewModeSelector,nt=r.renderHeader,rt=r.renderTimelineHeader,ot=r.getTaskColor,it=r.onTaskUpdate,st=r.onTaskClick,lt=r.onTaskSelect;r.onTaskDoubleClick;var ct=r.onGroupClick,dt=r.onViewModeChange,ut=r.fontSize,gt=r.rowHeight,ht=void 0===gt?40:gt;r.timeStep;var mt=e(null),ft=e(null),vt=a(V),pt=vt[0],wt=vt[1],kt=a([]);kt[0];var Dt=kt[1],Tt=a(150),Mt=Tt[0],yt=Tt[1],Et=a(!1),bt=Et[0],xt=Et[1],Nt=s||function(t){if(!Array.isArray(t)||0===t.length)return new Date;var e=new Date,a=!1;if(t.forEach((function(t){t&&Array.isArray(t.tasks)&&t.tasks.forEach((function(t){t&&t.startDate instanceof Date&&(a?t.startDate<e&&(e=new Date(t.startDate)):(e=new Date(t.startDate),a=!0))}))})),!a){var n=new Date;return new Date(n.getFullYear(),n.getMonth()-1,1)}return new Date(e.getFullYear(),e.getMonth(),1)}(i),At=l||function(t){if(!Array.isArray(t)||0===t.length)return new Date;var e=new Date,a=!1;if(t.forEach((function(t){t&&Array.isArray(t.tasks)&&t.tasks.forEach((function(t){t&&t.endDate instanceof Date&&(a?t.endDate>e&&(e=new Date(t.endDate)):(e=new Date(t.endDate),a=!0))}))})),!a){var n=new Date;return new Date(n.getFullYear(),n.getMonth()+2,0)}return new Date(e.getFullYear(),e.getMonth()+1,0)}(i),St=function(t,e){var a=[],n=new Date(t);n.setHours(0,0,0,0);var r=new Date(e);for(r.setHours(23,59,59,999);n<=r;)a.push(new Date(n)),n=v(n,1);return a},Pt=function(t,e){for(var a=[],n=new Date(t);n<=e;)a.push(new Date(n)),n=v(n,7);return a},Yt=function(t,e){for(var a=[],n=p(new Date(t));n<=e;)a.push(new Date(n)),n=w(n,1);return a},Ct=function(t,e){for(var a=[],n=k(new Date(t));n<=e;)a.push(new Date(n)),n=D(n,1);return a},Rt=function(){switch(pt){case T.DAY:return St(Nt,At);case T.WEEK:return Pt(Nt,At);case T.MONTH:return b(Nt,At);case T.QUARTER:return Yt(Nt,At);case T.YEAR:return Ct(Nt,At);default:return b(Nt,At)}}(),Ft=Rt.length,Ht=function(){var t=new Date;switch(pt){case T.DAY:return Rt.findIndex((function(e){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}));case T.WEEK:return Rt.findIndex((function(e){var a=new Date(e);return a.setDate(e.getDate()+6),t>=e&&t<=a}));case T.MONTH:return Rt.findIndex((function(e){return e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}));case T.QUARTER:var e=Math.floor(t.getMonth()/3);return Rt.findIndex((function(a){return Math.floor(a.getMonth()/3)===e&&a.getFullYear()===t.getFullYear()}));case T.YEAR:return Rt.findIndex((function(e){return e.getFullYear()===t.getFullYear()}));default:return-1}}(),Ot=function(t){xt(t),ft.current&&(t?ft.current.classList.add("rmg-auto-scrolling"):ft.current.classList.remove("rmg-auto-scrolling"))},Lt=function(t,e){if(it)try{var a=y(y({},e),{startDate:e.startDate instanceof Date?e.startDate:new Date(e.startDate),endDate:e.endDate instanceof Date?e.endDate:new Date(e.endDate)});it(t,a)}catch(t){console.error("Error in handleTaskUpdate:",t)}},Wt=function(t,e){if(st)try{st(t,e)}catch(t){console.error("Error in handleTaskClick:",t)}},It=function(t,e){if(Dt((function(a){return e?E(E([],a,!0),[t.id],!1):a.filter((function(e){return e!==t.id}))})),lt)try{lt(t,e)}catch(t){console.error("Error in onTaskSelect handler:",t)}},Ut=function(t){switch(wt(t),t){case T.DAY:yt(50);break;case T.WEEK:yt(80);break;case T.MONTH:yt(150);break;case T.QUARTER:yt(180);break;case T.YEAR:yt(200);break;default:yt(150)}dt&&dt(t)};n((function(){Ut(V)}),[V]),n((function(){if(mt.current){var t=Math.max(.1,Math.min(1,Z||.25));mt.current.style.setProperty("--rmg-animation-speed",t.toString())}}),[Z,mt.current]);var zt,Kt={fontSize:ut||"inherit"},Qt=W?"dark":"",Vt=y(y({},{container:"",title:"",header:"",taskList:"",timeline:"",taskRow:"",todayMarker:"",tooltip:""}),K);return t.createElement("div",{ref:mt,className:"rmg-gantt-chart w-full bg-gantt-bg text-gantt-text rounded-xl shadow-lg overflow-hidden ".concat(Qt," ").concat(Vt.container),style:y(y({},Kt),{"--gantt-unit-width":"".concat(Mt,"px")}),"data-testid":"gantt-chart"},nt?nt({title:d,darkMode:W,viewMode:pt,onViewModeChange:Ut,showViewModeSelector:G}):t.createElement("div",{className:"p-6 border-b border-gantt-border"},t.createElement("div",{className:"flex justify-between items-center"},t.createElement("h1",{className:"text-2xl font-bold text-gantt-text ".concat(Vt.title)},d),G&&t.createElement("div",{className:"flex space-x-2"},at?at({activeMode:pt,onChange:Ut,darkMode:W,availableModes:[T.DAY,T.WEEK,T.MONTH,T.QUARTER,T.YEAR]}):t.createElement(Y,{activeMode:pt,onChange:Ut,darkMode:W})))),t.createElement("div",{className:"relative flex"},$?$({tasks:i,headerLabel:C,onGroupClick:ct,viewMode:pt}):t.createElement(R,{tasks:i,headerLabel:C,onGroupClick:ct,className:Vt.taskList,viewMode:pt}),t.createElement("div",{ref:ft,className:"flex-grow overflow-x-auto rmg-gantt-scroll-container ".concat(bt?"rmg-auto-scrolling":"")},t.createElement("div",{className:"min-w-max"},rt?rt({timeUnits:Rt,currentUnitIndex:Ht,viewMode:pt,locale:U,unitWidth:Mt}):t.createElement(x,{months:Rt,currentMonthIndex:Ht,locale:U,className:Vt.timeline,viewMode:pt,unitWidth:Mt}),t.createElement("div",{className:"relative"},m&&Ht>=0&&t.createElement(N,{currentMonthIndex:Ht,height:(zt=0,i.forEach((function(t){t&&Array.isArray(t.tasks)?zt+=Math.max(60,1*ht+20):zt+=60})),zt),label:M,dayOfMonth:g.getDate(),className:Vt.todayMarker,viewMode:pt,unitWidth:Mt}),i.map((function(e){return e&&e.id?t.createElement(L,{key:"task-row-".concat(e.id),taskGroup:e,startDate:Nt,endDate:At,totalMonths:Ft,monthWidth:Mt,editMode:S,showProgress:H,onTaskUpdate:Lt,onTaskClick:Wt,onTaskSelect:It,onAutoScrollChange:Ot,className:Vt.taskRow,tooltipClassName:Vt.tooltip,viewMode:pt,scrollContainerRef:ft,smoothDragging:B,movementThreshold:_,animationSpeed:Z,renderTask:tt,renderTooltip:et,getTaskColor:ot}):null})))))))};export{W as GanttChart,C as TaskItem,R as TaskList,L as TaskRow,x as Timeline,N as TodayMarker,P as Tooltip,Y as ViewModeSelector};
//# sourceMappingURL=index.esm.js.map
