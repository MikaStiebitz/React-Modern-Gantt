import e,{useState as t,useRef as n,useEffect as a}from"react";var r,o=function(){return o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};function l(e,t,n){if(n||2===arguments.length)for(var a,r=0,o=t.length;r<o;r++)!a&&r in t||(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.MONTH_YEAR="month-year",e.FULL_DATE="full-date",e.SHORT_DATE="short-date"}(r||(r={}));var i={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function c(e){return e.toLocaleString("default",{month:"short"})}function s(e,t){switch(void 0===t&&(t=r.FULL_DATE),t){case r.MONTH_YEAR:return e.toLocaleString("default",{month:"short",year:"2-digit"});case r.SHORT_DATE:return e.toLocaleString("default",{month:"short",day:"numeric"});case r.FULL_DATE:default:return e.toLocaleString("default",{month:"short",day:"numeric",year:"numeric"})}}function d(e,t){for(var n=[],a=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),l=t.getMonth(),i=a;i<=o;i++)for(var c=i===o?l:11,s=i===a?r:0;s<=c;s++)n.push(new Date(i,s,1));return n}function u(e,t){return new Date(e,t+1,0).getDate()}function m(){return[1,8,15,22,29]}function g(e,t,n){var a=d(new Date(t.getFullYear(),t.getMonth(),1),new Date(n.getFullYear(),n.getMonth()+1,0)),r=a.length,o=e.startDate.getFullYear(),l=e.startDate.getMonth(),i=a.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===l})),c=i<0?0:i,s=e.endDate.getFullYear(),u=e.endDate.getMonth(),m=a.findIndex((function(e){return e.getFullYear()===s&&e.getMonth()===u})),g=((m<0?a.length-1:m)-c+1)/r*100;return{left:"".concat(c/r*100,"%"),width:"".concat(g,"%")}}function f(e){var t=l([],e,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),n=[];return t.forEach((function(e){for(var t=!1,a=0;a<n.length;a++){if(n[a].every((function(t){return e.startDate>=t.endDate||e.endDate<=t.startDate}))){n[a].push(e),t=!0;break}}t||n.push([e])})),n}function h(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function v(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}var p=function(a){var r=a.people,l=a.startDate,c=a.endDate,s=a.title,u=void 0===s?"Project Timeline":s,m=a.currentDate,p=void 0===m?new Date:m,w=a.showCurrentDateMarker,b=void 0===w||w,y=a.editMode,E=void 0===y||y,x=a.theme,M=void 0===x?i:x,k=a.onTaskUpdate,T=a.onTaskClick,N=t(null),F=N[0],S=N[1],L=t({x:0,y:0}),Y=L[0],z=L[1],C=t(null),P=C[0],X=C[1],A=t(null),O=A[0],R=A[1],B=t(0),I=B[0],_=B[1],j=n(null),H=l||h(r),U=c||v(r),q=d(H,U),W=q.length,G=p.getMonth(),J=p.getFullYear(),K=q.findIndex((function(e){return e.getMonth()===G&&e.getFullYear()===J})),Q=function(){P||S(null)},V=function(e,t,n,a){E&&(e.preventDefault(),e.stopPropagation(),X({task:t,person:n}),R(a),_(e.clientX),document.addEventListener("mouseup",Z))},Z=function(){if(P&&O&&j.current){var e=document.querySelector('[data-task-id="'.concat(P.task.id,'"]'));if(e){var t=parseFloat(e.style.left),n=parseFloat(e.style.width),a=Math.floor(t/100*W),r=Math.ceil(n/100*W);if(a>=0&&a<q.length){var l=q[a],i=a+r-1;i>=q.length&&(i=q.length-1);var c=q[i],s=new Date(l.getFullYear(),l.getMonth(),Math.min(P.task.startDate.getDate(),D(l.getFullYear(),l.getMonth()))),d=new Date(c.getFullYear(),c.getMonth(),Math.min(P.task.endDate.getDate(),D(c.getFullYear(),c.getMonth()))),u=o(o({},P.task),{startDate:s,endDate:d});k&&k(P.person.id,u)}}}X(null),R(null),document.removeEventListener("mouseup",Z)};M.headerBackground,M.headerText,M.borderColor;var $,ee=M.backgroundHighlight||"bg-blue-50",te=M.todayMarkerColor||"bg-red-500";return e.createElement("div",{ref:j,className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart",onMouseMove:function(e){if(F&&z({x:e.clientX,y:e.clientY}),P&&O&&j.current){var t=j.current.getBoundingClientRect(),n=(e.clientX-I)/t.width*100,a=document.querySelector('[data-task-id="'.concat(P.task.id,'"]'));if(!a)return;var r=parseFloat(a.style.left),o=parseFloat(a.style.width);if(P.task.endDate.getTime(),P.task.startDate.getTime(),"move"===O){var l=Math.max(0,Math.min(100-o,r+n));a.style.left="".concat(l,"%")}else if("resize-left"===O){var i=o-5,c=Math.min(i,n),s=(l=Math.max(0,r+c),Math.max(5,o-c));a.style.left="".concat(l,"%"),a.style.width="".concat(s,"%")}else if("resize-right"===O){s=Math.max(5,Math.min(100-r,o+n));a.style.width="".concat(s,"%")}_(e.clientX)}}},e.createElement("div",{className:"p-6 border-b border-gray-200"},e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},u)),e.createElement("div",{className:"p-4"},e.createElement("div",{className:"flex border-b border-gray-200"},e.createElement("div",{className:"w-40 flex-shrink-0 p-2 font-semibold text-gray-700 border-r border-gray-200"},"Team Member"),e.createElement("div",{className:"flex-grow flex"},q.map((function(t,n){return e.createElement("div",{key:n,className:"flex-1 p-2 font-semibold text-center ".concat(n===K?ee:""),"data-month":t.toISOString()},t.toLocaleString("default",{month:"short",year:"2-digit"}))})))),e.createElement("div",{className:"relative"},b&&K>=0&&e.createElement("div",{className:"absolute top-0 w-px ".concat(te," z-10"),style:{left:"".concat((K+.5)/q.length*100,"%"),height:"".concat(($=0,r.forEach((function(e){var t=f(e.tasks);$+=Math.max(60,30*t.length+15)})),$),"px")},"data-testid":"today-marker"},e.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(te," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},"Today")),r.map((function(t){var n=f(t.tasks),a=Math.max(60,30*n.length+15);return e.createElement("div",{key:t.id,className:"flex border-b border-gray-200 hover:bg-gray-50","data-testid":"person-row-".concat(t.id)},e.createElement("div",{className:"w-40 flex-shrink-0 p-2 border-r border-gray-200",style:{height:"".concat(a,"px")}},e.createElement("div",{className:"font-medium"},t.name),t.role&&e.createElement("div",{className:"text-xs text-gray-500"},t.role)),e.createElement("div",{className:"flex-grow relative",style:{height:"".concat(a,"px")}},n.map((function(n,a){return e.createElement(e.Fragment,{key:a},n.map((function(n){var r=g(n,H,U),o=r.left,l=r.width,i=(null==F?void 0:F.task.id)===n.id,c=(null==P?void 0:P.task.id)===n.id,s=(i||c)&&E;return e.createElement("div",{key:n.id,className:"absolute h-8 rounded ".concat(n.color," flex items-center px-2 text-xs text-white font-medium ").concat(E?"cursor-move":"cursor-pointer"),style:{left:o,width:l,top:"".concat(30*a+15,"px")},onClick:function(e){return function(e,t,n){T&&!P&&T(t,n)}(0,n,t)},onMouseDown:function(e){return V(e,n,t,"move")},onMouseEnter:function(e){return function(e,t,n){P||(S({task:t,person:n}),z({x:e.clientX,y:e.clientY}))}(e,n,t)},onMouseLeave:Q,"data-testid":"task-".concat(n.id),"data-task-id":n.id},s&&e.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-l",onMouseDown:function(e){e.stopPropagation(),V(e,n,t,"resize-left")}}),e.createElement("div",{className:"truncate"},n.name),void 0!==n.percent&&e.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 rounded-full overflow-hidden"},e.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(n.percent,"%")}})),s&&e.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-r",onMouseDown:function(e){e.stopPropagation(),V(e,n,t,"resize-right")}}))})))}))))})))),F&&!P&&e.createElement("div",{className:"fixed z-50 bg-white shadow-lg rounded-md border border-gray-200 p-3 text-xs",style:{left:"".concat(Y.x+10,"px"),top:"".concat(Y.y-80,"px"),minWidth:"200px"}},e.createElement("div",{className:"font-bold mb-1 text-sm"},F.task.name),e.createElement("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1"},e.createElement("div",{className:"font-semibold"},"Start:"),e.createElement("div",null,F.task.startDate.toLocaleDateString()),e.createElement("div",{className:"font-semibold"},"End:"),e.createElement("div",null,F.task.endDate.toLocaleDateString()),void 0!==F.task.percent&&e.createElement(e.Fragment,null,e.createElement("div",{className:"font-semibold"},"Progress:"),e.createElement("div",null,F.task.percent,"%")))))};function D(e,t){return new Date(e,t+1,0).getDate()}function w(r){var i=r.person,c=r.startDate,s=r.endDate;r.totalDays;var d=r.onTaskUpdate,u=r.editMode,m=void 0===u||u,g=t(null),f=g[0],h=g[1],v=t(null),p=v[0],D=v[1],w=t(0),b=w[0],y=w[1],E=t(null),x=E[0],M=E[1],k=t({x:0,y:0}),T=k[0],N=k[1],F=n(null),S=function(e){return e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},L=function(e,t,n){m&&(e.preventDefault(),e.stopPropagation(),h(t),D(n),y(e.clientX),C(e),document.addEventListener("mouseup",z),document.addEventListener("mousemove",Y),console.log("Mouse down on task ".concat(t.id," with type ").concat(n)))},Y=function(e){var t,n;if(e instanceof MouseEvent&&"mousemove"===e.type){var a=e;x&&N({x:a.clientX-((null===(t=F.current)||void 0===t?void 0:t.getBoundingClientRect().left)||0)+20,y:a.clientY-((null===(n=F.current)||void 0===n?void 0:n.getBoundingClientRect().top)||0)})}else C(e);if(f&&p&&F.current){var r=F.current.getBoundingClientRect(),l=(e.clientX-b)/r.width*(s.getTime()-c.getTime()),u=new Date(f.startDate),m=new Date(f.endDate),g=f.percent;if("move"===p)u=new Date(u.getTime()+l),m=new Date(m.getTime()+l);else if("resize-start"===p)u=new Date(u.getTime()+l);else if("resize-end"===p)m=new Date(m.getTime()+l);else if("adjust-progress"===p&&void 0!==f.percent){var v=document.querySelectorAll('[data-task-id="'.concat(f.id,'"]'));if(v.length>0){var D=v[0].getBoundingClientRect(),w=D.width,E=e.clientX-D.left;g=Math.max(0,Math.min(100,E/w*100))}}if(u<c&&(u=new Date(c),"move"===p)){var M=f.endDate.getTime()-f.startDate.getTime();m=new Date(u.getTime()+M)}if(m>s&&(m=new Date(s),"move"===p)){M=f.endDate.getTime()-f.startDate.getTime();u=new Date(m.getTime()-M)}m<u&&("resize-start"===p?u=new Date(m):m=new Date(u));var k=o(o({},f),{startDate:u,endDate:m,percent:g});h(k),d(i.id,k),y(e.clientX),console.log("Task updated during drag: Start=".concat(u.toISOString(),", End=").concat(m.toISOString()))}},z=function(){f&&p&&(d(i.id,f),console.log("Mouse up - Task updated: ".concat(f.id))),h(null),D(null),document.removeEventListener("mouseup",z),document.removeEventListener("mousemove",Y)},C=function(e){if(F.current){var t=F.current.getBoundingClientRect();N({x:e.clientX-t.left+20,y:e.clientY-t.top})}};a((function(){return function(){document.removeEventListener("mouseup",z),document.removeEventListener("mousemove",Y)}}),[]);var P,X,A,O=(P=i.tasks,X=l([],P,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),A=[],X.forEach((function(e){for(var t=!1,n=0;n<A.length;n++){for(var a=!0,r=0,o=A[n];r<o.length;r++){var l=o[r];if(!(e.endDate<=l.startDate||e.startDate>=l.endDate)){a=!1;break}}if(a){A[n].push(e),t=!0;break}}t||A.push([e])})),A),R=Math.max(60,40*O.length);return i&&i.tasks&&0!==i.tasks.length?e.createElement("div",{className:"relative select-none",style:{height:"".concat(R,"px")},onMouseMove:function(e){return Y(e)},onMouseLeave:function(){return M(null)},ref:F},O.map((function(t,n){return t.map((function(t){var a,r,o,l=function(e){var t=e.startDate.getTime(),n=e.endDate.getTime(),a=c.getTime(),r=s.getTime()-a,o=Math.max(0,t-a)/r,l=Math.min(1,(n-a)/r)-o;return{left:"".concat(100*o,"%"),width:"".concat(100*l,"%")}}(t),i=l.left,d=l.width,u=x===t,g=f===t,h=(u||g)&&m;return e.createElement(e.Fragment,{key:t.id},e.createElement("div",{className:"absolute h-8 rounded-md ".concat(t.color," z-10 flex items-center justify-between text-xs text-white font-semibold ").concat(m?"cursor-move":"cursor-default"," task-bar select-none"),"data-task-id":t.id,style:{left:i,width:d,top:"".concat(40*n+4,"px")},onMouseDown:m?function(e){return function(e,t){m&&(e.preventDefault(),e.stopPropagation(),console.log("Direct task div mousedown on ".concat(t.id)),L(e,t,"move"))}(e,t)}:void 0,onMouseEnter:function(){return M(t)}},e.createElement("div",{className:"truncate px-2 py-1 flex-grow"},t.name),h&&e.createElement("div",{className:"absolute left-0 w-1.5 h-[90%] bg-white rounded-md cursor-ew-resize",onMouseDown:function(e){e.stopPropagation(),L(e,t,"resize-start")}}),h&&e.createElement("div",{className:"absolute right-0 w-1.5 h-[90%] bg-white rounded-md cursor-ew-resize",onMouseDown:function(e){e.stopPropagation(),L(e,t,"resize-end")}}),void 0!==t.percent&&e.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1.5 bg-black bg-opacity-20 rounded-full overflow-hidden"},e.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(t.percent,"%")}}),h&&e.createElement("div",{className:"absolute top-1/2 h-3 w-3 bg-white rounded-full -translate-y-1/2 cursor-ew-resize border border-gray-400",style:{left:"calc(".concat(t.percent,"% - 4px)")},onMouseDown:function(e){e.stopPropagation(),L(e,t,"adjust-progress")}}))),(u||g)&&e.createElement("div",{className:"absolute z-20 bg-white border border-gray-200 rounded-md shadow-md p-2 text-xs select-none",style:{left:"".concat(T.x,"px"),top:"".concat(T.y-40,"px")}},e.createElement("div",{className:"font-bold"},t.name),e.createElement("div",null,"Start: ",S(t.startDate)),e.createElement("div",null,"End: ",S(t.endDate)),e.createElement("div",null,"Duration: ",(a=t.startDate,r=t.endDate,o=Math.abs(r.getTime()-a.getTime()),Math.ceil(o/864e5))," days"),void 0!==t.percent&&e.createElement("div",null,"Progress: ",Math.round(t.percent),"%")))}))}))):e.createElement("div",{className:"relative h-16"},"No tasks available")}export{i as DEFAULT_THEME,r as DateDisplayFormat,p as GanttChart,w as TaskRow,g as calculateTaskPosition,f as detectTaskOverlaps,h as findEarliestDate,v as findLatestDate,s as formatDate,c as formatMonth,u as getDaysInMonth,d as getMonthsBetween,m as getStandardDayMarkers};
//# sourceMappingURL=index.esm.js.map
