"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("date-fns");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n,r,o=a(e),i=function(){return i=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)};function s(e,t,a){if(a||2===arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}function l(e,t){var a=[];if(!(e instanceof Date&&t instanceof Date))return[new Date];for(var n=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),i=t.getMonth(),s=n;s<=o;s++)for(var l=s===o?i:11,c=s===n?r:0;c<=l;c++)a.push(new Date(s,c,1));return a}"function"==typeof SuppressedError&&SuppressedError,function(e){e.DAY="day",e.WEEK="week",e.MONTH="month",e.QUARTER="quarter",e.YEAR="year"}(n||(n={})),function(e){e.MONTH_YEAR="month-year",e.FULL_DATE="full-date",e.SHORT_DATE="short-date"}(r||(r={}));var c=function(e){var a=e.months,r=e.currentMonthIndex,i=(e.locale,e.className),s=void 0===i?"":i,l=e.viewMode,c=void 0===l?n.MONTH:l,d=e.unitWidth,u=void 0===d?150:d,f=[n.DAY,n.WEEK].includes(c),g=function(){if(![n.DAY,n.WEEK].includes(c)||0===a.length)return[];var e=[],t=new Date(a[0]),r=0;return a.forEach((function(a){a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()?r+=1:(e.push({date:t,span:r}),t=new Date(a),r=1)})),r>0&&e.push({date:t,span:r}),e}();return o.default.createElement("div",{className:"rmg-timeline ".concat(s),style:{"--gantt-unit-width":"".concat(u,"px")}},f&&o.default.createElement("div",{className:"flex border-b border-gantt-border"},g.map((function(e,a){return o.default.createElement("div",{key:"higher-level-".concat(a),className:"flex-shrink-0 p-2 font-semibold text-center text-gantt-text border-r border-gantt-border h-10",style:{width:"".concat(e.span*u,"px")},"data-timeunit-higher":e.date.toISOString()},function(e){if(!(e instanceof Date))return"";switch(c){case n.DAY:case n.WEEK:}return t.format(e,"MMM yyyy",{locale:void 0})}(e.date))}))),o.default.createElement("div",{className:"flex border-b border-gantt-border"},a.map((function(e,a){return o.default.createElement("div",{key:"timeunit-".concat(a),className:"".concat("w-[var(--gantt-unit-width)]"," flex-shrink-0 p-2 font-semibold text-center text-gantt-text ").concat(a===r?"bg-gantt-highlight":""," ").concat(f?"border-r border-gantt-border":""," h-10"),"data-timeunit":e.toISOString()},function(e){if(!(e instanceof Date&&t.isValid(e)))return"";switch(c){case n.DAY:return t.format(e,"d",{locale:void 0});case n.WEEK:var a=t.getWeek(e);return"W".concat(a);case n.MONTH:return t.format(e,"MMM yyyy",{locale:void 0});case n.QUARTER:var r=Math.floor(e.getMonth()/3)+1;return"Q".concat(r," ").concat(e.getFullYear());case n.YEAR:return e.getFullYear().toString();default:return t.format(e,"MMM yyyy",{locale:void 0})}}(e))}))))},d=function(e){var t=e.currentMonthIndex,a=e.height,r=e.markerClass,i=void 0===r?"bg-red-500":r,s=e.label,l=void 0===s?"Today":s,c=e.dayOfMonth,d=e.className,u=void 0===d?"":d,f=e.viewMode,g=void 0===f?n.MONTH:f,h=e.unitWidth,m=void 0===h?150:h;if(t<0)return null;var v=function(){var e=new Date;switch(c||e.getDate(),g){case n.DAY:return t*m+m/2;case n.WEEK:var a=e.getDay();return t*m+m*(a/7);case n.MONTH:var r=e.getDay();return t*m+m*(r/7);case n.QUARTER:var o=e.getMonth()%3;return t*m+m*(o/3);case n.YEAR:var i=e.getMonth();return t*m+m*(i/12);default:return t*m+m/2}}();return o.default.createElement("div",{className:"absolute top-0 w-px ".concat(i," z-10 ").concat(u),style:{left:"".concat(v,"px"),height:"".concat(a,"px")},"data-testid":"today-marker"},o.default.createElement("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 ".concat(i," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},l))},u=function(){function e(){}return e.detectOverlaps=function(e,t){var a=this;if(void 0===t&&(t=n.MONTH),!Array.isArray(e)||0===e.length)return[];var r=s([],e,!0).sort((function(e,t){return e.startDate&&t.startDate?e.startDate.getTime()-t.startDate.getTime():0})),o=[];return r.forEach((function(e){for(var n=!1,r=0;r<o.length;r++){if(!o[r].some((function(n){return a.tasksVisuallyOverlap(e,n,t)}))){o[r].push(e),n=!0;break}}n||o.push([e])})),o},e.tasksVisuallyOverlap=function(e,t,a){if(void 0===a&&(a=n.MONTH),!(e.startDate&&e.endDate&&t.startDate&&t.endDate))return!1;var r=e.startDate.getTime(),o=e.endDate.getTime(),i=t.startDate.getTime(),s=t.endDate.getTime(),l=this.getCollisionBufferByViewMode(a);return r+l<s-l&&o-l>i+l||Math.abs(r-i)<2*l||Math.abs(o-s)<2*l},e.getCollisionBufferByViewMode=function(e){var t=36e5,a=24*t;switch(e){case n.DAY:return t;case n.WEEK:return 4*t;case n.MONTH:return 12*t;case n.QUARTER:return a;case n.YEAR:return 2*a;default:return 12*t}},e.wouldCollide=function(e,t,a,r){var o=this;return void 0===a&&(a=n.MONTH),t.some((function(t){return t.id!==e.id&&t.id!==r&&o.tasksVisuallyOverlap(e,t,a)}))},e.getPreviewArrangement=function(e,t,a){void 0===a&&(a=n.MONTH);var r=t.map((function(t){return t.id===e.id?e:t}));return this.detectOverlaps(r,a)},e}(),f=function(){function e(){}return e.calculateDatesFromPosition=function(e,a,r,o,i,s,l){void 0===l&&(l=n.MONTH);try{var c=isNaN(e)?0:e,d=isNaN(a)||a<20?20:a,u=r.getTime(),f=(o.getTime()-u)/(i*s),g=c*f,h=d*f,m=new Date(u+g),v=new Date(u+g+h);if(l===n.DAY){var p=Math.round(e/s),k=Math.max(1,Math.round(a/s)),w=new Date(r);w.setHours(0,0,0,0),(m=new Date(w)).setDate(w.getDate()+p),m.setHours(0,0,0,0),(v=new Date(m)).setDate(m.getDate()+k-1),v.setHours(23,59,59,999)}else m=t.startOfDay(m),v=t.endOfDay(v);return m<r&&(m=new Date(r)),v>o&&(v=new Date(o)),{newStartDate:m,newEndDate:v}}catch(e){return console.error("Error calculating dates from position:",e),{newStartDate:new Date(r),newEndDate:new Date(o)}}},e.createUpdatedTask=function(e,t,a){return i(i({},e),{startDate:new Date(t),endDate:new Date(a)})},e.calculateTaskPixelPosition=function(e,t,a,r,o,i){var s;void 0===i&&(i=n.MONTH);try{if(!(e.startDate instanceof Date&&e.endDate instanceof Date))throw new Error("Invalid dates in task");var l=t.getTime(),c=a.getTime(),d=Math.max(e.startDate.getTime(),t.getTime()),u=Math.min(e.endDate.getTime(),a.getTime());if(i===n.DAY){var f=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0).getTime(),g=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999).getTime();l=f,c=g;var h=new Date(new Date(d).getFullYear(),new Date(d).getMonth(),new Date(d).getDate(),0,0,0,0).getTime(),m=new Date(new Date(u).getFullYear(),new Date(u).getMonth(),new Date(u).getDate(),23,59,59,999).getTime();d=h,u=m}var v=c-l,p=r*o,k=(d-l)/v*p,w=(u-d)/v*p;i===n.DAY&&(k=Math.round(k/o)*o,w=Math.max(o,Math.round(w/o)*o));var D=((s={})[n.DAY]=20,s[n.WEEK]=20,s[n.MONTH]=20,s[n.QUARTER]=30,s[n.YEAR]=40,s)[i]||20;w=Math.max(D,w);var T=p-k;return{leftPx:k,widthPx:w=Math.min(T,w)}}catch(e){return console.error("Error calculating task position:",e),{leftPx:0,widthPx:20}}},e.getLiveDatesFromElement=function(e,t,a,r,o,i){void 0===i&&(i=n.MONTH);try{if(!e)return{startDate:new Date(t),endDate:new Date(a)};var s=parseFloat(e.style.left||"0"),l=parseFloat(e.style.width||"0"),c=this.calculateDatesFromPosition(s,l,t,a,r,o,i);return{startDate:c.newStartDate,endDate:c.newEndDate}}catch(e){return console.error("Error getting live dates:",e),{startDate:new Date(t),endDate:new Date(a)}}},e.datesOverlap=function(e,a,n,r){return t.isWithinInterval(e,{start:n,end:r})||t.isWithinInterval(a,{start:n,end:r})||t.isWithinInterval(n,{start:e,end:a})||t.isWithinInterval(r,{start:e,end:a})},e}(),g=function(e){var a=e.task,r=e.position,i=e.dragType,s=e.taskId,l=e.startDate,c=e.endDate,d=e.totalMonths,u=e.monthWidth,g=e.showProgress,h=void 0!==g&&g,m=e.instanceId,v=e.className,p=void 0===v?"":v,k=e.viewMode,w=void 0===k?n.MONTH:k,D=e.renderTooltip,T=a.startDate,M=a.endDate;try{var y=s||a.id,E=document.querySelector('[data-task-id="'.concat(y,'"][data-instance-id="').concat(m,'"]'));if(E&&(i||E.style.left||E.style.width)){var b=f.getLiveDatesFromElement(E,l,c,d,u,w);T=b.startDate,M=b.endDate}}catch(e){console.error("Error calculating live dates for tooltip:",e)}var x=function(e,a,r){void 0===r&&(r=n.MONTH);try{if(!(e instanceof Date)||!(a instanceof Date)||isNaN(e.getTime())||isNaN(a.getTime()))return{value:0,unit:"days"};var o=e<a?e:a,i=e<a?a:e;switch(r){case n.DAY:var s=t.differenceInDays(i,o)+1;return{value:s,unit:1===s?"day":"days"};case n.WEEK:var l=t.differenceInWeeks(i,o)+1;return{value:l,unit:1===l?"week":"weeks"};case n.MONTH:var c=t.differenceInMonths(i,o)+1;return{value:c,unit:1===c?"month":"months"};case n.QUARTER:var d=t.differenceInQuarters(i,o)+1;return{value:d,unit:1===d?"quarter":"quarters"};case n.YEAR:var u=t.differenceInYears(i,o)+1;return{value:u,unit:1===u?"year":"years"};default:var f=t.differenceInDays(i,o)+1;return{value:f,unit:1===f?"day":"days"}}}catch(e){return console.error("Error calculating duration:",e),{value:0,unit:"days"}}}(T,M,w),N=function(e){return e instanceof Date&&!isNaN(e.getTime())?w===n.DAY?t.format(e,"EEE, MMM d, yyyy"):t.format(e,"MMM d, yyyy"):"Invalid date"},A=function(){if(!i)return null;switch(i){case"move":return"Moving task...";case"resize-left":return"Adjusting start date...";case"resize-right":return"Adjusting end date...";default:return null}}();return D?o.default.createElement("div",{className:"rmg-task-tooltip absolute z-20 ".concat(p),style:{left:"".concat(r.x,"px"),top:"".concat(r.y-40,"px")}},D({task:a,position:r,dragType:i,startDate:T,endDate:M,viewMode:w})):o.default.createElement("div",{className:"rmg-task-tooltip absolute z-20 bg-[var(--rmg-tooltip-bg,#ffffff)] text-[var(--rmg-tooltip-text,#1f2937)] border border-[var(--rmg-tooltip-border,#e5e7eb)] rounded-md shadow-md p-2 text-xs select-none ".concat(p),style:{left:"".concat(r.x,"px"),top:"".concat(r.y-40,"px"),minWidth:"200px"}},o.default.createElement("div",{className:"font-bold mb-1"},a.name||"Unnamed Task"),A&&o.default.createElement("div",{className:"text-xs text-blue-500 dark:text-blue-400 mb-1 italic"},A),o.default.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},o.default.createElement("div",{className:"font-semibold"},"Start:"),o.default.createElement("div",null,N(T)),o.default.createElement("div",{className:"font-semibold"},"End:"),o.default.createElement("div",null,N(M)),o.default.createElement("div",{className:"font-semibold"},"Duration:"),o.default.createElement("div",null,x.value," ",x.unit),h&&"number"==typeof a.percent&&o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"font-semibold"},"Progress:"),o.default.createElement("div",null,a.percent,"%")),a.dependencies&&a.dependencies.length>0&&o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"font-semibold"},"Dependencies:"),o.default.createElement("div",null,a.dependencies.join(", ")))))},h=function(t){var a=t.activeMode,r=t.onChange,i=t.darkMode,s=t.availableModes,l=[{id:n.DAY,label:"Day"},{id:n.WEEK,label:"Week"},{id:n.MONTH,label:"Month"},{id:n.QUARTER,label:"Quarter"},{id:n.YEAR,label:"Year"}],c=s?l.filter((function(e){return s.includes(e.id)})):l,d=e.useRef(null),u=e.useState({left:"0px",width:"0px"}),f=u[0],g=u[1];e.useEffect((function(){var e=function(){if(d.current){var e=d.current.querySelector('[aria-selected="true"]');if(e){var t=e,a=t.offsetLeft,n=t.offsetWidth;g({left:"".concat(a,"px"),width:"".concat(n,"px")})}}};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[a]);var h="\n        relative inline-flex rounded-full p-0.5\n        ".concat(i?"bg-gray-800/80":"bg-gray-100/90","\n        transition-all duration-300 ease-in-out shadow-sm\n        border ").concat(i?"border-gray-700":"border-gray-200","\n    ");return o.default.createElement("div",{className:"relative flex items-center"},o.default.createElement("div",{ref:d,className:h,role:"tablist","aria-label":"View mode options"},o.default.createElement("span",{className:"\n                        absolute z-0 inset-0.5 rounded-full\n                        transition-all duration-300 ease-out transform\n                        ".concat(i?"bg-indigo-600":"bg-indigo-500","\n                    "),style:f,"aria-hidden":"true"}),c.map((function(e){return o.default.createElement("button",{key:e.id,role:"tab","aria-selected":a===e.id,"aria-controls":"panel-".concat(e.id),className:"".concat((t=a===e.id,"\n        relative z-10 px-3 py-1 text-xs font-medium\n        transition-all duration-200 ease-in-out\n        ".concat(t?"text-white":i?"text-gray-400 hover:text-gray-200":"text-gray-500 hover:text-gray-700","\n        focus:outline-none\n    "))," rounded-full"),onClick:function(){return r(e.id)}},e.label);var t}))))},m=function(t){var a=t.task,n=t.leftPx,r=t.widthPx,s=t.topPx,l=t.isHovered,c=t.isDragging,d=t.editMode,u=t.showProgress,f=void 0!==u&&u,g=t.instanceId,h=t.renderTask,m=t.getTaskColor,v=t.onMouseDown,p=t.onMouseEnter,k=t.onMouseLeave,w=t.onClick,D=t.onProgressUpdate,T=(l||c)&&d,M=e.useRef(null),y=e.useRef(null),E=e.useState(!1),b=E[0],x=E[1],N=e.useState(a.percent||0),A=N[0],S=N[1];if(!a||!a.id)return null;var C=a.color||"bg-gantt-task",P="",Y="text-gantt-task-text";if(m){var R=m({task:a,isHovered:l,isDragging:c});C=R.backgroundColor,P=R.borderColor||"",Y=R.textColor||Y}var F=e.useCallback((function(e){if(b&&y.current&&M.current){var t=M.current.getBoundingClientRect(),a=t.width-2,n=Math.max(0,Math.min(a,e.clientX-t.left)),r=Math.round(n/a*100);S(Math.max(0,Math.min(100,r)))}}),[b]),I=e.useCallback((function(){b&&(x(!1),document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",I),D&&A!==a.percent&&D(a,A))}),[b,D,A,a]);if(e.useEffect((function(){S(a.percent||0)}),[a.percent]),e.useEffect((function(){return function(){document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",I)}}),[F,I]),h){var O=h({task:a,leftPx:n,widthPx:r,topPx:s,isHovered:l,isDragging:c,editMode:d,showProgress:f});return o.default.createElement("div",{ref:M,className:"absolute",style:{left:"".concat(Math.max(0,n),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(s,"px")},onClick:function(e){return w(e,a)},onMouseDown:function(e){return v(e,a,"move")},onMouseEnter:function(e){return p(e,a)},onMouseLeave:k,"data-testid":"task-".concat(a.id),"data-task-id":a.id,"data-instance-id":g,"data-dragging":c?"true":"false"},O)}var H=C.startsWith("bg-")?{}:{backgroundColor:C},W=C.startsWith("bg-")?C:"",L=P?P.startsWith("border-")?{}:{borderColor:P,borderWidth:"1px"}:{},U=P&&P.startsWith("border-")?P:"";return o.default.createElement("div",{ref:M,className:"absolute h-8 rounded ".concat(W," ").concat(U," ").concat(Y," flex items-center px-2 text-xs font-medium ").concat(d?"cursor-move":"cursor-pointer"," ").concat(c?"shadow-lg":""),style:i(i(i({left:"".concat(Math.max(0,n),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(s,"px")},H),L),{willChange:c?"transform, left, width":"auto"}),onClick:function(e){return w(e,a)},onMouseDown:function(e){return v(e,a,"move")},onMouseEnter:function(e){return p(e,a)},onMouseLeave:k,"data-testid":"task-".concat(a.id),"data-task-id":a.id,"data-instance-id":g,"data-dragging":c?"true":"false"},T&&o.default.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-l rmg-resize-handle",onMouseDown:function(e){e.stopPropagation(),v(e,a,"resize-left")}}),o.default.createElement("div",{className:"truncate select-none"},a.name||"Unnamed Task"),f&&"number"==typeof A&&o.default.createElement("div",{ref:y,className:"absolute bottom-1 left-1 right-1 h-2 bg-black bg-opacity-20 dark:bg-opacity-30 rounded-full overflow-hidden ".concat(d?"cursor-pointer":""),onClick:function(e){if(d&&f&&D){e.stopPropagation();var t=e.currentTarget.clientWidth,n=e.nativeEvent.offsetX,r=Math.round(n/t*100);S(r),D(a,r)}}},o.default.createElement("div",{className:"h-full bg-white dark:bg-gray-200 rounded-full relative",style:{width:"".concat(A,"%")}},d&&(l||b)&&o.default.createElement("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-1/2 h-4 w-4 rounded-full bg-white border-2 ".concat(P||C.startsWith("bg-")?U||W:"border-blue-500"," cursor-ew-resize shadow-sm hover:shadow-md transition-shadow ").concat(b?"scale-110":""),onMouseDown:function(e){d&&f&&(e.stopPropagation(),e.preventDefault(),x(!0),document.addEventListener("mousemove",F),document.addEventListener("mouseup",I))}}))),T&&o.default.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-r rmg-resize-handle",onMouseDown:function(e){e.stopPropagation(),v(e,a,"resize-right")}}))},v=function(e){var t=e.tasks,a=void 0===t?[]:t,r=e.headerLabel,i=void 0===r?"Resources":r,s=e.showIcon,l=void 0!==s&&s,c=e.showTaskCount,d=void 0!==c&&c,f=e.showDescription,g=void 0===f||f,h=e.rowHeight,m=void 0===h?40:h,v=e.className,p=void 0===v?"":v,k=e.onGroupClick,w=e.viewMode,D=Array.isArray(a)?a:[],T=w===n.DAY||w===n.WEEK;return o.default.createElement("div",{className:"rmg-task-list w-40 flex-shrink-0 z-10 bg-gantt-bg shadow-sm ".concat(p)},T?o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"}),o.default.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},i)):o.default.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},i),D.map((function(e){if(!e)return null;var t=function(e){if(!e.tasks||!Array.isArray(e.tasks))return 60;var t=u.detectOverlaps(e.tasks,w);return Math.max(60,t.length*m+20)}(e);return o.default.createElement("div",{key:"task-group-".concat(e.id||"unknown"),className:"p-2 border-r border-b border-gantt-border font-medium text-gantt-text bg-gantt-bg hover:bg-gantt-highlight transition-colors duration-150",style:{height:"".concat(t,"px")},onClick:function(){return t=e,void(k&&k(t));var t},"data-testid":"task-group-".concat(e.id||"unknown")},o.default.createElement("div",{className:"flex items-center"},l&&e.icon&&o.default.createElement("span",{className:"mr-2",dangerouslySetInnerHTML:{__html:e.icon}}),o.default.createElement("div",{className:"font-medium truncate"},e.name||"Unnamed")),g&&e.description&&o.default.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate"},e.description),d&&e.tasks&&e.tasks.length>0&&o.default.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1"},e.tasks.length," ",1===e.tasks.length?"task":"tasks"))})))},p=function(){function e(e,t,a){void 0===a&&(a=.25);var n=this;this.currentPosition=e,this.targetPosition=t,this.animationSpeed=a,this.animationFrameId=null,this.lastUpdateTime=0,this.velocity={left:0,width:0},this.animate=function(){var e=Date.now(),t=e-n.lastUpdateTime;n.lastUpdateTime=e;var a=Math.max(.1,Math.min(1,n.animationSpeed)),r=n.currentPosition.left+(n.targetPosition.left-n.currentPosition.left)*a,o=n.currentPosition.width+(n.targetPosition.width-n.currentPosition.width)*a;n.velocity.left=(r-n.currentPosition.left)/(t||16),n.velocity.width=(o-n.currentPosition.width)/(t||16),n.currentPosition={left:r,width:o},n.updateCallback&&n.updateCallback(n.currentPosition),n.animationFrameId=requestAnimationFrame(n.animate)}}return e.prototype.startAnimation=function(e){this.updateCallback=e,this.lastUpdateTime=Date.now(),this.animate()},e.prototype.stopAnimation=function(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)},e.prototype.updateTargetPosition=function(e){this.targetPosition=e,null===this.animationFrameId&&this.updateCallback&&this.startAnimation(this.updateCallback)},e}(),k=function(){function e(e,t){this.scrolling=!1,this.speed=0,this.direction=null,this.scrollTimerId=null,this.containerRef=e,this.onChange=t}return e.prototype.checkForScrolling=function(e){var t=this.containerRef.current;if(t){var a=t.getBoundingClientRect(),n=null,r=0;e<a.left+40?(n="left",r=Math.max(1,Math.round((40-(e-a.left))/10))):e>a.right-40&&(n="right",r=Math.max(1,Math.round((e-(a.right-40))/10))),this.direction=n,this.speed=r,n&&!this.scrolling?this.startScrolling():!n&&this.scrolling&&this.stopScrolling()}},e.prototype.startScrolling=function(){var e=this;if(!this.scrolling){this.scrolling=!0,this.onChange&&this.onChange(!0);var t=function(){if(e.scrolling&&e.containerRef.current){var a=e.containerRef.current,n=a.scrollLeft,r=a.scrollWidth-a.clientWidth;if("left"===e.direction){if(n<=0)return void e.stopScrolling();a.scrollLeft=Math.max(0,n-e.speed)}else if("right"===e.direction){if(n>=r)return void e.stopScrolling();a.scrollLeft=Math.min(r,n+e.speed)}e.scrolling&&(e.scrollTimerId=requestAnimationFrame(t))}};this.scrollTimerId=requestAnimationFrame(t)}},e.prototype.stopScrolling=function(){this.scrolling=!1,this.onChange&&this.onChange(!1),null!==this.scrollTimerId&&(cancelAnimationFrame(this.scrollTimerId),this.scrollTimerId=null)},e}(),w=function(){function e(e,t,a){this.state={hoveredTask:null,draggingTask:null,dragType:null,dragStartX:0,tooltipPosition:{x:0,y:0},previewTask:null,initialTaskState:null},this.taskGroup=e,this.viewMode=t,this.updateCallback=a}return e.prototype.getTaskRows=function(){return this.state.previewTask?u.getPreviewArrangement(this.state.previewTask,this.taskGroup.tasks,this.viewMode):u.detectOverlaps(this.taskGroup.tasks,this.viewMode)},e.prototype.getState=function(){return this.state},e.prototype.updateState=function(e){this.state=i(i({},this.state),e),this.updateCallback(this.state)},e.prototype.startTaskDrag=function(e,t,a,n,r){this.updateState({draggingTask:e,dragType:t,dragStartX:a,previewTask:e,initialTaskState:{left:n,width:r,startDate:new Date(e.startDate),endDate:new Date(e.endDate)}})},e.prototype.endTaskDrag=function(){this.updateState({draggingTask:null,dragType:null,previewTask:null,initialTaskState:null})},e.prototype.setHoveredTask=function(e,t){var a={hoveredTask:e};t&&(a.tooltipPosition=t),this.updateState(a)},e.prototype.updatePreviewTask=function(e){this.updateState({previewTask:e})},e}(),D=function(t){var a,r=t.taskGroup,s=t.startDate,l=t.endDate,c=t.totalMonths,d=t.monthWidth,u=t.editMode,h=void 0===u||u,v=t.showProgress,D=void 0!==v&&v,T=t.className,M=void 0===T?"":T,y=t.tooltipClassName,E=void 0===y?"":y,b=t.onTaskUpdate,x=t.onTaskClick,N=t.onTaskSelect,A=t.onAutoScrollChange,S=t.viewMode,C=void 0===S?n.MONTH:S,P=t.scrollContainerRef,Y=t.smoothDragging,R=void 0===Y||Y;t.movementThreshold;var F=t.animationSpeed,I=void 0===F?.25:F,O=t.renderTask,H=t.renderTooltip,W=t.getTaskColor;if(!r||!r.id||!Array.isArray(r.tasks))return o.default.createElement("div",{className:"relative h-16 text-gantt-text"},"Invalid task group data");var L=s instanceof Date?s:new Date,U=l instanceof Date?l:new Date,z=e.useState({hoveredTask:null,draggingTask:null,dragType:null,dragStartX:0,tooltipPosition:{x:0,y:0},previewTask:null,initialTaskState:null}),Q=z[0],K=z[1],V=e.useRef(null),q=e.useRef(null),G=e.useRef("task-row-".concat(Math.random().toString(36).substring(2,11))),j=e.useRef(new w(r,C,K)).current,X=e.useRef(new k(P,A)).current,B=e.useRef(null),_=j.getTaskRows(),J=Math.max(60,40*_.length+20),Z=R&&C!==n.DAY,$=e.useCallback((function(e,t){if(Q.draggingTask)try{var a=f.calculateDatesFromPosition(e,t,L,U,c,d,C),n=a.newStartDate,r=a.newEndDate,o=f.createUpdatedTask(Q.draggingTask,n,r);j.updatePreviewTask(o)}catch(e){console.error("Error updating dates:",e)}}),[Q.draggingTask,L,U,c,d,C]),ee=e.useCallback((function(){if(q.current&&Q.initialTaskState&&Q.draggingTask){var e=Q.previewTask;if(e){var t=L.getTime(),a=U.getTime();if(e.startDate.getTime()<t&&(e=i(i({},e),{startDate:new Date(t)})),e.endDate.getTime()>a&&(e=i(i({},e),{endDate:new Date(a)})),b&&e)try{b(r.id,e)}catch(e){console.error("Error in onTaskUpdate:",e)}}}}),[Q,L,U,b,r.id]),te=e.useCallback((function(e,t){x&&!Q.draggingTask&&x(t,r),N&&N(t,!0)}),[x,N,Q.draggingTask,r]),ae=e.useCallback((function(e,t){if(!Q.draggingTask&&V.current){var a=V.current.getBoundingClientRect();j.setHoveredTask(t,{x:e.clientX-a.left+20,y:e.clientY-a.top})}}),[Q.draggingTask,j]),ne=e.useCallback((function(){Q.draggingTask||j.setHoveredTask(null)}),[Q.draggingTask,j]),re=e.useCallback((function(e,t,a){if(h){e.preventDefault(),e.stopPropagation();var n=document.querySelector('[data-task-id="'.concat(t.id,'"][data-instance-id="').concat(G.current,'"]'));if(n){q.current=n;var r=parseFloat(n.style.left||"0"),o=parseFloat(n.style.width||"0");n.setAttribute("data-dragging","true"),n.style.transition="none",j.startTaskDrag(t,a,e.clientX,r,o),Z&&(B.current=new p({left:r,width:o},{left:r,width:o},I),B.current.startAnimation((function(e){q.current&&(q.current.style.left="".concat(e.left,"px"),q.current.style.width="".concat(e.width,"px"),$(e.left,e.width))}))),document.addEventListener("mouseup",ie),document.addEventListener("mousemove",oe)}}}),[h,Z,I,$]),oe=e.useCallback((function(e){var t=(MouseEvent,e.clientX),a=(MouseEvent,e.clientY);if(e instanceof MouseEvent&&Q.hoveredTask&&V.current){var r=V.current.getBoundingClientRect();j.setHoveredTask(Q.hoveredTask,{x:t-r.left+20,y:a-r.top})}if(Q.draggingTask&&(null==P?void 0:P.current)&&X.checkForScrolling(t),Q.draggingTask&&Q.dragType&&Q.initialTaskState&&V.current)try{var o=t-Q.dragStartX,i=c*d,s=Q.initialTaskState.left,l=Q.initialTaskState.width;switch(Q.dragType){case"move":s=Math.max(0,Math.min(i-Q.initialTaskState.width,Q.initialTaskState.left+o)),C===n.DAY&&(s=Math.round(s/d)*d);break;case"resize-left":var u=Q.initialTaskState.width-20,f=Math.min(u,o);s=Math.max(0,Q.initialTaskState.left+f),C===n.DAY&&(s=Math.round(s/d)*d);var g=Q.initialTaskState.left+Q.initialTaskState.width;l=Math.max(20,g-s),C===n.DAY&&(l=Math.round(l/d)*d,l=Math.max(d,l));break;case"resize-right":l=Math.max(20,Math.min(i-Q.initialTaskState.left,Q.initialTaskState.width+o)),C===n.DAY&&(l=Math.round(l/d)*d,l=Math.max(d,l))}C===n.DAY&&q.current?(q.current.style.left="".concat(s,"px"),q.current.style.width="".concat(l,"px"),$(s,l)):Z&&B.current?B.current.updateTargetPosition({left:s,width:l}):q.current&&(q.current.style.left="".concat(s,"px"),q.current.style.width="".concat(l,"px"),$(s,l))}catch(e){console.error("Error in handleMouseMove:",e)}}),[Q,P,j,d,c,C,Z,$]),ie=e.useCallback((function(){try{B.current&&(B.current.stopAnimation(),B.current=null),ee(),q.current&&(q.current.setAttribute("data-dragging","false"),setTimeout((function(){q.current&&(q.current.style.transition="")}),200))}finally{X.stopScrolling(),j.endTaskDrag(),q.current=null,document.removeEventListener("mouseup",ie),document.removeEventListener("mousemove",oe)}}),[ee,j,X]),se=e.useCallback((function(e,t){if(b&&r.id)try{var a=i(i({},e),{percent:t});b(r.id,a)}catch(e){console.error("Error updating task progress:",e)}}),[b,r.id]);return e.useEffect((function(){return function(){document.removeEventListener("mouseup",ie),document.removeEventListener("mousemove",oe),X.stopScrolling(),B.current&&B.current.stopAnimation()}}),[ie,oe,X]),r.tasks&&0!==r.tasks.length?o.default.createElement("div",{className:"relative border-b border-gantt-border ".concat(M),style:{height:"".concat(J,"px")},onMouseMove:function(e){return oe(e)},onMouseLeave:ne,ref:V,"data-testid":"task-row-".concat(r.id),"data-instance-id":G.current},_.map((function(e,t){return o.default.createElement(o.default.Fragment,{key:"task-row-".concat(t)},e.map((function(e){var a,n;try{if(!(e&&e.id&&e.startDate instanceof Date&&e.endDate instanceof Date))return null;var r=f.calculateTaskPixelPosition(e,L,U,c,d,C),i=r.leftPx,s=r.widthPx,l=(null===(a=Q.hoveredTask)||void 0===a?void 0:a.id)===e.id,u=(null===(n=Q.draggingTask)||void 0===n?void 0:n.id)===e.id,g=40*t+10;return o.default.createElement(m,{key:"task-".concat(e.id),task:e,leftPx:i,widthPx:s,topPx:g,isHovered:l,isDragging:u,editMode:h,showProgress:D,instanceId:G.current,onMouseDown:re,onMouseEnter:ae,onMouseLeave:ne,onClick:te,renderTask:O,getTaskColor:W,onProgressUpdate:se})}catch(e){return console.error("Error rendering task:",e),null}})))})),(Q.hoveredTask||Q.draggingTask)&&o.default.createElement(g,{task:Q.previewTask||Q.draggingTask||Q.hoveredTask,position:Q.tooltipPosition,dragType:Q.dragType,taskId:null===(a=Q.draggingTask)||void 0===a?void 0:a.id,startDate:L,endDate:U,totalMonths:c,monthWidth:d,showProgress:D,instanceId:G.current,className:E,viewMode:C,renderTooltip:H})):o.default.createElement("div",{className:"relative h-16 text-gantt-text"},"No tasks available")};exports.GanttChart=function(a){var r=a.tasks,u=void 0===r?[]:r,f=a.startDate,g=a.endDate,m=a.title,p=void 0===m?"Project Timeline":m,k=a.currentDate,w=void 0===k?new Date:k,T=a.showCurrentDateMarker,M=void 0===T||T,y=a.todayLabel,E=void 0===y?"Today":y,b=a.editMode,x=void 0===b||b,N=a.headerLabel,A=void 0===N?"Resources":N,S=a.showProgress,C=void 0!==S&&S,P=a.darkMode,Y=void 0!==P&&P,R=a.locale,F=void 0===R?"default":R,I=a.styles,O=void 0===I?{}:I,H=a.viewMode,W=void 0===H?n.MONTH:H,L=a.showViewModeSelector,U=void 0===L||L,z=a.smoothDragging,Q=void 0===z||z,K=a.movementThreshold,V=void 0===K?3:K,q=a.animationSpeed,G=void 0===q?.25:q,j=a.renderTaskList,X=a.renderTask,B=a.renderTooltip,_=a.renderViewModeSelector,J=a.renderHeader,Z=a.renderTimelineHeader,$=a.getTaskColor,ee=a.onTaskUpdate,te=a.onTaskClick,ae=a.onTaskSelect;a.onTaskDoubleClick;var ne=a.onGroupClick,re=a.onViewModeChange,oe=a.fontSize,ie=a.rowHeight,se=void 0===ie?40:ie;a.timeStep;var le=e.useRef(null),ce=e.useRef(null),de=e.useState(W),ue=de[0],fe=de[1],ge=e.useState([]);ge[0];var he=ge[1],me=e.useState(150),ve=me[0],pe=me[1],ke=e.useState(!1),we=ke[0],De=ke[1],Te=f||function(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.startDate instanceof Date&&(a?e.startDate<t&&(t=new Date(e.startDate)):(t=new Date(e.startDate),a=!0))}))})),!a){var n=new Date;return new Date(n.getFullYear(),n.getMonth()-1,1)}return new Date(t.getFullYear(),t.getMonth(),1)}(u),Me=g||function(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.endDate instanceof Date&&(a?e.endDate>t&&(t=new Date(e.endDate)):(t=new Date(e.endDate),a=!0))}))})),!a){var n=new Date;return new Date(n.getFullYear(),n.getMonth()+2,0)}return new Date(t.getFullYear(),t.getMonth()+1,0)}(u),ye=function(e,a){var n=[],r=new Date(e);r.setHours(0,0,0,0);var o=new Date(a);for(o.setHours(23,59,59,999);r<=o;)n.push(new Date(r)),r=t.addDays(r,1);return n},Ee=function(e,a){for(var n=[],r=new Date(e);r<=a;)n.push(new Date(r)),r=t.addDays(r,7);return n},be=function(e,a){for(var n=[],r=t.startOfQuarter(new Date(e));r<=a;)n.push(new Date(r)),r=t.addQuarters(r,1);return n},xe=function(e,a){for(var n=[],r=t.startOfYear(new Date(e));r<=a;)n.push(new Date(r)),r=t.addYears(r,1);return n},Ne=function(){switch(ue){case n.DAY:return ye(Te,Me);case n.WEEK:return Ee(Te,Me);case n.MONTH:return l(Te,Me);case n.QUARTER:return be(Te,Me);case n.YEAR:return xe(Te,Me);default:return l(Te,Me)}}(),Ae=Ne.length,Se=function(){var e=new Date;switch(ue){case n.DAY:return Ne.findIndex((function(t){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case n.WEEK:return Ne.findIndex((function(t){var a=new Date(t);return a.setDate(t.getDate()+6),e>=t&&e<=a}));case n.MONTH:return Ne.findIndex((function(t){return t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case n.QUARTER:var t=Math.floor(e.getMonth()/3);return Ne.findIndex((function(a){return Math.floor(a.getMonth()/3)===t&&a.getFullYear()===e.getFullYear()}));case n.YEAR:return Ne.findIndex((function(t){return t.getFullYear()===e.getFullYear()}));default:return-1}}(),Ce=function(e){De(e),ce.current&&(e?ce.current.classList.add("rmg-auto-scrolling"):ce.current.classList.remove("rmg-auto-scrolling"))},Pe=function(e,t){if(ee)try{var a=i(i({},t),{startDate:t.startDate instanceof Date?t.startDate:new Date(t.startDate),endDate:t.endDate instanceof Date?t.endDate:new Date(t.endDate)});ee(e,a)}catch(e){console.error("Error in handleTaskUpdate:",e)}},Ye=function(e,t){if(te)try{te(e,t)}catch(e){console.error("Error in handleTaskClick:",e)}},Re=function(e,t){if(he((function(a){return t?s(s([],a,!0),[e.id],!1):a.filter((function(t){return t!==e.id}))})),ae)try{ae(e,t)}catch(e){console.error("Error in onTaskSelect handler:",e)}},Fe=function(e){switch(fe(e),e){case n.DAY:pe(50);break;case n.WEEK:pe(80);break;case n.MONTH:pe(150);break;case n.QUARTER:pe(180);break;case n.YEAR:pe(200);break;default:pe(150)}re&&re(e)};e.useEffect((function(){Fe(W)}),[W]),e.useEffect((function(){if(le.current){var e=Math.max(.1,Math.min(1,G||.25));le.current.style.setProperty("--rmg-animation-speed",e.toString())}}),[G,le.current]);var Ie,Oe={fontSize:oe||"inherit"},He=Y?"dark":"",We=i(i({},{container:"",title:"",header:"",taskList:"",timeline:"",taskRow:"",todayMarker:"",tooltip:""}),O);return o.default.createElement("div",{ref:le,className:"rmg-gantt-chart w-full bg-gantt-bg text-gantt-text rounded-xl shadow-lg overflow-hidden ".concat(He," ").concat(We.container),style:i(i({},Oe),{"--gantt-unit-width":"".concat(ve,"px")}),"data-testid":"gantt-chart"},J?J({title:p,darkMode:Y,viewMode:ue,onViewModeChange:Fe,showViewModeSelector:U}):o.default.createElement("div",{className:"p-6 border-b border-gantt-border"},o.default.createElement("div",{className:"flex justify-between items-center"},o.default.createElement("h1",{className:"text-2xl font-bold text-gantt-text ".concat(We.title)},p),U&&o.default.createElement("div",{className:"flex space-x-2"},_?_({activeMode:ue,onChange:Fe,darkMode:Y,availableModes:[n.DAY,n.WEEK,n.MONTH,n.QUARTER,n.YEAR]}):o.default.createElement(h,{activeMode:ue,onChange:Fe,darkMode:Y})))),o.default.createElement("div",{className:"relative flex"},j?j({tasks:u,headerLabel:A,onGroupClick:ne,viewMode:ue}):o.default.createElement(v,{tasks:u,headerLabel:A,onGroupClick:ne,className:We.taskList,viewMode:ue}),o.default.createElement("div",{ref:ce,className:"flex-grow overflow-x-auto rmg-gantt-scroll-container ".concat(we?"rmg-auto-scrolling":"")},o.default.createElement("div",{className:"min-w-max"},Z?Z({timeUnits:Ne,currentUnitIndex:Se,viewMode:ue,locale:F,unitWidth:ve}):o.default.createElement(c,{months:Ne,currentMonthIndex:Se,locale:F,className:We.timeline,viewMode:ue,unitWidth:ve}),o.default.createElement("div",{className:"relative"},M&&Se>=0&&o.default.createElement(d,{currentMonthIndex:Se,height:(Ie=0,u.forEach((function(e){e&&Array.isArray(e.tasks)?Ie+=Math.max(60,1*se+20):Ie+=60})),Ie),label:E,dayOfMonth:w.getDate(),className:We.todayMarker,viewMode:ue,unitWidth:ve}),u.map((function(e){return e&&e.id?o.default.createElement(D,{key:"task-row-".concat(e.id),taskGroup:e,startDate:Te,endDate:Me,totalMonths:Ae,monthWidth:ve,editMode:x,showProgress:C,onTaskUpdate:Pe,onTaskClick:Ye,onTaskSelect:Re,onAutoScrollChange:Ce,className:We.taskRow,tooltipClassName:We.tooltip,viewMode:ue,scrollContainerRef:ce,smoothDragging:Q,movementThreshold:V,animationSpeed:G,renderTask:X,renderTooltip:B,getTaskColor:$}):null})))))))},exports.TaskItem=m,exports.TaskList=v,exports.TaskRow=D,exports.Timeline=c,exports.TodayMarker=d,exports.Tooltip=g,exports.ViewModeSelector=h;
//# sourceMappingURL=index.js.map
