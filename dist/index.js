"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("date-fns");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r,n,o=a(e),i=function(){return i=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};function s(e,t,a){if(a||2===arguments.length)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}function l(e,t){var a=[];if(!(e instanceof Date&&t instanceof Date))return[new Date];for(var r=e.getFullYear(),n=e.getMonth(),o=t.getFullYear(),i=t.getMonth(),s=r;s<=o;s++)for(var l=s===o?i:11,d=s===r?n:0;d<=l;d++)a.push(new Date(s,d,1));return a}"function"==typeof SuppressedError&&SuppressedError,exports.ViewMode=void 0,(r=exports.ViewMode||(exports.ViewMode={})).DAY="day",r.WEEK="week",r.MONTH="month",r.QUARTER="quarter",r.YEAR="year",exports.DateDisplayFormat=void 0,(n=exports.DateDisplayFormat||(exports.DateDisplayFormat={})).MONTH_YEAR="month-year",n.FULL_DATE="full-date",n.SHORT_DATE="short-date";var d=function(e){var a=e.months,r=e.currentMonthIndex,n=(e.locale,e.className),i=void 0===n?"":n,s=e.viewMode,l=void 0===s?exports.ViewMode.MONTH:s,d=e.unitWidth,c=void 0===d?150:d,u=[exports.ViewMode.DAY,exports.ViewMode.WEEK].includes(l),f=function(){if(![exports.ViewMode.DAY,exports.ViewMode.WEEK].includes(l)||0===a.length)return[];var e=[],t=new Date(a[0]),r=0;return a.forEach((function(a){a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()?r+=1:(e.push({date:t,span:r}),t=new Date(a),r=1)})),r>0&&e.push({date:t,span:r}),e}();return o.default.createElement("div",{className:"rmg-timeline ".concat(i),style:{"--gantt-unit-width":"".concat(c,"px")}},u&&o.default.createElement("div",{className:"flex border-b border-gantt-border"},f.map((function(e,a){return o.default.createElement("div",{key:"higher-level-".concat(a),className:"flex-shrink-0 p-2 font-semibold text-center text-gantt-text border-r border-gantt-border h-10",style:{width:"".concat(e.span*c,"px")},"data-timeunit-higher":e.date.toISOString()},function(e){if(!(e instanceof Date))return"";switch(l){case exports.ViewMode.DAY:case exports.ViewMode.WEEK:}return t.format(e,"MMM yyyy",{locale:void 0})}(e.date))}))),o.default.createElement("div",{className:"flex border-b border-gantt-border"},a.map((function(e,a){return o.default.createElement("div",{key:"timeunit-".concat(a),className:"".concat("w-[var(--gantt-unit-width)]"," flex-shrink-0 p-2 font-semibold text-center text-gantt-text ").concat(a===r?"bg-gantt-highlight":""," ").concat(u?"border-r border-gantt-border":""," h-10"),"data-timeunit":e.toISOString()},function(e){if(!(e instanceof Date&&t.isValid(e)))return"";switch(l){case exports.ViewMode.DAY:return t.format(e,"d",{locale:void 0});case exports.ViewMode.WEEK:var a=t.getWeek(e);return"W".concat(a);case exports.ViewMode.MONTH:return t.format(e,"MMM yyyy",{locale:void 0});case exports.ViewMode.QUARTER:var r=Math.floor(e.getMonth()/3)+1;return"Q".concat(r," ").concat(e.getFullYear());case exports.ViewMode.YEAR:return e.getFullYear().toString();default:return t.format(e,"MMM yyyy",{locale:void 0})}}(e))}))))},c=function(e){var t=e.currentMonthIndex,a=e.height,r=e.markerClass,n=void 0===r?"bg-red-500":r,i=e.label,s=void 0===i?"Today":i,l=e.dayOfMonth,d=e.className,c=void 0===d?"":d,u=e.viewMode,f=void 0===u?exports.ViewMode.MONTH:u,g=e.unitWidth,m=void 0===g?150:g;if(t<0)return null;var h=function(){var e=new Date;switch(l||e.getDate(),f){case exports.ViewMode.DAY:return t*m+m/2;case exports.ViewMode.WEEK:var a=e.getDay();return t*m+m*(a/7);case exports.ViewMode.MONTH:var r=e.getDay();return t*m+m*(r/7);case exports.ViewMode.QUARTER:var n=e.getMonth()%3;return t*m+m*(n/3);case exports.ViewMode.YEAR:var o=e.getMonth();return t*m+m*(o/12);default:return t*m+m/2}}();return o.default.createElement("div",{className:"absolute top-0 w-px ".concat(n," z-10 ").concat(c),style:{left:"".concat(h,"px"),height:"".concat(a,"px")},"data-testid":"today-marker"},o.default.createElement("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 ".concat(n," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},s))},u=function(){function e(){}return e.detectOverlaps=function(e,t){var a=this;if(void 0===t&&(t=exports.ViewMode.MONTH),!Array.isArray(e)||0===e.length)return[];var r=s([],e,!0).sort((function(e,t){return e.startDate&&t.startDate?e.startDate.getTime()-t.startDate.getTime():0})),n=[];return r.forEach((function(e){for(var r=!1,o=0;o<n.length;o++){if(!n[o].some((function(r){return a.tasksVisuallyOverlap(e,r,t)}))){n[o].push(e),r=!0;break}}r||n.push([e])})),n},e.tasksVisuallyOverlap=function(e,t,a){if(void 0===a&&(a=exports.ViewMode.MONTH),!(e.startDate&&e.endDate&&t.startDate&&t.endDate))return!1;var r=e.startDate.getTime(),n=e.endDate.getTime(),o=t.startDate.getTime(),i=t.endDate.getTime(),s=this.getCollisionBufferByViewMode(a);return r+s<i-s&&n-s>o+s||Math.abs(r-o)<2*s||Math.abs(n-i)<2*s},e.getCollisionBufferByViewMode=function(e){var t=36e5,a=24*t;switch(e){case exports.ViewMode.DAY:return t;case exports.ViewMode.WEEK:return 4*t;case exports.ViewMode.MONTH:return 12*t;case exports.ViewMode.QUARTER:return a;case exports.ViewMode.YEAR:return 2*a;default:return 12*t}},e.wouldCollide=function(e,t,a,r){var n=this;return void 0===a&&(a=exports.ViewMode.MONTH),t.some((function(t){return t.id!==e.id&&t.id!==r&&n.tasksVisuallyOverlap(e,t,a)}))},e.getPreviewArrangement=function(e,t,a){void 0===a&&(a=exports.ViewMode.MONTH);var r=t.map((function(t){return t.id===e.id?e:t}));return this.detectOverlaps(r,a)},e}(),f=function(){function e(){}return e.calculateDatesFromPosition=function(e,a,r,n,o,i,s){void 0===s&&(s=exports.ViewMode.MONTH);try{var l=isNaN(e)?0:e,d=isNaN(a)||a<20?20:a,c=r.getTime(),u=(n.getTime()-c)/(o*i),f=l*u,g=d*u,m=new Date(c+f),h=new Date(c+f+g);if(s===exports.ViewMode.DAY){var p=Math.round(e/i),v=Math.max(1,Math.round(a/i)),w=new Date(r);w.setHours(0,0,0,0),(m=new Date(w)).setDate(w.getDate()+p),m.setHours(0,0,0,0),(h=new Date(m)).setDate(m.getDate()+v-1),h.setHours(23,59,59,999)}else m=t.startOfDay(m),h=t.endOfDay(h);return m<r&&(m=new Date(r)),h>n&&(h=new Date(n)),{newStartDate:m,newEndDate:h}}catch(e){return console.error("Error calculating dates from position:",e),{newStartDate:new Date(r),newEndDate:new Date(n)}}},e.createUpdatedTask=function(e,t,a){return i(i({},e),{startDate:new Date(t),endDate:new Date(a)})},e.calculateTaskPixelPosition=function(e,t,a,r,n,o){var i;void 0===o&&(o=exports.ViewMode.MONTH);try{if(!(e.startDate instanceof Date&&e.endDate instanceof Date))throw new Error("Invalid dates in task");var s=t.getTime(),l=a.getTime(),d=Math.max(e.startDate.getTime(),t.getTime()),c=Math.min(e.endDate.getTime(),a.getTime());if(o===exports.ViewMode.DAY){var u=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0).getTime(),f=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999).getTime();s=u,l=f;var g=new Date(new Date(d).getFullYear(),new Date(d).getMonth(),new Date(d).getDate(),0,0,0,0).getTime(),m=new Date(new Date(c).getFullYear(),new Date(c).getMonth(),new Date(c).getDate(),23,59,59,999).getTime();d=g,c=m}var h=l-s,p=r*n,v=(d-s)/h*p,w=(c-d)/h*p;o===exports.ViewMode.DAY&&(v=Math.round(v/n)*n,w=Math.max(n,Math.round(w/n)*n));var M=((i={})[exports.ViewMode.DAY]=20,i[exports.ViewMode.WEEK]=20,i[exports.ViewMode.MONTH]=20,i[exports.ViewMode.QUARTER]=30,i[exports.ViewMode.YEAR]=40,i)[o]||20;w=Math.max(M,w);var x=p-v;return{leftPx:v,widthPx:w=Math.min(x,w)}}catch(e){return console.error("Error calculating task position:",e),{leftPx:0,widthPx:20}}},e.getLiveDatesFromElement=function(e,t,a,r,n,o){void 0===o&&(o=exports.ViewMode.MONTH);try{if(!e)return{startDate:new Date(t),endDate:new Date(a)};var i=parseFloat(e.style.left||"0"),s=parseFloat(e.style.width||"0"),l=this.calculateDatesFromPosition(i,s,t,a,r,n,o);return{startDate:l.newStartDate,endDate:l.newEndDate}}catch(e){return console.error("Error getting live dates:",e),{startDate:new Date(t),endDate:new Date(a)}}},e.datesOverlap=function(e,a,r,n){return t.isWithinInterval(e,{start:r,end:n})||t.isWithinInterval(a,{start:r,end:n})||t.isWithinInterval(r,{start:e,end:a})||t.isWithinInterval(n,{start:e,end:a})},e}(),g=function(e){var a=e.task,r=e.position,n=e.dragType,i=e.taskId,s=e.startDate,l=e.endDate,d=e.totalMonths,c=e.monthWidth,u=e.showProgress,g=void 0!==u&&u,m=e.instanceId,h=e.className,p=void 0===h?"":h,v=e.viewMode,w=void 0===v?exports.ViewMode.MONTH:v,M=e.renderTooltip,x=a.startDate,k=a.endDate;try{var D=i||a.id,T=document.querySelector('[data-task-id="'.concat(D,'"][data-instance-id="').concat(m,'"]'));if(T&&(n||T.style.left||T.style.width)){var y=f.getLiveDatesFromElement(T,s,l,d,c,w);x=y.startDate,k=y.endDate}}catch(e){console.error("Error calculating live dates for tooltip:",e)}var E=function(e,a,r){void 0===r&&(r=exports.ViewMode.MONTH);try{if(!(e instanceof Date)||!(a instanceof Date)||isNaN(e.getTime())||isNaN(a.getTime()))return{value:0,unit:"days"};var n=e<a?e:a,o=e<a?a:e;switch(r){case exports.ViewMode.DAY:var i=t.differenceInDays(o,n)+1;return{value:i,unit:1===i?"day":"days"};case exports.ViewMode.WEEK:var s=t.differenceInWeeks(o,n)+1;return{value:s,unit:1===s?"week":"weeks"};case exports.ViewMode.MONTH:var l=t.differenceInMonths(o,n)+1;return{value:l,unit:1===l?"month":"months"};case exports.ViewMode.QUARTER:var d=t.differenceInQuarters(o,n)+1;return{value:d,unit:1===d?"quarter":"quarters"};case exports.ViewMode.YEAR:var c=t.differenceInYears(o,n)+1;return{value:c,unit:1===c?"year":"years"};default:var u=t.differenceInDays(o,n)+1;return{value:u,unit:1===u?"day":"days"}}}catch(e){return console.error("Error calculating duration:",e),{value:0,unit:"days"}}}(x,k,w),b=function(e){return e instanceof Date&&!isNaN(e.getTime())?w===exports.ViewMode.DAY?t.format(e,"EEE, MMM d, yyyy"):t.format(e,"MMM d, yyyy"):"Invalid date"},N=function(){if(!n)return null;switch(n){case"move":return"Moving task...";case"resize-left":return"Adjusting start date...";case"resize-right":return"Adjusting end date...";default:return null}}();return M?o.default.createElement("div",{className:"rmg-task-tooltip absolute z-20 ".concat(p),style:{left:"".concat(r.x,"px"),top:"".concat(r.y-40,"px")}},M({task:a,position:r,dragType:n,startDate:x,endDate:k,viewMode:w})):o.default.createElement("div",{className:"rmg-task-tooltip absolute z-20 bg-[var(--rmg-tooltip-bg,#ffffff)] text-[var(--rmg-tooltip-text,#1f2937)] border border-[var(--rmg-tooltip-border,#e5e7eb)] rounded-md shadow-md p-2 text-xs select-none ".concat(p),style:{left:"".concat(r.x,"px"),top:"".concat(r.y-40,"px"),minWidth:"200px"}},o.default.createElement("div",{className:"font-bold mb-1"},a.name||"Unnamed Task"),N&&o.default.createElement("div",{className:"text-xs text-blue-500 dark:text-blue-400 mb-1 italic"},N),o.default.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},o.default.createElement("div",{className:"font-semibold"},"Start:"),o.default.createElement("div",null,b(x)),o.default.createElement("div",{className:"font-semibold"},"End:"),o.default.createElement("div",null,b(k)),o.default.createElement("div",{className:"font-semibold"},"Duration:"),o.default.createElement("div",null,E.value," ",E.unit),g&&"number"==typeof a.percent&&o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"font-semibold"},"Progress:"),o.default.createElement("div",null,a.percent,"%")),a.dependencies&&a.dependencies.length>0&&o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"font-semibold"},"Dependencies:"),o.default.createElement("div",null,a.dependencies.join(", ")))))},m=function(t){var a=t.activeMode,r=t.onChange,n=t.darkMode,i=t.availableModes,s=[{id:exports.ViewMode.DAY,label:"Day"},{id:exports.ViewMode.WEEK,label:"Week"},{id:exports.ViewMode.MONTH,label:"Month"},{id:exports.ViewMode.QUARTER,label:"Quarter"},{id:exports.ViewMode.YEAR,label:"Year"}],l=i?s.filter((function(e){return i.includes(e.id)})):s,d=e.useRef(null),c=e.useState({left:"0px",width:"0px"}),u=c[0],f=c[1];e.useEffect((function(){var e=function(){if(d.current){var e=d.current.querySelector('[aria-selected="true"]');if(e){var t=e,a=t.offsetLeft,r=t.offsetWidth;f({left:"".concat(a,"px"),width:"".concat(r,"px")})}}};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[a]);var g="\n        relative inline-flex rounded-full p-0.5\n        ".concat(n?"bg-gray-800/80":"bg-gray-100/90","\n        transition-all duration-300 ease-in-out shadow-sm\n        border ").concat(n?"border-gray-700":"border-gray-200","\n    ");return o.default.createElement("div",{className:"relative flex items-center"},o.default.createElement("div",{ref:d,className:g,role:"tablist","aria-label":"View mode options"},o.default.createElement("span",{className:"\n                        absolute z-0 inset-0.5 rounded-full\n                        transition-all duration-300 ease-out transform\n                        ".concat(n?"bg-indigo-600":"bg-indigo-500","\n                    "),style:u,"aria-hidden":"true"}),l.map((function(e){return o.default.createElement("button",{key:e.id,role:"tab","aria-selected":a===e.id,"aria-controls":"panel-".concat(e.id),className:"".concat((t=a===e.id,"\n        relative z-10 px-3 py-1 text-xs font-medium\n        transition-all duration-200 ease-in-out\n        ".concat(t?"text-white":n?"text-gray-400 hover:text-gray-200":"text-gray-500 hover:text-gray-700","\n        focus:outline-none\n    "))," rounded-full"),onClick:function(){return r(e.id)}},e.label);var t}))))},h=function(t){var a=t.task,r=t.leftPx,n=t.widthPx,s=t.topPx,l=t.isHovered,d=t.isDragging,c=t.editMode,u=t.showProgress,f=void 0!==u&&u,g=t.instanceId,m=t.renderTask,h=t.getTaskColor,p=t.onMouseDown,v=t.onMouseEnter,w=t.onMouseLeave,M=t.onClick,x=t.onProgressUpdate,k=(l||d)&&c,D=e.useRef(null),T=e.useRef(null),y=e.useState(!1),E=y[0],b=y[1],N=e.useState(a.percent||0),V=N[0],A=N[1];if(!a||!a.id)return null;var S=a.color||"bg-gantt-task",C="",P="text-gantt-task-text";if(h){var Y=h({task:a,isHovered:l,isDragging:d});S=Y.backgroundColor,C=Y.borderColor||"",P=Y.textColor||P}var R=e.useCallback((function(e){if(E&&T.current&&D.current){var t=D.current.getBoundingClientRect(),a=t.width-2,r=Math.max(0,Math.min(a,e.clientX-t.left)),n=Math.round(r/a*100);A(Math.max(0,Math.min(100,n)))}}),[E]),F=e.useCallback((function(){E&&(b(!1),document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",F),x&&V!==a.percent&&x(a,V))}),[E,x,V,a]);if(e.useEffect((function(){A(a.percent||0)}),[a.percent]),e.useEffect((function(){return function(){document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",F)}}),[R,F]),m){var I=m({task:a,leftPx:r,widthPx:n,topPx:s,isHovered:l,isDragging:d,editMode:c,showProgress:f});return o.default.createElement("div",{ref:D,className:"absolute",style:{left:"".concat(Math.max(0,r),"px"),width:"".concat(Math.max(20,n),"px"),top:"".concat(s,"px")},onClick:function(e){return M(e,a)},onMouseDown:function(e){return p(e,a,"move")},onMouseEnter:function(e){return v(e,a)},onMouseLeave:w,"data-testid":"task-".concat(a.id),"data-task-id":a.id,"data-instance-id":g,"data-dragging":d?"true":"false"},I)}var O=S.startsWith("bg-")?{}:{backgroundColor:S},H=S.startsWith("bg-")?S:"",W=C?C.startsWith("border-")?{}:{borderColor:C,borderWidth:"1px"}:{},L=C&&C.startsWith("border-")?C:"";return o.default.createElement("div",{ref:D,className:"absolute h-8 rounded ".concat(H," ").concat(L," ").concat(P," flex items-center px-2 text-xs font-medium ").concat(c?"cursor-move":"cursor-pointer"," ").concat(d?"shadow-lg":""),style:i(i(i({left:"".concat(Math.max(0,r),"px"),width:"".concat(Math.max(20,n),"px"),top:"".concat(s,"px")},O),W),{willChange:d?"transform, left, width":"auto"}),onClick:function(e){return M(e,a)},onMouseDown:function(e){return p(e,a,"move")},onMouseEnter:function(e){return v(e,a)},onMouseLeave:w,"data-testid":"task-".concat(a.id),"data-task-id":a.id,"data-instance-id":g,"data-dragging":d?"true":"false"},k&&o.default.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-l rmg-resize-handle",onMouseDown:function(e){e.stopPropagation(),p(e,a,"resize-left")}}),o.default.createElement("div",{className:"truncate select-none"},a.name||"Unnamed Task"),f&&"number"==typeof V&&o.default.createElement("div",{ref:T,className:"absolute bottom-1 left-1 right-1 h-2 bg-black bg-opacity-20 dark:bg-opacity-30 rounded-full overflow-hidden ".concat(c?"cursor-pointer":""),onClick:function(e){if(c&&f&&x){e.stopPropagation();var t=e.currentTarget.clientWidth,r=e.nativeEvent.offsetX,n=Math.round(r/t*100);A(n),x(a,n)}}},o.default.createElement("div",{className:"h-full bg-white dark:bg-gray-200 rounded-full relative",style:{width:"".concat(V,"%")}},c&&(l||E)&&o.default.createElement("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-1/2 h-4 w-4 rounded-full bg-white border-2 ".concat(C||S.startsWith("bg-")?L||H:"border-blue-500"," cursor-ew-resize shadow-sm hover:shadow-md transition-shadow ").concat(E?"scale-110":""),onMouseDown:function(e){c&&f&&(e.stopPropagation(),e.preventDefault(),b(!0),document.addEventListener("mousemove",R),document.addEventListener("mouseup",F))}}))),k&&o.default.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-r rmg-resize-handle",onMouseDown:function(e){e.stopPropagation(),p(e,a,"resize-right")}}))},p=function(e){var t=e.tasks,a=void 0===t?[]:t,r=e.headerLabel,n=void 0===r?"Resources":r,i=e.showIcon,s=void 0!==i&&i,l=e.showTaskCount,d=void 0!==l&&l,c=e.showDescription,f=void 0===c||c,g=e.rowHeight,m=void 0===g?40:g,h=e.className,p=void 0===h?"":h,v=e.onGroupClick,w=e.viewMode,M=Array.isArray(a)?a:[],x=w===exports.ViewMode.DAY||w===exports.ViewMode.WEEK;return o.default.createElement("div",{className:"rmg-task-list w-40 flex-shrink-0 z-10 bg-gantt-bg shadow-sm ".concat(p)},x?o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"}),o.default.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},n)):o.default.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},n),M.map((function(e){if(!e)return null;var t=function(e){if(!e.tasks||!Array.isArray(e.tasks))return 60;var t=u.detectOverlaps(e.tasks,w);return Math.max(60,t.length*m+20)}(e);return o.default.createElement("div",{key:"task-group-".concat(e.id||"unknown"),className:"p-2 border-r border-b border-gantt-border font-medium text-gantt-text bg-gantt-bg hover:bg-gantt-highlight transition-colors duration-150",style:{height:"".concat(t,"px")},onClick:function(){return t=e,void(v&&v(t));var t},"data-testid":"task-group-".concat(e.id||"unknown")},o.default.createElement("div",{className:"flex items-center"},s&&e.icon&&o.default.createElement("span",{className:"mr-2",dangerouslySetInnerHTML:{__html:e.icon}}),o.default.createElement("div",{className:"font-medium truncate"},e.name||"Unnamed")),f&&e.description&&o.default.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate"},e.description),d&&e.tasks&&e.tasks.length>0&&o.default.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1"},e.tasks.length," ",1===e.tasks.length?"task":"tasks"))})))},v=function(){function e(e,t,a){void 0===a&&(a=.25);var r=this;this.currentPosition=e,this.targetPosition=t,this.animationSpeed=a,this.animationFrameId=null,this.lastUpdateTime=0,this.velocity={left:0,width:0},this.animate=function(){var e=Date.now(),t=e-r.lastUpdateTime;r.lastUpdateTime=e;var a=Math.max(.1,Math.min(1,r.animationSpeed)),n=r.currentPosition.left+(r.targetPosition.left-r.currentPosition.left)*a,o=r.currentPosition.width+(r.targetPosition.width-r.currentPosition.width)*a;r.velocity.left=(n-r.currentPosition.left)/(t||16),r.velocity.width=(o-r.currentPosition.width)/(t||16),r.currentPosition={left:n,width:o},r.updateCallback&&r.updateCallback(r.currentPosition),r.animationFrameId=requestAnimationFrame(r.animate)}}return e.prototype.startAnimation=function(e){this.updateCallback=e,this.lastUpdateTime=Date.now(),this.animate()},e.prototype.stopAnimation=function(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)},e.prototype.updateTargetPosition=function(e){this.targetPosition=e,null===this.animationFrameId&&this.updateCallback&&this.startAnimation(this.updateCallback)},e}(),w=function(){function e(e,t){this.scrolling=!1,this.speed=0,this.direction=null,this.scrollTimerId=null,this.containerRef=e,this.onChange=t}return e.prototype.checkForScrolling=function(e){var t=this.containerRef.current;if(t){var a=t.getBoundingClientRect(),r=null,n=0;e<a.left+40?(r="left",n=Math.max(1,Math.round((40-(e-a.left))/10))):e>a.right-40&&(r="right",n=Math.max(1,Math.round((e-(a.right-40))/10))),this.direction=r,this.speed=n,r&&!this.scrolling?this.startScrolling():!r&&this.scrolling&&this.stopScrolling()}},e.prototype.startScrolling=function(){var e=this;if(!this.scrolling){this.scrolling=!0,this.onChange&&this.onChange(!0);var t=function(){if(e.scrolling&&e.containerRef.current){var a=e.containerRef.current,r=a.scrollLeft,n=a.scrollWidth-a.clientWidth;if("left"===e.direction){if(r<=0)return void e.stopScrolling();a.scrollLeft=Math.max(0,r-e.speed)}else if("right"===e.direction){if(r>=n)return void e.stopScrolling();a.scrollLeft=Math.min(n,r+e.speed)}e.scrolling&&(e.scrollTimerId=requestAnimationFrame(t))}};this.scrollTimerId=requestAnimationFrame(t)}},e.prototype.stopScrolling=function(){this.scrolling=!1,this.onChange&&this.onChange(!1),null!==this.scrollTimerId&&(cancelAnimationFrame(this.scrollTimerId),this.scrollTimerId=null)},e}(),M=function(){function e(e,t,a){this.state={hoveredTask:null,draggingTask:null,dragType:null,dragStartX:0,tooltipPosition:{x:0,y:0},previewTask:null,initialTaskState:null},this.taskGroup=e,this.viewMode=t,this.updateCallback=a}return e.prototype.getTaskRows=function(){return this.state.previewTask?u.getPreviewArrangement(this.state.previewTask,this.taskGroup.tasks,this.viewMode):u.detectOverlaps(this.taskGroup.tasks,this.viewMode)},e.prototype.getState=function(){return this.state},e.prototype.updateState=function(e){this.state=i(i({},this.state),e),this.updateCallback(this.state)},e.prototype.startTaskDrag=function(e,t,a,r,n){this.updateState({draggingTask:e,dragType:t,dragStartX:a,previewTask:e,initialTaskState:{left:r,width:n,startDate:new Date(e.startDate),endDate:new Date(e.endDate)}})},e.prototype.endTaskDrag=function(){this.updateState({draggingTask:null,dragType:null,previewTask:null,initialTaskState:null})},e.prototype.setHoveredTask=function(e,t){var a={hoveredTask:e};t&&(a.tooltipPosition=t),this.updateState(a)},e.prototype.updatePreviewTask=function(e){this.updateState({previewTask:e})},e}(),x=function(t){var a,r=t.taskGroup,n=t.startDate,s=t.endDate,l=t.totalMonths,d=t.monthWidth,c=t.editMode,u=void 0===c||c,m=t.showProgress,p=void 0!==m&&m,x=t.className,k=void 0===x?"":x,D=t.tooltipClassName,T=void 0===D?"":D,y=t.onTaskUpdate,E=t.onTaskClick,b=t.onTaskSelect,N=t.onAutoScrollChange,V=t.viewMode,A=void 0===V?exports.ViewMode.MONTH:V,S=t.scrollContainerRef,C=t.smoothDragging,P=void 0===C||C;t.movementThreshold;var Y=t.animationSpeed,R=void 0===Y?.25:Y,F=t.renderTask,I=t.renderTooltip,O=t.getTaskColor;if(!r||!r.id||!Array.isArray(r.tasks))return o.default.createElement("div",{className:"relative h-16 text-gantt-text"},"Invalid task group data");var H=n instanceof Date?n:new Date,W=s instanceof Date?s:new Date,L=e.useState({hoveredTask:null,draggingTask:null,dragType:null,dragStartX:0,tooltipPosition:{x:0,y:0},previewTask:null,initialTaskState:null}),U=L[0],z=L[1],Q=e.useRef(null),K=e.useRef(null),q=e.useRef("task-row-".concat(Math.random().toString(36).substring(2,11))),G=e.useRef(new M(r,A,z)).current,j=e.useRef(new w(S,N)).current,X=e.useRef(null),B=G.getTaskRows(),_=Math.max(60,40*B.length+20),J=P&&A!==exports.ViewMode.DAY,Z=e.useCallback((function(e,t){if(U.draggingTask)try{var a=f.calculateDatesFromPosition(e,t,H,W,l,d,A),r=a.newStartDate,n=a.newEndDate,o=f.createUpdatedTask(U.draggingTask,r,n);G.updatePreviewTask(o)}catch(e){console.error("Error updating dates:",e)}}),[U.draggingTask,H,W,l,d,A]),$=e.useCallback((function(){if(K.current&&U.initialTaskState&&U.draggingTask){var e=U.previewTask;if(e){var t=H.getTime(),a=W.getTime();if(e.startDate.getTime()<t&&(e=i(i({},e),{startDate:new Date(t)})),e.endDate.getTime()>a&&(e=i(i({},e),{endDate:new Date(a)})),y&&e)try{y(r.id,e)}catch(e){console.error("Error in onTaskUpdate:",e)}}}}),[U,H,W,y,r.id]),ee=e.useCallback((function(e,t){E&&!U.draggingTask&&E(t,r),b&&b(t,!0)}),[E,b,U.draggingTask,r]),te=e.useCallback((function(e,t){if(!U.draggingTask&&Q.current){var a=Q.current.getBoundingClientRect();G.setHoveredTask(t,{x:e.clientX-a.left+20,y:e.clientY-a.top})}}),[U.draggingTask,G]),ae=e.useCallback((function(){U.draggingTask||G.setHoveredTask(null)}),[U.draggingTask,G]),re=e.useCallback((function(e,t,a){if(u){e.preventDefault(),e.stopPropagation();var r=document.querySelector('[data-task-id="'.concat(t.id,'"][data-instance-id="').concat(q.current,'"]'));if(r){K.current=r;var n=parseFloat(r.style.left||"0"),o=parseFloat(r.style.width||"0");r.setAttribute("data-dragging","true"),r.style.transition="none",G.startTaskDrag(t,a,e.clientX,n,o),J&&(X.current=new v({left:n,width:o},{left:n,width:o},R),X.current.startAnimation((function(e){K.current&&(K.current.style.left="".concat(e.left,"px"),K.current.style.width="".concat(e.width,"px"),Z(e.left,e.width))}))),document.addEventListener("mouseup",oe),document.addEventListener("mousemove",ne)}}}),[u,J,R,Z]),ne=e.useCallback((function(e){var t=(MouseEvent,e.clientX),a=(MouseEvent,e.clientY);if(e instanceof MouseEvent&&U.hoveredTask&&Q.current){var r=Q.current.getBoundingClientRect();G.setHoveredTask(U.hoveredTask,{x:t-r.left+20,y:a-r.top})}if(U.draggingTask&&(null==S?void 0:S.current)&&j.checkForScrolling(t),U.draggingTask&&U.dragType&&U.initialTaskState&&Q.current)try{var n=t-U.dragStartX,o=l*d,i=U.initialTaskState.left,s=U.initialTaskState.width;switch(U.dragType){case"move":i=Math.max(0,Math.min(o-U.initialTaskState.width,U.initialTaskState.left+n)),A===exports.ViewMode.DAY&&(i=Math.round(i/d)*d);break;case"resize-left":var c=U.initialTaskState.width-20,u=Math.min(c,n);i=Math.max(0,U.initialTaskState.left+u),A===exports.ViewMode.DAY&&(i=Math.round(i/d)*d);var f=U.initialTaskState.left+U.initialTaskState.width;s=Math.max(20,f-i),A===exports.ViewMode.DAY&&(s=Math.round(s/d)*d,s=Math.max(d,s));break;case"resize-right":s=Math.max(20,Math.min(o-U.initialTaskState.left,U.initialTaskState.width+n)),A===exports.ViewMode.DAY&&(s=Math.round(s/d)*d,s=Math.max(d,s))}A===exports.ViewMode.DAY&&K.current?(K.current.style.left="".concat(i,"px"),K.current.style.width="".concat(s,"px"),Z(i,s)):J&&X.current?X.current.updateTargetPosition({left:i,width:s}):K.current&&(K.current.style.left="".concat(i,"px"),K.current.style.width="".concat(s,"px"),Z(i,s))}catch(e){console.error("Error in handleMouseMove:",e)}}),[U,S,G,d,l,A,J,Z]),oe=e.useCallback((function(){try{X.current&&(X.current.stopAnimation(),X.current=null),$(),K.current&&(K.current.setAttribute("data-dragging","false"),setTimeout((function(){K.current&&(K.current.style.transition="")}),200))}finally{j.stopScrolling(),G.endTaskDrag(),K.current=null,document.removeEventListener("mouseup",oe),document.removeEventListener("mousemove",ne)}}),[$,G,j]),ie=e.useCallback((function(e,t){if(y&&r.id)try{var a=i(i({},e),{percent:t});y(r.id,a)}catch(e){console.error("Error updating task progress:",e)}}),[y,r.id]);return e.useEffect((function(){return function(){document.removeEventListener("mouseup",oe),document.removeEventListener("mousemove",ne),j.stopScrolling(),X.current&&X.current.stopAnimation()}}),[oe,ne,j]),r.tasks&&0!==r.tasks.length?o.default.createElement("div",{className:"relative border-b border-gantt-border ".concat(k),style:{height:"".concat(_,"px")},onMouseMove:function(e){return ne(e)},onMouseLeave:ae,ref:Q,"data-testid":"task-row-".concat(r.id),"data-instance-id":q.current},B.map((function(e,t){return o.default.createElement(o.default.Fragment,{key:"task-row-".concat(t)},e.map((function(e){var a,r;try{if(!(e&&e.id&&e.startDate instanceof Date&&e.endDate instanceof Date))return null;var n=f.calculateTaskPixelPosition(e,H,W,l,d,A),i=n.leftPx,s=n.widthPx,c=(null===(a=U.hoveredTask)||void 0===a?void 0:a.id)===e.id,g=(null===(r=U.draggingTask)||void 0===r?void 0:r.id)===e.id,m=40*t+10;return o.default.createElement(h,{key:"task-".concat(e.id),task:e,leftPx:i,widthPx:s,topPx:m,isHovered:c,isDragging:g,editMode:u,showProgress:p,instanceId:q.current,onMouseDown:re,onMouseEnter:te,onMouseLeave:ae,onClick:ee,renderTask:F,getTaskColor:O,onProgressUpdate:ie})}catch(e){return console.error("Error rendering task:",e),null}})))})),(U.hoveredTask||U.draggingTask)&&o.default.createElement(g,{task:U.previewTask||U.draggingTask||U.hoveredTask,position:U.tooltipPosition,dragType:U.dragType,taskId:null===(a=U.draggingTask)||void 0===a?void 0:a.id,startDate:H,endDate:W,totalMonths:l,monthWidth:d,showProgress:p,instanceId:q.current,className:T,viewMode:A,renderTooltip:I})):o.default.createElement("div",{className:"relative h-16 text-gantt-text"},"No tasks available")};exports.GanttChart=function(a){var r=a.tasks,n=void 0===r?[]:r,u=a.startDate,f=a.endDate,g=a.title,h=void 0===g?"Project Timeline":g,v=a.currentDate,w=void 0===v?new Date:v,M=a.showCurrentDateMarker,k=void 0===M||M,D=a.todayLabel,T=void 0===D?"Today":D,y=a.editMode,E=void 0===y||y,b=a.headerLabel,N=void 0===b?"Resources":b,V=a.showProgress,A=void 0!==V&&V,S=a.darkMode,C=void 0!==S&&S,P=a.locale,Y=void 0===P?"default":P,R=a.styles,F=void 0===R?{}:R,I=a.viewMode,O=void 0===I?exports.ViewMode.MONTH:I,H=a.showViewModeSelector,W=void 0===H||H,L=a.smoothDragging,U=void 0===L||L,z=a.movementThreshold,Q=void 0===z?3:z,K=a.animationSpeed,q=void 0===K?.25:K,G=a.renderTaskList,j=a.renderTask,X=a.renderTooltip,B=a.renderViewModeSelector,_=a.renderHeader,J=a.renderTimelineHeader,Z=a.getTaskColor,$=a.onTaskUpdate,ee=a.onTaskClick,te=a.onTaskSelect;a.onTaskDoubleClick;var ae=a.onGroupClick,re=a.onViewModeChange,ne=a.fontSize,oe=a.rowHeight,ie=void 0===oe?40:oe;a.timeStep;var se=e.useRef(null),le=e.useRef(null),de=e.useState(O),ce=de[0],ue=de[1],fe=e.useState([]);fe[0];var ge=fe[1],me=e.useState(150),he=me[0],pe=me[1],ve=e.useState(!1),we=ve[0],Me=ve[1],xe=u||function(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.startDate instanceof Date&&(a?e.startDate<t&&(t=new Date(e.startDate)):(t=new Date(e.startDate),a=!0))}))})),!a){var r=new Date;return new Date(r.getFullYear(),r.getMonth()-1,1)}return new Date(t.getFullYear(),t.getMonth(),1)}(n),ke=f||function(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.endDate instanceof Date&&(a?e.endDate>t&&(t=new Date(e.endDate)):(t=new Date(e.endDate),a=!0))}))})),!a){var r=new Date;return new Date(r.getFullYear(),r.getMonth()+2,0)}return new Date(t.getFullYear(),t.getMonth()+1,0)}(n),De=function(e,a){var r=[],n=new Date(e);n.setHours(0,0,0,0);var o=new Date(a);for(o.setHours(23,59,59,999);n<=o;)r.push(new Date(n)),n=t.addDays(n,1);return r},Te=function(e,a){for(var r=[],n=new Date(e);n<=a;)r.push(new Date(n)),n=t.addDays(n,7);return r},ye=function(e,a){for(var r=[],n=t.startOfQuarter(new Date(e));n<=a;)r.push(new Date(n)),n=t.addQuarters(n,1);return r},Ee=function(e,a){for(var r=[],n=t.startOfYear(new Date(e));n<=a;)r.push(new Date(n)),n=t.addYears(n,1);return r},be=function(){switch(ce){case exports.ViewMode.DAY:return De(xe,ke);case exports.ViewMode.WEEK:return Te(xe,ke);case exports.ViewMode.MONTH:return l(xe,ke);case exports.ViewMode.QUARTER:return ye(xe,ke);case exports.ViewMode.YEAR:return Ee(xe,ke);default:return l(xe,ke)}}(),Ne=be.length,Ve=function(){var e=new Date;switch(ce){case exports.ViewMode.DAY:return be.findIndex((function(t){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case exports.ViewMode.WEEK:return be.findIndex((function(t){var a=new Date(t);return a.setDate(t.getDate()+6),e>=t&&e<=a}));case exports.ViewMode.MONTH:return be.findIndex((function(t){return t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case exports.ViewMode.QUARTER:var t=Math.floor(e.getMonth()/3);return be.findIndex((function(a){return Math.floor(a.getMonth()/3)===t&&a.getFullYear()===e.getFullYear()}));case exports.ViewMode.YEAR:return be.findIndex((function(t){return t.getFullYear()===e.getFullYear()}));default:return-1}}(),Ae=function(e){Me(e),le.current&&(e?le.current.classList.add("rmg-auto-scrolling"):le.current.classList.remove("rmg-auto-scrolling"))},Se=function(e,t){if($)try{var a=i(i({},t),{startDate:t.startDate instanceof Date?t.startDate:new Date(t.startDate),endDate:t.endDate instanceof Date?t.endDate:new Date(t.endDate)});$(e,a)}catch(e){console.error("Error in handleTaskUpdate:",e)}},Ce=function(e,t){if(ee)try{ee(e,t)}catch(e){console.error("Error in handleTaskClick:",e)}},Pe=function(e,t){if(ge((function(a){return t?s(s([],a,!0),[e.id],!1):a.filter((function(t){return t!==e.id}))})),te)try{te(e,t)}catch(e){console.error("Error in onTaskSelect handler:",e)}},Ye=function(e){switch(ue(e),e){case exports.ViewMode.DAY:pe(50);break;case exports.ViewMode.WEEK:pe(80);break;case exports.ViewMode.MONTH:pe(150);break;case exports.ViewMode.QUARTER:pe(180);break;case exports.ViewMode.YEAR:pe(200);break;default:pe(150)}re&&re(e)};e.useEffect((function(){Ye(O)}),[O]),e.useEffect((function(){if(se.current){var e=Math.max(.1,Math.min(1,q||.25));se.current.style.setProperty("--rmg-animation-speed",e.toString())}}),[q,se.current]);var Re,Fe={fontSize:ne||"inherit"},Ie=C?"dark":"",Oe=i(i({},{container:"",title:"",header:"",taskList:"",timeline:"",taskRow:"",todayMarker:"",tooltip:""}),F);return o.default.createElement("div",{ref:se,className:"rmg-gantt-chart w-full bg-gantt-bg text-gantt-text rounded-xl shadow-lg overflow-hidden ".concat(Ie," ").concat(Oe.container),style:i(i({},Fe),{"--gantt-unit-width":"".concat(he,"px")}),"data-testid":"gantt-chart"},_?_({title:h,darkMode:C,viewMode:ce,onViewModeChange:Ye,showViewModeSelector:W}):o.default.createElement("div",{className:"p-6 border-b border-gantt-border"},o.default.createElement("div",{className:"flex justify-between items-center"},o.default.createElement("h1",{className:"text-2xl font-bold text-gantt-text ".concat(Oe.title)},h),W&&o.default.createElement("div",{className:"flex space-x-2"},B?B({activeMode:ce,onChange:Ye,darkMode:C,availableModes:[exports.ViewMode.DAY,exports.ViewMode.WEEK,exports.ViewMode.MONTH,exports.ViewMode.QUARTER,exports.ViewMode.YEAR]}):o.default.createElement(m,{activeMode:ce,onChange:Ye,darkMode:C})))),o.default.createElement("div",{className:"relative flex"},G?G({tasks:n,headerLabel:N,onGroupClick:ae,viewMode:ce}):o.default.createElement(p,{tasks:n,headerLabel:N,onGroupClick:ae,className:Oe.taskList,viewMode:ce}),o.default.createElement("div",{ref:le,className:"flex-grow overflow-x-auto rmg-gantt-scroll-container ".concat(we?"rmg-auto-scrolling":"")},o.default.createElement("div",{className:"min-w-max"},J?J({timeUnits:be,currentUnitIndex:Ve,viewMode:ce,locale:Y,unitWidth:he}):o.default.createElement(d,{months:be,currentMonthIndex:Ve,locale:Y,className:Oe.timeline,viewMode:ce,unitWidth:he}),o.default.createElement("div",{className:"relative"},k&&Ve>=0&&o.default.createElement(c,{currentMonthIndex:Ve,height:(Re=0,n.forEach((function(e){e&&Array.isArray(e.tasks)?Re+=Math.max(60,1*ie+20):Re+=60})),Re),label:T,dayOfMonth:w.getDate(),className:Oe.todayMarker,viewMode:ce,unitWidth:he}),n.map((function(e){return e&&e.id?o.default.createElement(x,{key:"task-row-".concat(e.id),taskGroup:e,startDate:xe,endDate:ke,totalMonths:Ne,monthWidth:he,editMode:E,showProgress:A,onTaskUpdate:Se,onTaskClick:Ce,onTaskSelect:Pe,onAutoScrollChange:Ae,className:Oe.taskRow,tooltipClassName:Oe.tooltip,viewMode:ce,scrollContainerRef:le,smoothDragging:U,movementThreshold:Q,animationSpeed:q,renderTask:j,renderTooltip:X,getTaskColor:Z}):null})))))))},exports.TaskItem=h,exports.TaskList=p,exports.TaskRow=x,exports.Timeline=d,exports.TodayMarker=c,exports.Tooltip=g,exports.ViewModeSelector=m;
//# sourceMappingURL=index.js.map
