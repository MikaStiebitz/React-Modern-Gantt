"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("date-fns");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r,n,o=a(e),i=function(){return i=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};function s(e,t,a){if(a||2===arguments.length)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}function l(e,t,a){if(void 0===t&&(t=exports.DateDisplayFormat.FULL_DATE),void 0===a&&(a="default"),!(e instanceof Date)||isNaN(e.getTime()))return"Invalid date";switch(t){case exports.DateDisplayFormat.MONTH_YEAR:return e.toLocaleString(a,{month:"short",year:"2-digit"});case exports.DateDisplayFormat.SHORT_DATE:return e.toLocaleString(a,{month:"short",day:"numeric"});case exports.DateDisplayFormat.FULL_DATE:default:return e.toLocaleString(a,{month:"short",day:"numeric",year:"numeric"})}}function d(e,t){var a=[];if(!(e instanceof Date&&t instanceof Date))return console.warn("getMonthsBetween: Invalid date parameters"),[new Date];for(var r=e.getFullYear(),n=e.getMonth(),o=t.getFullYear(),i=t.getMonth(),s=r;s<=o;s++)for(var l=s===o?i:11,d=s===r?n:0;d<=l;d++)a.push(new Date(s,d,1));return a}function c(e){if(!Array.isArray(e))return console.warn("detectTaskOverlaps: Invalid tasks array"),[];var t=e.filter((function(e){return e&&e.startDate instanceof Date&&e.endDate instanceof Date}));if(0===t.length)return[];var a=[];return t.forEach((function(e){for(var t=!1,r=0;r<a.length;r++){if(!a[r].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){a[r].push(e),t=!0;break}}t||a.push([e])})),a}function u(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.startDate instanceof Date&&(a?e.startDate<t&&(t=new Date(e.startDate)):(t=new Date(e.startDate),a=!0))}))})),!a){var r=new Date;return new Date(r.getFullYear(),r.getMonth()-1,1)}return new Date(t.getFullYear(),t.getMonth(),1)}function f(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.endDate instanceof Date&&(a?e.endDate>t&&(t=new Date(e.endDate)):(t=new Date(e.endDate),a=!0))}))})),!a){var r=new Date;return new Date(r.getFullYear(),r.getMonth()+2,0)}return new Date(t.getFullYear(),t.getMonth()+1,0)}"function"==typeof SuppressedError&&SuppressedError,exports.ViewMode=void 0,(r=exports.ViewMode||(exports.ViewMode={})).DAY="day",r.WEEK="week",r.MONTH="month",r.QUARTER="quarter",r.YEAR="year",exports.DateDisplayFormat=void 0,(n=exports.DateDisplayFormat||(exports.DateDisplayFormat={})).MONTH_YEAR="month-year",n.FULL_DATE="full-date",n.SHORT_DATE="short-date";var m=function(){function e(){}return e.detectOverlaps=function(e,t){var a=this;if(void 0===t&&(t=exports.ViewMode.MONTH),!Array.isArray(e)||0===e.length)return[];var r=s([],e,!0).sort((function(e,t){return e.startDate&&t.startDate?e.startDate.getTime()-t.startDate.getTime():0})),n=[];return r.forEach((function(e){for(var r=!1,o=0;o<n.length;o++){if(!n[o].some((function(r){return a.tasksVisuallyOverlap(e,r,t)}))){n[o].push(e),r=!0;break}}r||n.push([e])})),n},e.tasksVisuallyOverlap=function(e,t,a){if(void 0===a&&(a=exports.ViewMode.MONTH),!(e.startDate&&e.endDate&&t.startDate&&t.endDate))return!1;var r=e.startDate.getTime(),n=e.endDate.getTime(),o=t.startDate.getTime(),i=t.endDate.getTime(),s=this.getCollisionBufferByViewMode(a);return r+s<i-s&&n-s>o+s||Math.abs(r-o)<2*s||Math.abs(n-i)<2*s},e.getCollisionBufferByViewMode=function(e){var t=36e5,a=24*t;switch(e){case exports.ViewMode.DAY:return t;case exports.ViewMode.WEEK:return 4*t;case exports.ViewMode.MONTH:return 12*t;case exports.ViewMode.QUARTER:return a;case exports.ViewMode.YEAR:return 2*a;default:return 12*t}},e.wouldCollide=function(e,t,a,r){var n=this;return void 0===a&&(a=exports.ViewMode.MONTH),t.some((function(t){return t.id!==e.id&&t.id!==r&&n.tasksVisuallyOverlap(e,t,a)}))},e.getPreviewArrangement=function(e,t,a){void 0===a&&(a=exports.ViewMode.MONTH);var r=t.map((function(t){return t.id===e.id?e:t}));return this.detectOverlaps(r,a)},e}(),h=function(){function e(){}return e.calculateDatesFromPosition=function(e,a,r,n,o,i,s){void 0===s&&(s=exports.ViewMode.MONTH);try{var l=isNaN(e)?0:e,d=isNaN(a)||a<20?20:a,c=r.getTime(),u=(n.getTime()-c)/(o*i),f=l*u,m=d*u,h=new Date(c+f),v=new Date(c+f+m);if(s===exports.ViewMode.DAY){var g=Math.round(e/i),w=Math.max(1,Math.round(a/i)),p=new Date(r);p.setHours(0,0,0,0),(h=new Date(p)).setDate(p.getDate()+g),h.setHours(0,0,0,0),(v=new Date(h)).setDate(h.getDate()+w-1),v.setHours(23,59,59,999)}else h=t.startOfDay(h),v=t.endOfDay(v);return h<r&&(h=new Date(r)),v>n&&(v=new Date(n)),{newStartDate:h,newEndDate:v}}catch(e){return console.error("Error calculating dates from position:",e),{newStartDate:new Date(r),newEndDate:new Date(n)}}},e.createUpdatedTask=function(e,t,a){return i(i({},e),{startDate:new Date(t),endDate:new Date(a)})},e.calculateTaskPixelPosition=function(e,t,a,r,n,o){var i;void 0===o&&(o=exports.ViewMode.MONTH);try{if(!(e.startDate instanceof Date&&e.endDate instanceof Date))throw new Error("Invalid dates in task");var s=t.getTime(),l=a.getTime(),d=Math.max(e.startDate.getTime(),t.getTime()),c=Math.min(e.endDate.getTime(),a.getTime());if(o===exports.ViewMode.DAY){var u=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0).getTime(),f=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999).getTime();s=u,l=f;var m=new Date(new Date(d).getFullYear(),new Date(d).getMonth(),new Date(d).getDate(),0,0,0,0).getTime(),h=new Date(new Date(c).getFullYear(),new Date(c).getMonth(),new Date(c).getDate(),23,59,59,999).getTime();d=m,c=h}var v=l-s,g=r*n,w=(d-s)/v*g,p=(c-d)/v*g;o===exports.ViewMode.DAY&&(w=Math.round(w/n)*n,p=Math.max(n,Math.round(p/n)*n));var D=((i={})[exports.ViewMode.DAY]=20,i[exports.ViewMode.WEEK]=20,i[exports.ViewMode.MONTH]=20,i[exports.ViewMode.QUARTER]=30,i[exports.ViewMode.YEAR]=40,i)[o]||20;p=Math.max(D,p);var M=g-w;return{leftPx:w,widthPx:p=Math.min(M,p)}}catch(t){return console.error("Error calculating task position:",t,e),{leftPx:0,widthPx:20}}},e.getLiveDatesFromElement=function(e,t,a,r,n,o){void 0===o&&(o=exports.ViewMode.MONTH);try{if(!e)return{startDate:new Date(t),endDate:new Date(a)};var i=parseFloat(e.style.left||"0"),s=parseFloat(e.style.width||"0"),l=this.calculateDatesFromPosition(i,s,t,a,r,n,o);return{startDate:l.newStartDate,endDate:l.newEndDate}}catch(e){return console.error("Error getting live dates:",e),{startDate:new Date(t),endDate:new Date(a)}}},e.formatDate=function(e,t,a){if(void 0===t&&(t="default"),void 0===a&&(a=exports.ViewMode.MONTH),!(e instanceof Date)||isNaN(e.getTime()))return"Invalid date";var r;switch(a){case exports.ViewMode.DAY:case exports.ViewMode.WEEK:case exports.ViewMode.MONTH:r={year:"numeric",month:"short",day:"numeric"};break;case exports.ViewMode.QUARTER:r={year:"numeric",month:"short"};break;case exports.ViewMode.YEAR:r={year:"numeric"};break;default:r={year:"numeric",month:"short",day:"numeric"}}return e.toLocaleDateString(t,r)},e.getDuration=function(e,a,r){void 0===r&&(r=exports.ViewMode.MONTH);try{if(!(e instanceof Date)||!(a instanceof Date)||isNaN(e.getTime())||isNaN(a.getTime()))return{value:0,unit:"days"};var n=e<a?e:a,o=e<a?a:e;switch(r){case exports.ViewMode.DAY:var i=t.differenceInDays(o,n)+1;return{value:i,unit:1===i?"day":"days"};case exports.ViewMode.WEEK:var s=t.differenceInWeeks(o,n)+1;return{value:s,unit:1===s?"week":"weeks"};case exports.ViewMode.MONTH:var l=t.differenceInMonths(o,n)+1;return{value:l,unit:1===l?"month":"months"};case exports.ViewMode.QUARTER:var d=t.differenceInQuarters(o,n)+1;return{value:d,unit:1===d?"quarter":"quarters"};case exports.ViewMode.YEAR:var c=t.differenceInYears(o,n)+1;return{value:c,unit:1===c?"year":"years"};default:var u=t.differenceInDays(o,n)+1;return{value:u,unit:1===u?"day":"days"}}}catch(e){return console.error("Error calculating duration:",e),{value:0,unit:"days"}}},e.datesOverlap=function(e,a,r,n){return t.isWithinInterval(e,{start:r,end:n})||t.isWithinInterval(a,{start:r,end:n})||t.isWithinInterval(r,{start:e,end:a})||t.isWithinInterval(n,{start:e,end:a})},e}(),v=function(e){var t=e.task,a=e.leftPx,r=e.widthPx,n=e.topPx,s=e.isHovered,l=e.isDragging,d=e.editMode,c=e.showProgress,u=void 0!==c&&c,f=e.instanceId,m=e.renderTask,h=e.getTaskColor,v=e.onMouseDown,g=e.onMouseEnter,w=e.onMouseLeave,p=e.onClick,D=(s||l)&&d;if(!t||!t.id)return console.warn("TaskItem: Invalid task data",t),null;var M=t.color||"bg-gantt-task",x="",y="text-gantt-task-text";if(h){var E=h({task:t,isHovered:s,isDragging:l});M=E.backgroundColor,x=E.borderColor||"",y=E.textColor||y}if(m){var k=m({task:t,leftPx:a,widthPx:r,topPx:n,isHovered:s,isDragging:l,editMode:d,showProgress:u});return o.default.createElement("div",{className:"absolute",style:{left:"".concat(Math.max(0,a),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(n,"px")},onClick:function(e){return p(e,t)},onMouseDown:function(e){return v(e,t,"move")},onMouseEnter:function(e){return g(e,t)},onMouseLeave:w,"data-testid":"task-".concat(t.id),"data-task-id":t.id,"data-instance-id":f},k)}var b=M.startsWith("bg-")?{}:{backgroundColor:M},T=M.startsWith("bg-")?M:"",N=x?x.startsWith("border-")?{}:{borderColor:x,borderWidth:"1px"}:{},V=x&&x.startsWith("border-")?x:"";return o.default.createElement("div",{className:"absolute h-8 rounded ".concat(T," ").concat(V," ").concat(y," flex items-center px-2 text-xs font-medium ").concat(d?"cursor-move":"cursor-pointer"),style:i(i({left:"".concat(Math.max(0,a),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(n,"px")},b),N),onClick:function(e){return p(e,t)},onMouseDown:function(e){return v(e,t,"move")},onMouseEnter:function(e){return g(e,t)},onMouseLeave:w,"data-testid":"task-".concat(t.id),"data-task-id":t.id,"data-instance-id":f},D&&o.default.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-l",onMouseDown:function(e){e.stopPropagation(),v(e,t,"resize-left")}}),o.default.createElement("div",{className:"truncate select-none"},t.name||"Unnamed Task"),u&&"number"==typeof t.percent&&o.default.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 dark:bg-opacity-30 rounded-full overflow-hidden"},o.default.createElement("div",{className:"h-full bg-white dark:bg-gray-200 rounded-full",style:{width:"".concat(t.percent,"%")}})),D&&o.default.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-r",onMouseDown:function(e){e.stopPropagation(),v(e,t,"resize-right")}}))},g=function(e){var a=e.task,r=e.position,n=e.dragType,i=e.taskId,s=e.startDate,l=e.endDate,d=e.totalMonths,c=e.monthWidth,u=e.showProgress,f=void 0!==u&&u,m=e.instanceId,v=e.className,g=void 0===v?"":v,w=e.viewMode,p=void 0===w?exports.ViewMode.MONTH:w,D=e.renderTooltip,M=a.startDate,x=a.endDate;try{var y=i||a.id,E=document.querySelector('[data-task-id="'.concat(y,'"][data-instance-id="').concat(m,'"]'));if(E&&(n||E.style.left||E.style.width)){var k=h.getLiveDatesFromElement(E,s,l,d,c,p);M=k.startDate,x=k.endDate}}catch(e){console.error("Error calculating live dates for tooltip:",e)}var b=h.getDuration(M,x,p),T=function(e){return e instanceof Date&&!isNaN(e.getTime())?p===exports.ViewMode.DAY?t.format(e,"EEE, MMM d, yyyy"):t.format(e,"MMM d, yyyy"):"Invalid date"},N=function(){if(!n)return null;switch(n){case"move":return"Moving task...";case"resize-left":return"Adjusting start date...";case"resize-right":return"Adjusting end date...";default:return null}}();return D?o.default.createElement("div",{className:"rmg-task-tooltip absolute z-20 ".concat(g),style:{left:"".concat(r.x,"px"),top:"".concat(r.y-40,"px")}},D({task:a,position:r,dragType:n,startDate:M,endDate:x,viewMode:p})):o.default.createElement("div",{className:"rmg-task-tooltip absolute z-20 bg-[var(--rmg-tooltip-bg,#ffffff)] text-[var(--rmg-tooltip-text,#1f2937)] border border-[var(--rmg-tooltip-border,#e5e7eb)] rounded-md shadow-md p-2 text-xs select-none ".concat(g),style:{left:"".concat(r.x,"px"),top:"".concat(r.y-40,"px"),minWidth:"200px"}},o.default.createElement("div",{className:"font-bold mb-1"},a.name||"Unnamed Task"),N&&o.default.createElement("div",{className:"text-xs text-blue-500 dark:text-blue-400 mb-1 italic"},N),o.default.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},o.default.createElement("div",{className:"font-semibold"},"Start:"),o.default.createElement("div",null,T(M)),o.default.createElement("div",{className:"font-semibold"},"End:"),o.default.createElement("div",null,T(x)),o.default.createElement("div",{className:"font-semibold"},"Duration:"),o.default.createElement("div",null,b.value," ",b.unit),f&&"number"==typeof a.percent&&o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"font-semibold"},"Progress:"),o.default.createElement("div",null,a.percent,"%")),a.dependencies&&a.dependencies.length>0&&o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"font-semibold"},"Dependencies:"),o.default.createElement("div",null,a.dependencies.join(", ")))))},w=function(t){var a=t.taskGroup,r=t.startDate,n=t.endDate,s=t.totalMonths,l=t.monthWidth,d=t.editMode,c=void 0===d||d,u=t.showProgress,f=void 0!==u&&u,w=t.className,p=void 0===w?"":w,D=t.tooltipClassName,M=void 0===D?"":D,x=t.onTaskUpdate,y=t.onTaskClick,E=t.onTaskSelect,k=t.viewMode,b=void 0===k?exports.ViewMode.MONTH:k,T=t.scrollContainerRef,N=t.smoothDragging,V=void 0===N||N,A=t.movementThreshold,Y=void 0===A?3:A;if(!a||!a.id||!Array.isArray(a.tasks))return console.warn("TaskRow: Invalid task group data",a),o.default.createElement("div",{className:"relative h-16 text-gantt-text"},"Invalid task group data");var R=r instanceof Date?r:new Date,F=n instanceof Date?n:new Date,O=e.useState(null),S=O[0],H=O[1],I=e.useState(null),C=I[0],L=I[1],P=e.useState(null),W=P[0],U=P[1],z=e.useState(0),Q=z[0],K=z[1],_=e.useState({x:0,y:0}),q=_[0],j=_[1],B=e.useState(null),G=B[0],X=B[1],J=e.useState(null),Z=J[0],$=J[1],ee=e.useRef({left:0,width:0}),te=e.useRef(0),ae=e.useRef(0),re=e.useRef(!1),ne=e.useRef(null),oe=e.useRef(0),ie=e.useRef(null),se=e.useRef(null),le=e.useRef(null),de=e.useRef(null),ce=e.useRef("task-row-".concat(Math.random().toString(36).substring(2,11))),ue=function(e){X(e),de.current=e},fe=G?m.getPreviewArrangement(G,a.tasks,b):m.detectOverlaps(a.tasks,b),me=Math.max(60,40*fe.length+20),he=function(){if(!re.current){re.current=!0;var e=function(){if(re.current&&(null==T?void 0:T.current)){var t=T.current,a=ie.current,r=oe.current;"left"===a?t.scrollLeft-=r:"right"===a&&(t.scrollLeft+=r),re.current&&(ne.current=requestAnimationFrame(e))}};ne.current=requestAnimationFrame(e)}},ve=function(){re.current=!1,null!==ne.current&&(cancelAnimationFrame(ne.current),ne.current=null)},ge=function(e,t){y&&!C&&y(t,a),E&&E(t,!0)},we=function(e,t){C||(H(t),De(e))},pe=function(){C||H(null)},De=function(e){if(se.current){var t=se.current.getBoundingClientRect();j({x:e.clientX-t.left+20,y:e.clientY-t.top})}},Me=function(e,t,a){if(c){e.preventDefault(),e.stopPropagation();var r=document.querySelector('[data-task-id="'.concat(t.id,'"][data-instance-id="').concat(ce.current,'"]'));if(r){var n=parseFloat(r.style.left||"0"),o=parseFloat(r.style.width||"0");$({left:n,width:o,startDate:new Date(t.startDate),endDate:new Date(t.endDate)}),ee.current={left:n,width:o},te.current=Date.now(),ae.current=0,L(t),U(a),K(e.clientX),X(t),function(e){L(e),le.current=e}(t),ue(t),document.addEventListener("mouseup",ke),document.addEventListener("mousemove",xe)}}},xe=function(e){if(e instanceof MouseEvent&&S&&se.current){var t=e,a=se.current.getBoundingClientRect();j({x:t.clientX-a.left+20,y:t.clientY-a.top})}else e instanceof MouseEvent||De(e);if(C&&(null==T?void 0:T.current)&&function(e){if((null==T?void 0:T.current)&&C){var t=T.current.getBoundingClientRect(),a=null,r=0;e<t.left+40?(a="left",r=Math.max(1,Math.round((40-(e-t.left))/10))):e>t.right-40&&(a="right",r=Math.max(1,Math.round((e-(t.right-40))/10))),ie.current=a,oe.current=r,a&&!re.current?he():!a&&re.current&&ve()}}(e.clientX),C&&W&&Z&&se.current)try{var r=document.querySelector('[data-task-id="'.concat(C.id,'"][data-instance-id="').concat(ce.current,'"]'));if(!r)return;var n=e.clientX-Q;if(V&&(ae.current+=n-(Z.left+ae.current-Z.left),Math.abs(ae.current)<Y))return;var o=s*l,d=Z.left,c=Z.width,u=!1;switch(W){case"move":if(d=Math.max(0,Math.min(o-Z.width,Z.left+n)),b===exports.ViewMode.DAY){var f=Math.round(d/l)*l;Math.abs(f-ee.current.left)>=Y?(d=f,u=!0):d=ee.current.left}else Math.abs(d-ee.current.left)>=Y?u=!0:d=ee.current.left;u&&(r.style.left="".concat(d,"px"),ee.current.left=d);break;case"resize-left":var m=Z.width-20,h=Math.min(m,n);if(d=Math.max(0,Z.left+h),b===exports.ViewMode.DAY){f=Math.round(d/l)*l;Math.abs(f-ee.current.left)>=Y?(d=f,u=!0):d=ee.current.left}else Math.abs(d-ee.current.left)>=Y?u=!0:d=ee.current.left;var v=Z.left+Z.width;c=Math.max(20,v-d),u&&(r.style.left="".concat(d,"px"),r.style.width="".concat(c,"px"),ee.current={left:d,width:c});break;case"resize-right":if(c=Math.max(20,Math.min(o-Z.left,Z.width+n)),b===exports.ViewMode.DAY){var g=Z.left+c,w=Math.round(g/l)*l,p=Math.max(20,w-Z.left);Math.abs(p-ee.current.width)>=Y?(c=p,u=!0):c=ee.current.width}else Math.abs(c-ee.current.width)>=Y?u=!0:c=ee.current.width;u&&(r.style.width="".concat(c,"px"),ee.current.width=c)}if(u){if(b===exports.ViewMode.DAY){var D=Math.round(d/l),M=Math.max(1,Math.round(c/l)),x=new Date(R);x.setHours(0,0,0,0),(O=new Date(x)).setDate(x.getDate()+D),O.setHours(0,0,0,0),(H=new Date(O)).setDate(O.getDate()+M-1),H.setHours(23,59,59,999);var y=i(i({},C),{startDate:O,endDate:H});X(y),ue(y)}else{var E=ye(R,F,b)/o,k=R.getTime()+d*E,N=R.getTime()+(d+c)*E,A=Ee(new Date(k),new Date(N),b),O=A.newStartDate,H=A.newEndDate;y=i(i({},C),{startDate:O,endDate:H});X(y),ue(y)}ae.current=0,te.current=Date.now()}}catch(e){console.error("Error in handleMouseMove:",e)}},ye=function(e,t,a){var r=new Date(e).setHours(0,0,0,0),n=new Date(t).setHours(23,59,59,999)-r;return exports.ViewMode.DAY,n},Ee=function(e,t,a){var r=new Date(e),n=new Date(t);switch(a){case exports.ViewMode.DAY:r=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0),n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);case exports.ViewMode.WEEK:case exports.ViewMode.MONTH:case exports.ViewMode.QUARTER:case exports.ViewMode.YEAR:}return{newStartDate:r,newEndDate:n}},ke=function(){try{var e=le.current,t=de.current;e&&t&&x&&x(a.id,t)}catch(e){console.error("Error in handleMouseUp:",e)}finally{ve(),L(null),U(null),X(null),$(null),le.current=null,de.current=null,ae.current=0,document.removeEventListener("mouseup",ke),document.removeEventListener("mousemove",xe)}};return e.useEffect((function(){return function(){document.removeEventListener("mouseup",ke),document.removeEventListener("mousemove",xe),ve()}}),[]),a.tasks&&0!==a.tasks.length?o.default.createElement("div",{className:"relative border-b border-gantt-border ".concat(p),style:{height:"".concat(me,"px")},onMouseMove:function(e){return xe(e)},onMouseLeave:function(){return H(null)},ref:se,"data-testid":"task-row-".concat(a.id),"data-instance-id":ce.current},fe.map((function(e,t){return o.default.createElement(o.default.Fragment,{key:"task-row-".concat(t)},e.map((function(e){try{if(!(e&&e.id&&e.startDate instanceof Date&&e.endDate instanceof Date))return console.warn("Invalid task data:",e),null;var a=h.calculateTaskPixelPosition(e,R,F,s,l,b),r=a.leftPx,n=a.widthPx,i=(null==S?void 0:S.id)===e.id,d=(null==C?void 0:C.id)===e.id,u=40*t+10;return o.default.createElement(v,{key:"task-".concat(e.id),task:e,leftPx:r,widthPx:n,topPx:u,isHovered:i,isDragging:d,editMode:c,showProgress:f,instanceId:ce.current,onMouseDown:Me,onMouseEnter:we,onMouseLeave:pe,onClick:ge})}catch(t){return console.error("Error rendering task:",t,e),null}})))})),(S||C)&&o.default.createElement(g,{task:G||C||S,position:q,dragType:W,taskId:null==C?void 0:C.id,startDate:R,endDate:F,totalMonths:s,monthWidth:l,showProgress:f,instanceId:ce.current,className:M,viewMode:b})):o.default.createElement("div",{className:"relative h-16 text-gantt-text"},"No tasks available")},p=function(e){var a=e.months,r=e.currentMonthIndex,n=(e.locale,e.className),i=void 0===n?"":n,s=e.viewMode,l=void 0===s?exports.ViewMode.MONTH:s,d=e.unitWidth,c=void 0===d?150:d,u=[exports.ViewMode.DAY,exports.ViewMode.WEEK].includes(l),f=function(){if(![exports.ViewMode.DAY,exports.ViewMode.WEEK].includes(l)||0===a.length)return[];var e=[],t=new Date(a[0]),r=0;return a.forEach((function(a){a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()?r+=1:(e.push({date:t,span:r}),t=new Date(a),r=1)})),r>0&&e.push({date:t,span:r}),e}();return o.default.createElement("div",{className:"rmg-timeline ".concat(i),style:{"--gantt-unit-width":"".concat(c,"px")}},u&&o.default.createElement("div",{className:"flex border-b border-gantt-border"},f.map((function(e,a){return o.default.createElement("div",{key:"higher-level-".concat(a),className:"flex-shrink-0 p-2 font-semibold text-center text-gantt-text border-r border-gantt-border h-10",style:{width:"".concat(e.span*c,"px")},"data-timeunit-higher":e.date.toISOString()},function(e){if(!(e instanceof Date))return"";switch(l){case exports.ViewMode.DAY:case exports.ViewMode.WEEK:}return t.format(e,"MMM yyyy",{locale:void 0})}(e.date))}))),o.default.createElement("div",{className:"flex border-b border-gantt-border"},a.map((function(e,a){return o.default.createElement("div",{key:"timeunit-".concat(a),className:"".concat("w-[var(--gantt-unit-width)]"," flex-shrink-0 p-2 font-semibold text-center text-gantt-text ").concat(a===r?"bg-gantt-highlight":""," ").concat(u?"border-r border-gantt-border":""," h-10"),"data-timeunit":e.toISOString(),"data-date":(n=e,l===exports.ViewMode.DAY?n.toISOString().slice(0,10):"")},function(e){if(!(e instanceof Date&&t.isValid(e)))return"";switch(l){case exports.ViewMode.DAY:return t.format(e,"d",{locale:void 0});case exports.ViewMode.WEEK:var a=t.getWeek(e);return"W".concat(a);case exports.ViewMode.MONTH:return t.format(e,"MMM yyyy",{locale:void 0});case exports.ViewMode.QUARTER:var r=Math.floor(e.getMonth()/3)+1;return"Q".concat(r," ").concat(e.getFullYear());case exports.ViewMode.YEAR:return e.getFullYear().toString();default:return t.format(e,"MMM yyyy",{locale:void 0})}}(e));var n}))))},D=function(e){var t=e.currentMonthIndex,a=e.height,r=e.markerClass,n=void 0===r?"bg-red-500":r,i=e.label,s=void 0===i?"Today":i,l=e.dayOfMonth,d=e.className,c=void 0===d?"":d,u=e.viewMode,f=void 0===u?exports.ViewMode.MONTH:u,m=e.unitWidth,h=void 0===m?150:m;if(t<0)return null;var v=function(){var e=new Date;switch(l||e.getDate(),f){case exports.ViewMode.DAY:return t*h+h/2;case exports.ViewMode.WEEK:var a=e.getDay();return t*h+h*(a/7);case exports.ViewMode.MONTH:a=e.getDay();return t*h+h*(a/7);case exports.ViewMode.QUARTER:var r=e.getMonth()%3;return t*h+h*(r/3);case exports.ViewMode.YEAR:var n=e.getMonth();return t*h+h*(n/12);default:return t*h+h/2}}();return o.default.createElement("div",{className:"absolute top-0 w-px ".concat(n," z-10 ").concat(c),style:{left:"".concat(v,"px"),height:"".concat(a,"px")},"data-testid":"today-marker"},o.default.createElement("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 ".concat(n," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},s))},M=function(t){var a=t.activeMode,r=t.onChange,n=t.darkMode,i=[{id:exports.ViewMode.DAY,label:"Day"},{id:exports.ViewMode.WEEK,label:"Week"},{id:exports.ViewMode.MONTH,label:"Month"},{id:exports.ViewMode.QUARTER,label:"Quarter"},{id:exports.ViewMode.YEAR,label:"Year"}],s=e.useRef(null),l=e.useState({left:"0px",width:"0px"}),d=l[0],c=l[1];e.useEffect((function(){var e=function(){if(s.current){var e=s.current.querySelector('[aria-selected="true"]');if(e){var t=e,a=t.offsetLeft,r=t.offsetWidth;c({left:"".concat(a,"px"),width:"".concat(r,"px")})}}};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[a]);var u="\n        relative inline-flex rounded-full p-0.5\n        ".concat(n?"bg-gray-800/80":"bg-gray-100/90","\n        transition-all duration-300 ease-in-out shadow-sm\n        border ").concat(n?"border-gray-700":"border-gray-200","\n    ");return o.default.createElement("div",{className:"relative flex items-center"},o.default.createElement("div",{ref:s,className:u,role:"tablist","aria-label":"View mode options"},o.default.createElement("span",{className:"\n                        absolute z-0 inset-0.5 rounded-full\n                        transition-all duration-300 ease-out transform\n                        ".concat(n?"bg-indigo-600":"bg-indigo-500","\n                    "),style:d,"aria-hidden":"true"}),i.map((function(e){return o.default.createElement("button",{key:e.id,role:"tab","aria-selected":a===e.id,"aria-controls":"panel-".concat(e.id),className:"".concat((t=a===e.id,"\n        relative z-10 px-3 py-1 text-xs font-medium\n        transition-all duration-200 ease-in-out\n        ".concat(t?"text-white":n?"text-gray-400 hover:text-gray-200":"text-gray-500 hover:text-gray-700","\n        focus:outline-none\n    "))," rounded-full"),onClick:function(){return r(e.id)}},e.label);var t}))))},x=function(e){var t=e.tasks,a=void 0===t?[]:t,r=e.headerLabel,n=void 0===r?"Resources":r,i=e.showIcon,s=void 0!==i&&i,l=e.showTaskCount,d=void 0!==l&&l,u=e.showDescription,f=void 0===u||u,m=e.rowHeight,h=void 0===m?40:m,v=e.className,g=void 0===v?"":v,w=e.onGroupClick,p=e.viewMode,D=Array.isArray(a)?a:[],M=p===exports.ViewMode.DAY||p===exports.ViewMode.WEEK;return o.default.createElement("div",{className:"rmg-task-list w-40 flex-shrink-0 z-10 bg-gantt-bg shadow-sm ".concat(g)},M?o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"}),o.default.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},n)):o.default.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},n),D.map((function(e){if(!e)return null;var t=function(e){if(!e.tasks||!Array.isArray(e.tasks))return 60;var t=c(e.tasks);return Math.max(60,t.length*h+20)}(e);return o.default.createElement("div",{key:"task-group-".concat(e.id||"unknown"),className:"p-2 border-r border-b border-gantt-border font-medium text-gantt-text bg-gantt-bg hover:bg-gantt-highlight transition-colors duration-150",style:{height:"".concat(t,"px")},onClick:function(){return t=e,void(w&&w(t));var t},"data-testid":"task-group-".concat(e.id||"unknown")},o.default.createElement("div",{className:"flex items-center"},s&&e.icon&&o.default.createElement("span",{className:"mr-2",dangerouslySetInnerHTML:{__html:e.icon}}),o.default.createElement("div",{className:"font-medium truncate"},e.name||"Unnamed")),f&&e.description&&o.default.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate"},e.description),d&&e.tasks&&e.tasks.length>0&&o.default.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1"},e.tasks.length," ",1===e.tasks.length?"task":"tasks"))})))};exports.CollisionManager=m,exports.GanttChart=function(a){var r=a.tasks,n=void 0===r?[]:r,l=a.startDate,m=a.endDate,h=a.title,v=void 0===h?"Project Timeline":h,g=a.currentDate,y=void 0===g?new Date:g,E=a.showCurrentDateMarker,k=void 0===E||E,b=a.todayLabel,T=void 0===b?"Today":b,N=a.editMode,V=void 0===N||N,A=a.headerLabel,Y=void 0===A?"Resources":A,R=a.showProgress,F=void 0!==R&&R,O=a.darkMode,S=void 0!==O&&O,H=a.locale,I=void 0===H?"default":H,C=a.styles,L=void 0===C?{}:C,P=a.viewMode,W=void 0===P?exports.ViewMode.MONTH:P,U=a.showViewModeSelector,z=void 0===U||U,Q=a.smoothDragging,K=void 0===Q||Q,_=a.movementThreshold,q=void 0===_?3:_,j=a.renderTaskList,B=a.renderTask,G=a.renderTooltip,X=a.getTaskColor,J=a.onTaskUpdate,Z=a.onTaskClick,$=a.onTaskSelect;a.onTaskDoubleClick;var ee=a.onGroupClick,te=a.onViewModeChange,ae=a.fontSize,re=a.rowHeight,ne=void 0===re?40:re;a.timeStep;var oe=e.useRef(null),ie=e.useRef(null),se=e.useState(W),le=se[0],de=se[1],ce=e.useState([]);ce[0];var ue=ce[1],fe=e.useState(150),me=fe[0],he=fe[1],ve=l||u(n),ge=m||f(n),we=function(e,a){var r=[],n=new Date(e);n.setHours(0,0,0,0);var o=new Date(a);for(o.setHours(23,59,59,999);n<=o;)r.push(new Date(n)),n=t.addDays(n,1);return r},pe=function(e,a){for(var r=[],n=new Date(e);n<=a;)r.push(new Date(n)),n=t.addDays(n,7);return r},De=function(e,a){for(var r=[],n=t.startOfQuarter(new Date(e));n<=a;)r.push(new Date(n)),n=t.addQuarters(n,1);return r},Me=function(e,a){for(var r=[],n=t.startOfYear(new Date(e));n<=a;)r.push(new Date(n)),n=t.addYears(n,1);return r},xe=function(){switch(le){case exports.ViewMode.DAY:return we(ve,ge);case exports.ViewMode.WEEK:return pe(ve,ge);case exports.ViewMode.MONTH:return d(ve,ge);case exports.ViewMode.QUARTER:return De(ve,ge);case exports.ViewMode.YEAR:return Me(ve,ge);default:return d(ve,ge)}}(),ye=xe.length,Ee=function(){var e=new Date;switch(le){case exports.ViewMode.DAY:return xe.findIndex((function(t){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case exports.ViewMode.WEEK:return xe.findIndex((function(t){var a=new Date(t);return a.setDate(t.getDate()+6),e>=t&&e<=a}));case exports.ViewMode.MONTH:return xe.findIndex((function(t){return t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case exports.ViewMode.QUARTER:var t=Math.floor(e.getMonth()/3);return xe.findIndex((function(a){return Math.floor(a.getMonth()/3)===t&&a.getFullYear()===e.getFullYear()}));case exports.ViewMode.YEAR:return xe.findIndex((function(t){return t.getFullYear()===e.getFullYear()}));default:return-1}}(),ke=function(e,t){if(J)try{var a=i(i({},t),{startDate:t.startDate instanceof Date?t.startDate:new Date(t.startDate),endDate:t.endDate instanceof Date?t.endDate:new Date(t.endDate)});J(e,a)}catch(e){console.error("Error in handleTaskUpdate:",e)}},be=function(e,t){if(Z)try{Z(e,t)}catch(e){console.error("Error in handleTaskClick:",e)}},Te=function(e,t){if(ue((function(a){return t?s(s([],a,!0),[e.id],!1):a.filter((function(t){return t!==e.id}))})),$)try{$(e,t)}catch(e){console.error("Error in onTaskSelect handler:",e)}},Ne=function(e){switch(de(e),e){case exports.ViewMode.DAY:he(50);break;case exports.ViewMode.WEEK:he(80);break;case exports.ViewMode.MONTH:he(150);break;case exports.ViewMode.QUARTER:he(180);break;case exports.ViewMode.YEAR:he(200);break;default:he(150)}te&&te(e)};e.useEffect((function(){Ne(W)}),[W]);var Ve,Ae={fontSize:ae||"inherit"},Ye=S?"dark":"",Re=i(i({},{container:"",title:"",header:"",taskList:"",timeline:"",taskRow:"",todayMarker:"",tooltip:""}),L);return o.default.createElement("div",{ref:oe,className:"rmg-gantt-chart w-full bg-gantt-bg text-gantt-text rounded-xl shadow-lg overflow-hidden ".concat(Ye," ").concat(Re.container),style:i(i({},Ae),{"--gantt-unit-width":"".concat(me,"px")}),"data-testid":"gantt-chart"},o.default.createElement("div",{className:"p-6 border-b border-gantt-border"},o.default.createElement("div",{className:"flex justify-between items-center"},o.default.createElement("h1",{className:"text-2xl font-bold text-gantt-text ".concat(Re.title)},v),z&&o.default.createElement("div",{className:"flex space-x-2"},o.default.createElement(M,{activeMode:le,onChange:Ne,darkMode:S})))),o.default.createElement("div",{className:"relative flex"},j?j({tasks:n,headerLabel:Y,onGroupClick:ee,viewMode:le}):o.default.createElement(x,{tasks:n,headerLabel:Y,onGroupClick:ee,className:Re.taskList,viewMode:le}),o.default.createElement("div",{ref:ie,className:"flex-grow overflow-x-auto"},o.default.createElement("div",{className:"min-w-max"},o.default.createElement(p,{months:xe,currentMonthIndex:Ee,locale:I,className:Re.timeline,viewMode:le,unitWidth:me}),o.default.createElement("div",{className:"relative"},k&&Ee>=0&&o.default.createElement(D,{currentMonthIndex:Ee,height:(Ve=0,n.forEach((function(e){if(e&&Array.isArray(e.tasks)){var t=c(e.tasks);Ve+=Math.max(60,t.length*ne+20)}else Ve+=60})),Ve),label:T,dayOfMonth:y.getDate(),className:Re.todayMarker,viewMode:le,unitWidth:me}),n.map((function(e){return e&&e.id?o.default.createElement(w,{key:"task-row-".concat(e.id),taskGroup:e,startDate:ve,endDate:ge,totalMonths:ye,monthWidth:me,editMode:V,showProgress:F,onTaskUpdate:ke,onTaskClick:be,onTaskSelect:Te,className:Re.taskRow,tooltipClassName:Re.tooltip,viewMode:le,scrollContainerRef:ie,smoothDragging:K,movementThreshold:q,renderTask:B,renderTooltip:G,getTaskColor:X}):null})))))))},exports.TaskItem=v,exports.TaskList=x,exports.TaskManager=h,exports.TaskRow=w,exports.Timeline=p,exports.TodayMarker=D,exports.Tooltip=g,exports.calculateDuration=function(e,t){var a;if(!(e instanceof Date&&t instanceof Date))return 0;e>t&&(e=(a=[t,e])[0],t=a[1]);var r=Math.abs(t.getTime()-e.getTime());return Math.ceil(r/864e5)},exports.calculateTaskPosition=function(e,t,a){if(!(e.startDate instanceof Date&&e.endDate instanceof Date))return console.warn("calculateTaskPosition: Invalid task dates",e),{left:"0%",width:"10%"};var r=d(new Date(t.getFullYear(),t.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)),n=r.length,o=e.startDate.getFullYear(),i=e.startDate.getMonth(),s=r.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===i})),l=s<0?0:s,c=e.endDate.getFullYear(),u=e.endDate.getMonth(),f=r.findIndex((function(e){return e.getFullYear()===c&&e.getMonth()===u})),m=((f<0?r.length-1:f)-l+1)/n*100;return{left:"".concat(l/n*100,"%"),width:"".concat(m,"%")}},exports.detectTaskOverlaps=c,exports.findEarliestDate=u,exports.findLatestDate=f,exports.formatDate=l,exports.formatDateRange=function(e,t,a){if(void 0===a&&(a="default"),!(e instanceof Date&&t instanceof Date))return"Invalid date range";var r=l(e,exports.DateDisplayFormat.SHORT_DATE,a),n=l(t,exports.DateDisplayFormat.SHORT_DATE,a);return"".concat(r," - ").concat(n)},exports.formatMonth=function(e,t){return void 0===t&&(t="default"),e.toLocaleString(t,{month:"short"})},exports.getDaysInMonth=function(e,t){return new Date(e,t+1,0).getDate()},exports.getMonthsBetween=d,exports.getStandardDayMarkers=function(){return[1,8,15,22,29]};
//# sourceMappingURL=index.js.map
