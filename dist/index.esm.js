import e,{useState as t,useRef as n,useEffect as a}from"react";var r,o=function(){return o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError,function(e){e.MONTH_YEAR="month-year",e.FULL_DATE="full-date",e.SHORT_DATE="short-date"}(r||(r={}));var i={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function l(e){return e.toLocaleString("default",{month:"short"})}function s(e,t){switch(void 0===t&&(t=r.FULL_DATE),t){case r.MONTH_YEAR:return e.toLocaleString("default",{month:"short",year:"2-digit"});case r.SHORT_DATE:return e.toLocaleString("default",{month:"short",day:"numeric"});case r.FULL_DATE:default:return e.toLocaleString("default",{month:"short",day:"numeric",year:"numeric"})}}function c(e,t){for(var n=[],a=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),i=t.getMonth(),l=a;l<=o;l++)for(var s=l===o?i:11,c=l===a?r:0;c<=s;c++)n.push(new Date(l,c,1));return n}function d(e,t){return new Date(e,t+1,0).getDate()}function u(){return[1,8,15,22,29]}function m(e,t,n){var a=c(new Date(t.getFullYear(),t.getMonth(),1),new Date(n.getFullYear(),n.getMonth()+1,0)),r=a.length,o=e.startDate.getFullYear(),i=e.startDate.getMonth(),l=a.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===i})),s=l<0?0:l,d=e.endDate.getFullYear(),u=e.endDate.getMonth(),m=a.findIndex((function(e){return e.getFullYear()===d&&e.getMonth()===u})),f=((m<0?a.length-1:m)-s+1)/r*100;return{left:"".concat(s/r*100,"%"),width:"".concat(f,"%")}}function f(e){var t=[];return e.forEach((function(e){for(var n=!1,a=0;a<t.length;a++){if(!t[a].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){t[a].push(e),n=!0;break}}n||t.push([e])})),t}function h(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function v(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}var g=function(){function e(){}return e.detectOverlaps=function(e){if(!Array.isArray(e)||0===e.length)return[];var t=[];return e.forEach((function(e){for(var n=!1,a=0;a<t.length;a++){if(!t[a].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){t[a].push(e),n=!0;break}}n||t.push([e])})),t},e.wouldCollide=function(e,t,n){return t.some((function(t){return t.id!==e.id&&t.id!==n&&!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))},e.getPreviewArrangement=function(e,t){var n=t.map((function(t){return t.id===e.id?e:t}));return this.detectOverlaps(n)},e}(),D=function(){function e(){}return e.calculateDatesFromPosition=function(e,t,n,a,r,o){try{var i=isNaN(e)?0:e,l=isNaN(t)||t<20?20:t,s=n.getTime(),c=(a.getTime()-s)/(r*o),d=i*c,u=l*c;return{newStartDate:new Date(s+d),newEndDate:new Date(s+d+u)}}catch(e){return console.error("Error calculating dates from position:",e),{newStartDate:new Date(n),newEndDate:new Date(a)}}},e.createUpdatedTask=function(e,t,n){return o(o({},e),{startDate:new Date(t),endDate:new Date(n)})},e.calculateTaskPixelPosition=function(e,t,n,a,r){try{if(!(e.startDate instanceof Date&&e.endDate instanceof Date))throw new Error("Invalid dates in task");var o=e.startDate.getTime(),i=e.endDate.getTime(),l=t.getTime(),s=n.getTime()-l,c=(i-o)/s*100;return{leftPx:(o-l)/s*100/100*a*r,widthPx:Math.max(20,c/100*a*r)}}catch(t){return console.error("Error calculating task position:",t,e),{leftPx:0,widthPx:20}}},e.getLiveDatesFromElement=function(e,t,n,a,r){try{if(!e)return{startDate:new Date(t),endDate:new Date(n)};var o=parseFloat(e.style.left||"0"),i=parseFloat(e.style.width||"0"),l=this.calculateDatesFromPosition(o,i,t,n,a,r);return{startDate:l.newStartDate,endDate:l.newEndDate}}catch(e){return console.error("Error getting live dates:",e),{startDate:new Date(t),endDate:new Date(n)}}},e.formatDate=function(e){return e instanceof Date&&!isNaN(e.getTime())?e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Invalid date"},e.getDuration=function(e,t){try{var n=Math.abs(t.getTime()-e.getTime());return Math.ceil(n/864e5)}catch(e){return console.error("Error calculating duration:",e),0}},e}(),p=function(t){var n=t.task,a=t.leftPx,r=t.widthPx,o=t.topPx,i=t.isHovered,l=t.isDragging,s=t.editMode,c=t.showProgress,d=void 0!==c&&c,u=t.onMouseDown,m=t.onMouseEnter,f=t.onMouseLeave,h=t.onClick,v=(i||l)&&s;return n&&n.id?e.createElement("div",{className:"absolute h-8 rounded ".concat(n.color||"bg-blue-500"," flex items-center px-2 text-xs text-white font-medium ").concat(s?"cursor-move":"cursor-pointer"),style:{left:"".concat(Math.max(0,a),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(o,"px")},onClick:function(e){return h(e,n)},onMouseDown:function(e){return u(e,n,"move")},onMouseEnter:function(e){return m(e,n)},onMouseLeave:f,"data-testid":"task-".concat(n.id),"data-task-id":n.id},v&&e.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-l",onMouseDown:function(e){e.stopPropagation(),u(e,n,"resize-left")}}),e.createElement("div",{className:"truncate select-none"},n.name||"Unnamed Task"),d&&"number"==typeof n.percent&&e.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 rounded-full overflow-hidden"},e.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(n.percent,"%")}})),v&&e.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-r",onMouseDown:function(e){e.stopPropagation(),u(e,n,"resize-right")}})):(console.warn("TaskRenderer: Invalid task data",n),null)},w=function(t){var n=t.task,a=t.position,r=t.dragType,o=t.taskId,i=t.startDate,l=t.endDate,s=t.totalMonths,c=t.monthWidth,d=t.showProgress,u=void 0!==d&&d,m=n.startDate,f=n.endDate;try{var h=o||n.id,v=document.querySelector('[data-task-id="'.concat(h,'"]'));if(v&&(r||v.style.left||v.style.width)){var g=D.getLiveDatesFromElement(v,i,l,s,c);m=g.startDate,f=g.endDate}}catch(e){console.error("Error calculating live dates for tooltip:",e)}return e.createElement("div",{className:"absolute z-20 bg-white border border-gray-200 rounded-md shadow-md p-2 text-xs select-none",style:{left:"".concat(a.x,"px"),top:"".concat(a.y-40,"px"),minWidth:"150px"}},e.createElement("div",{className:"font-bold mb-1"},n.name||"Unnamed Task"),e.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},e.createElement("div",{className:"font-semibold"},"Start:"),e.createElement("div",null,D.formatDate(m)),e.createElement("div",{className:"font-semibold"},"End:"),e.createElement("div",null,D.formatDate(f)),e.createElement("div",{className:"font-semibold"},"Duration:"),e.createElement("div",null,D.getDuration(m,f)," days"),u&&"number"==typeof n.percent&&e.createElement(e.Fragment,null,e.createElement("div",{className:"font-semibold"},"Progress:"),e.createElement("div",null,n.percent,"%"))))},y=function(r){var o=r.person,i=r.startDate,l=r.endDate,s=r.totalMonths,c=r.monthWidth,d=r.editMode,u=void 0===d||d,m=r.showProgress,f=void 0!==m&&m,h=r.onTaskUpdate,v=r.onTaskClick;if(!o||!o.id||!Array.isArray(o.tasks))return console.warn("TaskRow: Invalid person data",o),e.createElement("div",{className:"relative h-16"},"Invalid person data");var y=i instanceof Date?i:new Date,E=l instanceof Date?l:new Date,x=t(null),b=x[0],k=x[1],M=t(null),T=M[0],N=M[1],P=t(null),L=P[0],F=P[1],A=t(0),S=A[0],C=A[1],I=t({x:0,y:0}),Y=I[0],U=I[1],O=t(null),R=O[0],z=O[1],H=n(null),_=n(null),W=n(null),X=function(e){z(e),W.current=e},j=R?g.getPreviewArrangement(R,o.tasks):g.detectOverlaps(o.tasks),B=Math.max(60,40*j.length+20),q=function(e,t){v&&!T&&v(t,o)},G=function(e,t){T||(k(t),K(e))},J=function(){T||k(null)},K=function(e){if(H.current){var t=H.current.getBoundingClientRect();U({x:e.clientX-t.left+20,y:e.clientY-t.top})}},Q=function(e){if(e instanceof MouseEvent&&"mousemove"===e.type){if(b){var t=e;if(H.current){var n=H.current.getBoundingClientRect();U({x:t.clientX-n.left+20,y:t.clientY-n.top})}}}else K(e);if(T&&L&&H.current)try{var a=e.clientX-S;if(0===a)return;var r=s*c,o=document.querySelector('[data-task-id="'.concat(T.id,'"]'));if(!o)return;var i=parseFloat(o.style.left||"0"),l=parseFloat(o.style.width||"0"),d=i,u=l;if("move"===L)d=Math.max(0,Math.min(r-l,i+a)),o.style.left="".concat(d,"px");else if("resize-left"===L){var m=l-20,f=Math.min(m,a);d=Math.max(0,i+f),u=Math.max(20,l-f),o.style.left="".concat(d,"px"),o.style.width="".concat(u,"px")}else"resize-right"===L&&(u=Math.max(20,Math.min(r-i,l+a)),o.style.width="".concat(u,"px"));var h=D.calculateDatesFromPosition(d,u,y,E,s,c),v=h.newStartDate,g=h.newEndDate,p=D.createUpdatedTask(T,v,g);z(p),X(p),C(e.clientX)}catch(e){console.error("Error in handleMouseMove:",e)}},V=function(e,t,n){u&&(e.preventDefault(),e.stopPropagation(),N(t),F(n),C(e.clientX),z(t),function(e){N(e),_.current=e}(t),X(t),document.addEventListener("mouseup",Z),document.addEventListener("mousemove",Q))},Z=function(){try{var e=_.current,t=W.current;e&&t&&h&&h(o.id,t)}catch(e){console.error("Error in handleMouseUp:",e)}finally{N(null),F(null),z(null),_.current=null,W.current=null,document.removeEventListener("mouseup",Z),document.removeEventListener("mousemove",Q)}};return a((function(){!T&&R&&h&&h(o.id,R)}),[T,R,o.id,h]),a((function(){return function(){document.removeEventListener("mouseup",Z),document.removeEventListener("mousemove",Q)}}),[]),o.tasks&&0!==o.tasks.length?e.createElement("div",{className:"relative border-b border-gray-200",style:{height:"".concat(B,"px")},onMouseMove:function(e){return Q(e)},onMouseLeave:function(){return k(null)},ref:H,"data-testid":"task-row-".concat(o.id)},j.map((function(t,n){return e.createElement(e.Fragment,{key:"task-row-".concat(n)},t.map((function(t){try{if(!(t&&t.id&&t.startDate instanceof Date&&t.endDate instanceof Date))return console.warn("Invalid task data:",t),null;var a=D.calculateTaskPixelPosition(t,y,E,s,c),r=a.leftPx,o=a.widthPx,i=(null==b?void 0:b.id)===t.id,l=(null==T?void 0:T.id)===t.id,d=40*n+10;return e.createElement(p,{key:"task-".concat(t.id),task:t,leftPx:r,widthPx:o,topPx:d,isHovered:i,isDragging:l,editMode:u,showProgress:f,onMouseDown:V,onMouseEnter:G,onMouseLeave:J,onClick:q})}catch(e){return console.error("Error rendering task:",e,t),null}})))})),(b||T)&&e.createElement(w,{task:R||T||b,position:Y,dragType:L,taskId:null==T?void 0:T.id,startDate:y,endDate:E,totalMonths:s,monthWidth:c,showProgress:f})):e.createElement("div",{className:"relative h-16"},"No tasks available")},E=function(t){var n=t.months,a=t.currentMonthIndex,r=t.theme,o=void 0===r?{}:r,i=(null==o?void 0:o.backgroundHighlight)||"bg-blue-50";return e.createElement("div",{className:"flex border-b border-gray-200"},n.map((function(t,n){return e.createElement("div",{key:n,className:"w-[150px] flex-shrink-0 p-2 font-semibold text-center ".concat(n===a?i:""),"data-month":t.toISOString()},(r=t)instanceof Date?r.toLocaleString("default",{month:"short",year:"2-digit"}):"");var r})))},x=function(t){var n=t.currentMonthIndex,a=t.height,r=t.markerClass,o=void 0===r?"bg-red-500":r,i=t.label,l=void 0===i?"Today":i;return n<0?null:e.createElement("div",{className:"absolute top-0 w-px ".concat(o," z-10"),style:{left:"".concat(150*(n+.5),"px"),height:"".concat(a,"px")},"data-testid":"today-marker"},e.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(o," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap"),style:{top:"-10px"}},l))},b=function(t){var n=t.people,a=t.headerLabel,r=void 0===a?"Resource":a;t.showAvatar,t.showTaskCount,t.theme;var o=Array.isArray(n)?n:[];return e.createElement("div",{className:"w-40 flex-shrink-0 z-10 bg-white shadow-sm"},e.createElement("div",{className:"p-2 font-semibold text-gray-700 border-r border-b border-gray-200 h-10.5"},r),o.map((function(t){if(!t)return null;var n=f(Array.isArray(t.tasks)?t.tasks:[]),a=Math.max(60,40*n.length+20);return e.createElement("div",{key:"person-".concat(t.id||"unknown"),className:"p-2 border-r border-b border-gray-200 font-medium",style:{height:"".concat(a,"px")},"data-testid":"person-label-".concat(t.id||"unknown")},e.createElement("div",{className:"font-medium"},t.name||"Unnamed"),t.role&&e.createElement("div",{className:"text-xs text-gray-500"},t.role))})))},k=function(t){var a,r=t.people,l=void 0===r?[]:r,s=t.startDate,d=t.endDate,u=t.title,m=void 0===u?"Project Timeline":u,g=t.currentDate,D=void 0===g?new Date:g,p=t.showCurrentDateMarker,w=void 0===p||p,k=t.todayLabel,M=void 0===k?"Today":k,T=t.editMode,N=void 0===T||T,P=t.theme,L=void 0===P?i:P,F=t.headerLabel,A=void 0===F?"Resource":F,S=t.showProgress,C=void 0!==S&&S,I=t.onTaskUpdate,Y=t.onTaskClick,U=n(null),O=n(null),R=Array.isArray(l)?l:[],z=s||h(R),H=d||v(R),_=c(z,H),W=_.length,X=D.getMonth(),j=D.getFullYear(),B=_.findIndex((function(e){return e.getMonth()===X&&e.getFullYear()===j})),q=function(e,t){if(I)try{var n=o(o({},t),{startDate:t.startDate instanceof Date?t.startDate:new Date(t.startDate),endDate:t.endDate instanceof Date?t.endDate:new Date(t.endDate)});I(e,n)}catch(e){console.error("Error in handleTaskUpdate:",e)}else console.warn("onTaskUpdate is not defined")},G=function(e,t){if(Y)try{Y(e,t)}catch(e){console.error("Error in handleTaskClick:",e)}};return e.createElement("div",{ref:U,className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart"},e.createElement("div",{className:"p-6 border-b border-gray-200"},e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},m)),e.createElement("div",{className:"relative flex"},e.createElement(b,{people:R,headerLabel:A,theme:L}),e.createElement("div",{ref:O,className:"flex-grow overflow-x-auto"},e.createElement("div",{className:"min-w-max"},e.createElement(E,{months:_,currentMonthIndex:B,theme:L}),e.createElement("div",{className:"relative"},w&&B>=0&&e.createElement(x,{currentMonthIndex:B,height:(a=0,R.forEach((function(e){if(e&&Array.isArray(e.tasks)){var t=f(e.tasks);a+=Math.max(60,40*t.length+20)}else a+=60})),a),markerClass:L.todayMarkerColor,label:M}),R.map((function(t){return t&&t.id?e.createElement(y,{key:"task-row-".concat(t.id),person:t,startDate:z,endDate:H,totalMonths:W,monthWidth:150,editMode:N,showProgress:C,onTaskUpdate:q,onTaskClick:G}):null})))))))};export{i as DEFAULT_THEME,r as DateDisplayFormat,k as GanttChart,y as TaskRow,m as calculateTaskPosition,f as detectTaskOverlaps,h as findEarliestDate,v as findLatestDate,s as formatDate,l as formatMonth,d as getDaysInMonth,c as getMonthsBetween,u as getStandardDayMarkers};
//# sourceMappingURL=index.esm.js.map
