import e,{useState as t,useRef as n,useEffect as a}from"react";var r,o=function(){return o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError,function(e){e.MONTH_YEAR="month-year",e.FULL_DATE="full-date",e.SHORT_DATE="short-date"}(r||(r={}));var i={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function l(e){return e.toLocaleString("default",{month:"short"})}function c(e,t){switch(void 0===t&&(t=r.FULL_DATE),t){case r.MONTH_YEAR:return e.toLocaleString("default",{month:"short",year:"2-digit"});case r.SHORT_DATE:return e.toLocaleString("default",{month:"short",day:"numeric"});case r.FULL_DATE:default:return e.toLocaleString("default",{month:"short",day:"numeric",year:"numeric"})}}function s(e,t){for(var n=[],a=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),i=t.getMonth(),l=a;l<=o;l++)for(var c=l===o?i:11,s=l===a?r:0;s<=c;s++)n.push(new Date(l,s,1));return n}function d(e,t){return new Date(e,t+1,0).getDate()}function u(){return[1,8,15,22,29]}function m(e,t,n){var a=s(new Date(t.getFullYear(),t.getMonth(),1),new Date(n.getFullYear(),n.getMonth()+1,0)),r=a.length,o=e.startDate.getFullYear(),i=e.startDate.getMonth(),l=a.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===i})),c=l<0?0:l,d=e.endDate.getFullYear(),u=e.endDate.getMonth(),m=a.findIndex((function(e){return e.getFullYear()===d&&e.getMonth()===u})),f=((m<0?a.length-1:m)-c+1)/r*100;return{left:"".concat(c/r*100,"%"),width:"".concat(f,"%")}}function f(e){var t=[];return e.forEach((function(e){for(var n=!1,a=0;a<t.length;a++){if(!t[a].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){t[a].push(e),n=!0;break}}n||t.push([e])})),t}function h(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function v(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}var g=function(){function e(){}return e.detectOverlaps=function(e){if(!Array.isArray(e)||0===e.length)return[];var t=[];return e.forEach((function(e){for(var n=!1,a=0;a<t.length;a++){if(!t[a].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){t[a].push(e),n=!0;break}}n||t.push([e])})),t},e.wouldCollide=function(e,t,n){return t.some((function(t){return t.id!==e.id&&t.id!==n&&!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))},e.getPreviewArrangement=function(e,t){var n=t.map((function(t){return t.id===e.id?e:t}));return this.detectOverlaps(n)},e}(),D=function(){function e(){}return e.calculateDatesFromPosition=function(e,t,n,a,r,o){try{var i=isNaN(e)?0:e,l=isNaN(t)||t<20?20:t,c=n.getTime(),s=(a.getTime()-c)/(r*o),d=i*s,u=l*s;return{newStartDate:new Date(c+d),newEndDate:new Date(c+d+u)}}catch(e){return console.error("Error calculating dates from position:",e),{newStartDate:new Date(n),newEndDate:new Date(a)}}},e.createUpdatedTask=function(e,t,n){return o(o({},e),{startDate:new Date(t),endDate:new Date(n)})},e.calculateTaskPixelPosition=function(e,t,n,a,r){try{if(!(e.startDate instanceof Date&&e.endDate instanceof Date))throw new Error("Invalid dates in task");var o=e.startDate.getTime(),i=e.endDate.getTime(),l=t.getTime(),c=n.getTime()-l,s=(i-o)/c*100;return{leftPx:(o-l)/c*100/100*a*r,widthPx:Math.max(20,s/100*a*r)}}catch(t){return console.error("Error calculating task position:",t,e),{leftPx:0,widthPx:20}}},e.getLiveDatesFromElement=function(e,t,n,a,r){try{if(!e)return{startDate:new Date(t),endDate:new Date(n)};var o=parseFloat(e.style.left||"0"),i=parseFloat(e.style.width||"0"),l=this.calculateDatesFromPosition(o,i,t,n,a,r);return{startDate:l.newStartDate,endDate:l.newEndDate}}catch(e){return console.error("Error getting live dates:",e),{startDate:new Date(t),endDate:new Date(n)}}},e.formatDate=function(e){return e instanceof Date&&!isNaN(e.getTime())?e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Invalid date"},e.getDuration=function(e,t){try{var n=Math.abs(t.getTime()-e.getTime());return Math.ceil(n/864e5)}catch(e){return console.error("Error calculating duration:",e),0}},e}(),p=function(t){var n=t.task,a=t.leftPx,r=t.widthPx,o=t.topPx,i=t.isHovered,l=t.isDragging,c=t.editMode,s=t.onMouseDown,d=t.onMouseEnter,u=t.onMouseLeave,m=t.onClick,f=(i||l)&&c;return n&&n.id?e.createElement("div",{className:"absolute h-8 rounded ".concat(n.color||"bg-blue-500"," flex items-center px-2 text-xs text-white font-medium ").concat(c?"cursor-move":"cursor-pointer"),style:{left:"".concat(Math.max(0,a),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(o,"px")},onClick:function(e){return m(e,n)},onMouseDown:function(e){return s(e,n,"move")},onMouseEnter:function(e){return d(e,n)},onMouseLeave:u,"data-testid":"task-".concat(n.id),"data-task-id":n.id},f&&e.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-l",onMouseDown:function(e){e.stopPropagation(),s(e,n,"resize-left")}}),e.createElement("div",{className:"truncate select-none"},n.name||"Unnamed Task"),"number"==typeof n.percent&&e.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 rounded-full overflow-hidden"},e.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(n.percent,"%")}})),f&&e.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-r",onMouseDown:function(e){e.stopPropagation(),s(e,n,"resize-right")}})):(console.warn("TaskRenderer: Invalid task data",n),null)},w=function(t){var n=t.task,a=t.position,r=t.dragType,o=t.taskId,i=t.startDate,l=t.endDate,c=t.totalMonths,s=t.monthWidth,d=n.startDate,u=n.endDate;try{var m=o||n.id,f=document.querySelector('[data-task-id="'.concat(m,'"]'));if(f&&(r||f.style.left||f.style.width)){var h=D.getLiveDatesFromElement(f,i,l,c,s);d=h.startDate,u=h.endDate}}catch(e){console.error("Error calculating live dates for tooltip:",e)}return e.createElement("div",{className:"absolute z-20 bg-white border border-gray-200 rounded-md shadow-md p-2 text-xs select-none",style:{left:"".concat(a.x,"px"),top:"".concat(a.y-40,"px"),minWidth:"150px"}},e.createElement("div",{className:"font-bold mb-1"},n.name||"Unnamed Task"),e.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},e.createElement("div",{className:"font-semibold"},"Start:"),e.createElement("div",null,D.formatDate(d)),e.createElement("div",{className:"font-semibold"},"End:"),e.createElement("div",null,D.formatDate(u)),e.createElement("div",{className:"font-semibold"},"Duration:"),e.createElement("div",null,D.getDuration(d,u)," days"),"number"==typeof n.percent&&e.createElement(e.Fragment,null,e.createElement("div",{className:"font-semibold"},"Progress:"),e.createElement("div",null,n.percent,"%"))))},y=function(r){var o=r.person,i=r.startDate,l=r.endDate,c=r.totalMonths,s=r.monthWidth,d=r.editMode,u=void 0===d||d,m=r.onTaskUpdate,f=r.onTaskClick;if(!o||!o.id||!Array.isArray(o.tasks))return console.warn("TaskRow: Invalid person data",o),e.createElement("div",{className:"relative h-16"},"Invalid person data");var h=i instanceof Date?i:new Date,v=l instanceof Date?l:new Date,y=t(null),E=y[0],x=y[1],k=t(null),b=k[0],M=k[1],T=t(null),N=T[0],P=T[1],F=t(0),L=F[0],S=F[1],A=t({x:0,y:0}),Y=A[0],C=A[1],U=t(null),I=U[0],O=U[1],z=n(null),H=n(null),R=n(null),_=function(e){O(e),R.current=e},W=I?g.getPreviewArrangement(I,o.tasks):g.detectOverlaps(o.tasks),X=Math.max(60,40*W.length+20),B=function(e,t){f&&!b&&f(t,o)},j=function(e,t){b||(x(t),G(e))},q=function(){b||x(null)},G=function(e){if(z.current){var t=z.current.getBoundingClientRect();C({x:e.clientX-t.left+20,y:e.clientY-t.top})}},J=function(e){if(e instanceof MouseEvent&&"mousemove"===e.type){if(E){var t=e;if(z.current){var n=z.current.getBoundingClientRect();C({x:t.clientX-n.left+20,y:t.clientY-n.top})}}}else G(e);if(b&&N&&z.current)try{var a=e.clientX-L;if(0===a)return;var r=c*s,o=document.querySelector('[data-task-id="'.concat(b.id,'"]'));if(!o)return;var i=parseFloat(o.style.left||"0"),l=parseFloat(o.style.width||"0"),d=i,u=l;if("move"===N)d=Math.max(0,Math.min(r-l,i+a)),o.style.left="".concat(d,"px");else if("resize-left"===N){var m=l-20,f=Math.min(m,a);d=Math.max(0,i+f),u=Math.max(20,l-f),o.style.left="".concat(d,"px"),o.style.width="".concat(u,"px")}else"resize-right"===N&&(u=Math.max(20,Math.min(r-i,l+a)),o.style.width="".concat(u,"px"));var g=D.calculateDatesFromPosition(d,u,h,v,c,s),p=g.newStartDate,w=g.newEndDate,y=D.createUpdatedTask(b,p,w);O(y),_(y),S(e.clientX)}catch(e){console.error("Error in handleMouseMove:",e)}},K=function(e,t,n){u&&(e.preventDefault(),e.stopPropagation(),M(t),P(n),S(e.clientX),O(t),function(e){M(e),H.current=e}(t),_(t),document.addEventListener("mouseup",Q),document.addEventListener("mousemove",J))},Q=function(){try{var e=H.current,t=R.current;e&&t&&m&&m(o.id,t)}catch(e){console.error("Error in handleMouseUp:",e)}finally{M(null),P(null),O(null),H.current=null,R.current=null,document.removeEventListener("mouseup",Q),document.removeEventListener("mousemove",J)}};return a((function(){!b&&I&&m&&m(o.id,I)}),[b,I,o.id,m]),a((function(){return function(){document.removeEventListener("mouseup",Q),document.removeEventListener("mousemove",J)}}),[]),o.tasks&&0!==o.tasks.length?e.createElement("div",{className:"relative border-b border-gray-200",style:{height:"".concat(X,"px")},onMouseMove:function(e){return J(e)},onMouseLeave:function(){return x(null)},ref:z,"data-testid":"task-row-".concat(o.id)},W.map((function(t,n){return e.createElement(e.Fragment,{key:"task-row-".concat(n)},t.map((function(t){try{if(!(t&&t.id&&t.startDate instanceof Date&&t.endDate instanceof Date))return console.warn("Invalid task data:",t),null;var a=D.calculateTaskPixelPosition(t,h,v,c,s),r=a.leftPx,o=a.widthPx,i=(null==E?void 0:E.id)===t.id,l=(null==b?void 0:b.id)===t.id,d=40*n+10;return e.createElement(p,{key:"task-".concat(t.id),task:t,leftPx:r,widthPx:o,topPx:d,isHovered:i,isDragging:l,editMode:u,onMouseDown:K,onMouseEnter:j,onMouseLeave:q,onClick:B})}catch(e){return console.error("Error rendering task:",e,t),null}})))})),(E||b)&&e.createElement(w,{task:I||b||E,position:Y,dragType:N,taskId:null==b?void 0:b.id,startDate:h,endDate:v,totalMonths:c,monthWidth:s})):e.createElement("div",{className:"relative h-16"},"No tasks available")},E=function(t){var a=t.people,r=void 0===a?[]:a,l=t.startDate,c=t.endDate,d=t.title,u=void 0===d?"Project Timeline":d,m=t.currentDate,g=void 0===m?new Date:m,D=t.showCurrentDateMarker,p=void 0===D||D,w=t.editMode,E=void 0===w||w,x=t.theme,k=void 0===x?i:x,b=t.onTaskUpdate,M=t.onTaskClick,T=n(null),N=n(null),P=Array.isArray(r)?r:[],F=l||h(P),L=c||v(P),S=s(F,L),A=S.length,Y=g.getMonth(),C=g.getFullYear(),U=S.findIndex((function(e){return e.getMonth()===Y&&e.getFullYear()===C}));null==k||k.headerBackground,null==k||k.headerText,null==k||k.borderColor;var I,O=(null==k?void 0:k.backgroundHighlight)||"bg-blue-50",z=(null==k?void 0:k.todayMarkerColor)||"bg-red-500",H=function(e,t){if(b)try{var n=o(o({},t),{startDate:t.startDate instanceof Date?t.startDate:new Date(t.startDate),endDate:t.endDate instanceof Date?t.endDate:new Date(t.endDate)});b(e,n)}catch(e){console.error("Error in handleTaskUpdate:",e)}else console.warn("onTaskUpdate is not defined")},R=function(e,t){if(M)try{M(e,t)}catch(e){console.error("Error in handleTaskClick:",e)}};return e.createElement("div",{ref:T,className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart"},e.createElement("div",{className:"p-6 border-b border-gray-200"},e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},u)),e.createElement("div",{className:"relative flex"},e.createElement("div",{className:"w-40 flex-shrink-0 z-10 bg-white shadow-sm"},e.createElement("div",{className:"p-2 font-semibold text-gray-700 border-r border-b border-gray-200 h-10.5"},"Team Member"),P.map((function(t){if(!t)return null;var n=f(Array.isArray(t.tasks)?t.tasks:[]),a=Math.max(60,40*n.length+20);return e.createElement("div",{key:"person-".concat(t.id||"unknown"),className:"p-2 border-r border-b border-gray-200 font-medium",style:{height:"".concat(a,"px")},"data-testid":"person-label-".concat(t.id||"unknown")},e.createElement("div",{className:"font-medium"},t.name||"Unnamed"),t.role&&e.createElement("div",{className:"text-xs text-gray-500"},t.role))}))),e.createElement("div",{ref:N,className:"flex-grow overflow-x-auto"},e.createElement("div",{className:"min-w-max"},e.createElement("div",{className:"flex border-b border-gray-200"},S.map((function(t,n){return e.createElement("div",{key:n,className:"w-[150px] flex-shrink-0 p-2 font-semibold text-center ".concat(n===U?O:""),"data-month":t.toISOString()},(a=t)instanceof Date?a.toLocaleString("default",{month:"short",year:"2-digit"}):"");var a}))),e.createElement("div",{className:"relative"},p&&U>=0&&e.createElement("div",{className:"absolute top-0 w-px ".concat(z," z-10"),style:{left:"".concat(150*(U+.5),"px"),height:"".concat((I=0,P.forEach((function(e){if(e&&Array.isArray(e.tasks)){var t=f(e.tasks);I+=Math.max(60,40*t.length+20)}else I+=60})),I),"px")},"data-testid":"today-marker"},e.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(z," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},"Today")),P.map((function(t){return t&&t.id?e.createElement(y,{key:"task-row-".concat(t.id),person:t,startDate:F,endDate:L,totalMonths:A,monthWidth:150,editMode:E,onTaskUpdate:H,onTaskClick:R}):null})))))))};export{i as DEFAULT_THEME,r as DateDisplayFormat,E as GanttChart,y as TaskRow,m as calculateTaskPosition,f as detectTaskOverlaps,h as findEarliestDate,v as findLatestDate,c as formatDate,l as formatMonth,d as getDaysInMonth,s as getMonthsBetween,u as getStandardDayMarkers};
//# sourceMappingURL=index.esm.js.map
