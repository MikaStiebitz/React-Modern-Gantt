import e,{useState as t,useRef as a,useEffect as n}from"react";import{startOfDay as r,endOfDay as o,differenceInDays as i,differenceInYears as s,differenceInQuarters as c,differenceInMonths as l,differenceInWeeks as u,isWithinInterval as d,format as f,isValid as m,getWeek as h,addDays as v,startOfQuarter as g,addQuarters as D,startOfYear as w,addYears as M}from"date-fns";var p,E,y=function(){return y=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},y.apply(this,arguments)};function k(e,t,a){if(a||2===arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}function b(e,t){return void 0===t&&(t="default"),e.toLocaleString(t,{month:"short"})}function x(e,t,a){if(void 0===t&&(t=E.FULL_DATE),void 0===a&&(a="default"),!(e instanceof Date)||isNaN(e.getTime()))return"Invalid date";switch(t){case E.MONTH_YEAR:return e.toLocaleString(a,{month:"short",year:"2-digit"});case E.SHORT_DATE:return e.toLocaleString(a,{month:"short",day:"numeric"});case E.FULL_DATE:default:return e.toLocaleString(a,{month:"short",day:"numeric",year:"numeric"})}}function T(e,t){var a=[];if(!(e instanceof Date&&t instanceof Date))return console.warn("getMonthsBetween: Invalid date parameters"),[new Date];for(var n=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),i=t.getMonth(),s=n;s<=o;s++)for(var c=s===o?i:11,l=s===n?r:0;l<=c;l++)a.push(new Date(s,l,1));return a}function N(e,t){return new Date(e,t+1,0).getDate()}function A(){return[1,8,15,22,29]}function Y(e,t,a){if(!(e.startDate instanceof Date&&e.endDate instanceof Date))return console.warn("calculateTaskPosition: Invalid task dates",e),{left:"0%",width:"10%"};var n=T(new Date(t.getFullYear(),t.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)),r=n.length,o=e.startDate.getFullYear(),i=e.startDate.getMonth(),s=n.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===i})),c=s<0?0:s,l=e.endDate.getFullYear(),u=e.endDate.getMonth(),d=n.findIndex((function(e){return e.getFullYear()===l&&e.getMonth()===u})),f=((d<0?n.length-1:d)-c+1)/r*100;return{left:"".concat(c/r*100,"%"),width:"".concat(f,"%")}}function R(e){if(!Array.isArray(e))return console.warn("detectTaskOverlaps: Invalid tasks array"),[];var t=e.filter((function(e){return e&&e.startDate instanceof Date&&e.endDate instanceof Date}));if(0===t.length)return[];var a=[];return t.forEach((function(e){for(var t=!1,n=0;n<a.length;n++){if(!a[n].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){a[n].push(e),t=!0;break}}t||a.push([e])})),a}function H(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.startDate instanceof Date&&(a?e.startDate<t&&(t=new Date(e.startDate)):(t=new Date(e.startDate),a=!0))}))})),!a){var n=new Date;return new Date(n.getFullYear(),n.getMonth()-1,1)}return new Date(t.getFullYear(),t.getMonth(),1)}function F(e){if(!Array.isArray(e)||0===e.length)return new Date;var t=new Date,a=!1;if(e.forEach((function(e){e&&Array.isArray(e.tasks)&&e.tasks.forEach((function(e){e&&e.endDate instanceof Date&&(a?e.endDate>t&&(t=new Date(e.endDate)):(t=new Date(e.endDate),a=!0))}))})),!a){var n=new Date;return new Date(n.getFullYear(),n.getMonth()+2,0)}return new Date(t.getFullYear(),t.getMonth()+1,0)}function O(e,t,a){if(void 0===a&&(a="default"),!(e instanceof Date&&t instanceof Date))return"Invalid date range";var n=x(e,E.SHORT_DATE,a),r=x(t,E.SHORT_DATE,a);return"".concat(n," - ").concat(r)}function C(e,t){var a;if(!(e instanceof Date&&t instanceof Date))return 0;e>t&&(e=(a=[t,e])[0],t=a[1]);var n=Math.abs(t.getTime()-e.getTime());return Math.ceil(n/864e5)}"function"==typeof SuppressedError&&SuppressedError,function(e){e.DAY="day",e.WEEK="week",e.MONTH="month",e.QUARTER="quarter",e.YEAR="year"}(p||(p={})),function(e){e.MONTH_YEAR="month-year",e.FULL_DATE="full-date",e.SHORT_DATE="short-date"}(E||(E={}));var L=function(){function e(){}return e.detectOverlaps=function(e,t){var a=this;if(void 0===t&&(t=p.MONTH),!Array.isArray(e)||0===e.length)return[];var n=k([],e,!0).sort((function(e,t){return e.startDate&&t.startDate?e.startDate.getTime()-t.startDate.getTime():0})),r=[];return n.forEach((function(e){for(var n=!1,o=0;o<r.length;o++){if(!r[o].some((function(n){return a.tasksVisuallyOverlap(e,n,t)}))){r[o].push(e),n=!0;break}}n||r.push([e])})),r},e.tasksVisuallyOverlap=function(e,t,a){if(void 0===a&&(a=p.MONTH),!(e.startDate&&e.endDate&&t.startDate&&t.endDate))return!1;var n=e.startDate.getTime(),r=e.endDate.getTime(),o=t.startDate.getTime(),i=t.endDate.getTime(),s=this.getCollisionBufferByViewMode(a);return n+s<i-s&&r-s>o+s||Math.abs(n-o)<2*s||Math.abs(r-i)<2*s},e.getCollisionBufferByViewMode=function(e){var t=36e5,a=24*t;switch(e){case p.DAY:return t;case p.WEEK:return 4*t;case p.MONTH:return 12*t;case p.QUARTER:return a;case p.YEAR:return 2*a;default:return 12*t}},e.wouldCollide=function(e,t,a,n){var r=this;return void 0===a&&(a=p.MONTH),t.some((function(t){return t.id!==e.id&&t.id!==n&&r.tasksVisuallyOverlap(e,t,a)}))},e.getPreviewArrangement=function(e,t,a){void 0===a&&(a=p.MONTH);var n=t.map((function(t){return t.id===e.id?e:t}));return this.detectOverlaps(n,a)},e}(),P=function(){function e(){}return e.calculateDatesFromPosition=function(e,t,a,n,i,s,c){void 0===c&&(c=p.MONTH);try{var l=isNaN(e)?0:e,u=isNaN(t)||t<20?20:t,d=a.getTime(),f=(n.getTime()-d)/(i*s),m=l*f,h=u*f,v=new Date(d+m),g=new Date(d+m+h);if(c===p.DAY){var D=Math.round(e/s),w=Math.max(1,Math.round(t/s)),M=new Date(a);M.setHours(0,0,0,0),(v=new Date(M)).setDate(M.getDate()+D),v.setHours(0,0,0,0),(g=new Date(v)).setDate(v.getDate()+w-1),g.setHours(23,59,59,999)}else v=r(v),g=o(g);return v<a&&(v=new Date(a)),g>n&&(g=new Date(n)),{newStartDate:v,newEndDate:g}}catch(e){return console.error("Error calculating dates from position:",e),{newStartDate:new Date(a),newEndDate:new Date(n)}}},e.createUpdatedTask=function(e,t,a){return y(y({},e),{startDate:new Date(t),endDate:new Date(a)})},e.calculateTaskPixelPosition=function(e,t,a,n,r,o){var i;void 0===o&&(o=p.MONTH);try{if(!(e.startDate instanceof Date&&e.endDate instanceof Date))throw new Error("Invalid dates in task");var s=t.getTime(),c=a.getTime(),l=Math.max(e.startDate.getTime(),t.getTime()),u=Math.min(e.endDate.getTime(),a.getTime());if(o===p.DAY){var d=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0).getTime(),f=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999).getTime();s=d,c=f;var m=new Date(new Date(l).getFullYear(),new Date(l).getMonth(),new Date(l).getDate(),0,0,0,0).getTime(),h=new Date(new Date(u).getFullYear(),new Date(u).getMonth(),new Date(u).getDate(),23,59,59,999).getTime();l=m,u=h}var v=c-s,g=n*r,D=(l-s)/v*g,w=(u-l)/v*g;o===p.DAY&&(D=Math.round(D/r)*r,w=Math.max(r,Math.round(w/r)*r));var M=((i={})[p.DAY]=20,i[p.WEEK]=20,i[p.MONTH]=20,i[p.QUARTER]=30,i[p.YEAR]=40,i)[o]||20;w=Math.max(M,w);var E=g-D;return{leftPx:D,widthPx:w=Math.min(E,w)}}catch(t){return console.error("Error calculating task position:",t,e),{leftPx:0,widthPx:20}}},e.getLiveDatesFromElement=function(e,t,a,n,r,o){void 0===o&&(o=p.MONTH);try{if(!e)return{startDate:new Date(t),endDate:new Date(a)};var i=parseFloat(e.style.left||"0"),s=parseFloat(e.style.width||"0"),c=this.calculateDatesFromPosition(i,s,t,a,n,r,o);return{startDate:c.newStartDate,endDate:c.newEndDate}}catch(e){return console.error("Error getting live dates:",e),{startDate:new Date(t),endDate:new Date(a)}}},e.formatDate=function(e,t,a){if(void 0===t&&(t="default"),void 0===a&&(a=p.MONTH),!(e instanceof Date)||isNaN(e.getTime()))return"Invalid date";var n;switch(a){case p.DAY:case p.WEEK:case p.MONTH:n={year:"numeric",month:"short",day:"numeric"};break;case p.QUARTER:n={year:"numeric",month:"short"};break;case p.YEAR:n={year:"numeric"};break;default:n={year:"numeric",month:"short",day:"numeric"}}return e.toLocaleDateString(t,n)},e.getDuration=function(e,t,a){void 0===a&&(a=p.MONTH);try{if(!(e instanceof Date)||!(t instanceof Date)||isNaN(e.getTime())||isNaN(t.getTime()))return{value:0,unit:"days"};var n=e<t?e:t,r=e<t?t:e;switch(a){case p.DAY:var o=i(r,n)+1;return{value:o,unit:1===o?"day":"days"};case p.WEEK:var d=u(r,n)+1;return{value:d,unit:1===d?"week":"weeks"};case p.MONTH:var f=l(r,n)+1;return{value:f,unit:1===f?"month":"months"};case p.QUARTER:var m=c(r,n)+1;return{value:m,unit:1===m?"quarter":"quarters"};case p.YEAR:var h=s(r,n)+1;return{value:h,unit:1===h?"year":"years"};default:var v=i(r,n)+1;return{value:v,unit:1===v?"day":"days"}}}catch(e){return console.error("Error calculating duration:",e),{value:0,unit:"days"}}},e.datesOverlap=function(e,t,a,n){return d(e,{start:a,end:n})||d(t,{start:a,end:n})||d(a,{start:e,end:t})||d(n,{start:e,end:t})},e}(),S=function(t){var a=t.task,n=t.leftPx,r=t.widthPx,o=t.topPx,i=t.isHovered,s=t.isDragging,c=t.editMode,l=t.showProgress,u=void 0!==l&&l,d=t.instanceId,f=t.renderTask,m=t.getTaskColor,h=t.onMouseDown,v=t.onMouseEnter,g=t.onMouseLeave,D=t.onClick,w=(i||s)&&c;if(!a||!a.id)return console.warn("TaskItem: Invalid task data",a),null;var M=a.color||"bg-gantt-task",p="",E="text-gantt-task-text";if(m){var k=m({task:a,isHovered:i,isDragging:s});M=k.backgroundColor,p=k.borderColor||"",E=k.textColor||E}if(f){var b=f({task:a,leftPx:n,widthPx:r,topPx:o,isHovered:i,isDragging:s,editMode:c,showProgress:u});return e.createElement("div",{className:"absolute",style:{left:"".concat(Math.max(0,n),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(o,"px")},onClick:function(e){return D(e,a)},onMouseDown:function(e){return h(e,a,"move")},onMouseEnter:function(e){return v(e,a)},onMouseLeave:g,"data-testid":"task-".concat(a.id),"data-task-id":a.id,"data-instance-id":d},b)}var x=M.startsWith("bg-")?{}:{backgroundColor:M},T=M.startsWith("bg-")?M:"",N=p?p.startsWith("border-")?{}:{borderColor:p,borderWidth:"1px"}:{},A=p&&p.startsWith("border-")?p:"";return e.createElement("div",{className:"absolute h-8 rounded ".concat(T," ").concat(A," ").concat(E," flex items-center px-2 text-xs font-medium ").concat(c?"cursor-move":"cursor-pointer"),style:y(y({left:"".concat(Math.max(0,n),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(o,"px")},x),N),onClick:function(e){return D(e,a)},onMouseDown:function(e){return h(e,a,"move")},onMouseEnter:function(e){return v(e,a)},onMouseLeave:g,"data-testid":"task-".concat(a.id),"data-task-id":a.id,"data-instance-id":d},w&&e.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-l",onMouseDown:function(e){e.stopPropagation(),h(e,a,"resize-left")}}),e.createElement("div",{className:"truncate select-none"},a.name||"Unnamed Task"),u&&"number"==typeof a.percent&&e.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 dark:bg-opacity-30 rounded-full overflow-hidden"},e.createElement("div",{className:"h-full bg-white dark:bg-gray-200 rounded-full",style:{width:"".concat(a.percent,"%")}})),w&&e.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 dark:bg-opacity-40 cursor-ew-resize rounded-r",onMouseDown:function(e){e.stopPropagation(),h(e,a,"resize-right")}}))},I=function(t){var a=t.task,n=t.position,r=t.dragType,o=t.taskId,i=t.startDate,s=t.endDate,c=t.totalMonths,l=t.monthWidth,u=t.showProgress,d=void 0!==u&&u,m=t.instanceId,h=t.className,v=void 0===h?"":h,g=t.viewMode,D=void 0===g?p.MONTH:g,w=t.renderTooltip,M=a.startDate,E=a.endDate;try{var y=o||a.id,k=document.querySelector('[data-task-id="'.concat(y,'"][data-instance-id="').concat(m,'"]'));if(k&&(r||k.style.left||k.style.width)){var b=P.getLiveDatesFromElement(k,i,s,c,l,D);M=b.startDate,E=b.endDate}}catch(e){console.error("Error calculating live dates for tooltip:",e)}var x=P.getDuration(M,E,D),T=function(e){return e instanceof Date&&!isNaN(e.getTime())?D===p.DAY?f(e,"EEE, MMM d, yyyy"):f(e,"MMM d, yyyy"):"Invalid date"},N=function(){if(!r)return null;switch(r){case"move":return"Moving task...";case"resize-left":return"Adjusting start date...";case"resize-right":return"Adjusting end date...";default:return null}}();return w?e.createElement("div",{className:"rmg-task-tooltip absolute z-20 ".concat(v),style:{left:"".concat(n.x,"px"),top:"".concat(n.y-40,"px")}},w({task:a,position:n,dragType:r,startDate:M,endDate:E,viewMode:D})):e.createElement("div",{className:"rmg-task-tooltip absolute z-20 bg-[var(--rmg-tooltip-bg,#ffffff)] text-[var(--rmg-tooltip-text,#1f2937)] border border-[var(--rmg-tooltip-border,#e5e7eb)] rounded-md shadow-md p-2 text-xs select-none ".concat(v),style:{left:"".concat(n.x,"px"),top:"".concat(n.y-40,"px"),minWidth:"200px"}},e.createElement("div",{className:"font-bold mb-1"},a.name||"Unnamed Task"),N&&e.createElement("div",{className:"text-xs text-blue-500 dark:text-blue-400 mb-1 italic"},N),e.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},e.createElement("div",{className:"font-semibold"},"Start:"),e.createElement("div",null,T(M)),e.createElement("div",{className:"font-semibold"},"End:"),e.createElement("div",null,T(E)),e.createElement("div",{className:"font-semibold"},"Duration:"),e.createElement("div",null,x.value," ",x.unit),d&&"number"==typeof a.percent&&e.createElement(e.Fragment,null,e.createElement("div",{className:"font-semibold"},"Progress:"),e.createElement("div",null,a.percent,"%")),a.dependencies&&a.dependencies.length>0&&e.createElement(e.Fragment,null,e.createElement("div",{className:"font-semibold"},"Dependencies:"),e.createElement("div",null,a.dependencies.join(", ")))))},W=function(r){var o=r.taskGroup,i=r.startDate,s=r.endDate,c=r.totalMonths,l=r.monthWidth,u=r.editMode,d=void 0===u||u,f=r.showProgress,m=void 0!==f&&f,h=r.className,v=void 0===h?"":h,g=r.tooltipClassName,D=void 0===g?"":g,w=r.onTaskUpdate,M=r.onTaskClick,E=r.onTaskSelect,k=r.viewMode,b=void 0===k?p.MONTH:k,x=r.scrollContainerRef,T=r.smoothDragging,N=void 0===T||T,A=r.movementThreshold,Y=void 0===A?3:A;if(!o||!o.id||!Array.isArray(o.tasks))return console.warn("TaskRow: Invalid task group data",o),e.createElement("div",{className:"relative h-16 text-gantt-text"},"Invalid task group data");var R=i instanceof Date?i:new Date,H=s instanceof Date?s:new Date,F=t(null),O=F[0],C=F[1],W=t(null),U=W[0],z=W[1],K=t(null),Q=K[0],_=K[1],q=t(0),B=q[0],V=q[1],j=t({x:0,y:0}),G=j[0],X=j[1],J=t(null),Z=J[0],$=J[1],ee=t(null),te=ee[0],ae=ee[1],ne=a({left:0,width:0}),re=a(0),oe=a(0),ie=a(!1),se=a(null),ce=a(0),le=a(null),ue=a(null),de=a(null),fe=a(null),me=a("task-row-".concat(Math.random().toString(36).substring(2,11))),he=function(e){$(e),fe.current=e},ve=Z?L.getPreviewArrangement(Z,o.tasks,b):L.detectOverlaps(o.tasks,b),ge=Math.max(60,40*ve.length+20),De=function(){if(!ie.current){ie.current=!0;var e=function(){if(ie.current&&(null==x?void 0:x.current)){var t=x.current,a=le.current,n=ce.current;"left"===a?t.scrollLeft-=n:"right"===a&&(t.scrollLeft+=n),ie.current&&(se.current=requestAnimationFrame(e))}};se.current=requestAnimationFrame(e)}},we=function(){ie.current=!1,null!==se.current&&(cancelAnimationFrame(se.current),se.current=null)},Me=function(e,t){M&&!U&&M(t,o),E&&E(t,!0)},pe=function(e,t){U||(C(t),ye(e))},Ee=function(){U||C(null)},ye=function(e){if(ue.current){var t=ue.current.getBoundingClientRect();X({x:e.clientX-t.left+20,y:e.clientY-t.top})}},ke=function(e,t,a){if(d){e.preventDefault(),e.stopPropagation();var n=document.querySelector('[data-task-id="'.concat(t.id,'"][data-instance-id="').concat(me.current,'"]'));if(n){var r=parseFloat(n.style.left||"0"),o=parseFloat(n.style.width||"0");ae({left:r,width:o,startDate:new Date(t.startDate),endDate:new Date(t.endDate)}),ne.current={left:r,width:o},re.current=Date.now(),oe.current=0,z(t),_(a),V(e.clientX),$(t),function(e){z(e),de.current=e}(t),he(t),document.addEventListener("mouseup",Ne),document.addEventListener("mousemove",be)}}},be=function(e){if(e instanceof MouseEvent&&O&&ue.current){var t=e,a=ue.current.getBoundingClientRect();X({x:t.clientX-a.left+20,y:t.clientY-a.top})}else e instanceof MouseEvent||ye(e);if(U&&(null==x?void 0:x.current)&&function(e){if((null==x?void 0:x.current)&&U){var t=x.current.getBoundingClientRect(),a=null,n=0;e<t.left+40?(a="left",n=Math.max(1,Math.round((40-(e-t.left))/10))):e>t.right-40&&(a="right",n=Math.max(1,Math.round((e-(t.right-40))/10))),le.current=a,ce.current=n,a&&!ie.current?De():!a&&ie.current&&we()}}(e.clientX),U&&Q&&te&&ue.current)try{var n=document.querySelector('[data-task-id="'.concat(U.id,'"][data-instance-id="').concat(me.current,'"]'));if(!n)return;var r=e.clientX-B;if(N&&(oe.current+=r-(te.left+oe.current-te.left),Math.abs(oe.current)<Y))return;var o=c*l,i=te.left,s=te.width,u=!1;switch(Q){case"move":if(i=Math.max(0,Math.min(o-te.width,te.left+r)),b===p.DAY){var d=Math.round(i/l)*l;Math.abs(d-ne.current.left)>=Y?(i=d,u=!0):i=ne.current.left}else Math.abs(i-ne.current.left)>=Y?u=!0:i=ne.current.left;u&&(n.style.left="".concat(i,"px"),ne.current.left=i);break;case"resize-left":var f=te.width-20,m=Math.min(f,r);if(i=Math.max(0,te.left+m),b===p.DAY){d=Math.round(i/l)*l;Math.abs(d-ne.current.left)>=Y?(i=d,u=!0):i=ne.current.left}else Math.abs(i-ne.current.left)>=Y?u=!0:i=ne.current.left;var h=te.left+te.width;s=Math.max(20,h-i),u&&(n.style.left="".concat(i,"px"),n.style.width="".concat(s,"px"),ne.current={left:i,width:s});break;case"resize-right":if(s=Math.max(20,Math.min(o-te.left,te.width+r)),b===p.DAY){var v=te.left+s,g=Math.round(v/l)*l,D=Math.max(20,g-te.left);Math.abs(D-ne.current.width)>=Y?(s=D,u=!0):s=ne.current.width}else Math.abs(s-ne.current.width)>=Y?u=!0:s=ne.current.width;u&&(n.style.width="".concat(s,"px"),ne.current.width=s)}if(u){if(b===p.DAY){var w=Math.round(i/l),M=Math.max(1,Math.round(s/l)),E=new Date(R);E.setHours(0,0,0,0),(L=new Date(E)).setDate(E.getDate()+w),L.setHours(0,0,0,0),(P=new Date(L)).setDate(L.getDate()+M-1),P.setHours(23,59,59,999);var k=y(y({},U),{startDate:L,endDate:P});$(k),he(k)}else{var T=xe(R,H,b)/o,A=R.getTime()+i*T,F=R.getTime()+(i+s)*T,C=Te(new Date(A),new Date(F),b),L=C.newStartDate,P=C.newEndDate;k=y(y({},U),{startDate:L,endDate:P});$(k),he(k)}oe.current=0,re.current=Date.now()}}catch(e){console.error("Error in handleMouseMove:",e)}},xe=function(e,t,a){var n=new Date(e).setHours(0,0,0,0),r=new Date(t).setHours(23,59,59,999)-n;return p.DAY,r},Te=function(e,t,a){var n=new Date(e),r=new Date(t);switch(a){case p.DAY:n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),r=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);case p.WEEK:case p.MONTH:case p.QUARTER:case p.YEAR:}return{newStartDate:n,newEndDate:r}},Ne=function(){try{var e=de.current,t=fe.current;e&&t&&w&&w(o.id,t)}catch(e){console.error("Error in handleMouseUp:",e)}finally{we(),z(null),_(null),$(null),ae(null),de.current=null,fe.current=null,oe.current=0,document.removeEventListener("mouseup",Ne),document.removeEventListener("mousemove",be)}};return n((function(){return function(){document.removeEventListener("mouseup",Ne),document.removeEventListener("mousemove",be),we()}}),[]),o.tasks&&0!==o.tasks.length?e.createElement("div",{className:"relative border-b border-gantt-border ".concat(v),style:{height:"".concat(ge,"px")},onMouseMove:function(e){return be(e)},onMouseLeave:function(){return C(null)},ref:ue,"data-testid":"task-row-".concat(o.id),"data-instance-id":me.current},ve.map((function(t,a){return e.createElement(e.Fragment,{key:"task-row-".concat(a)},t.map((function(t){try{if(!(t&&t.id&&t.startDate instanceof Date&&t.endDate instanceof Date))return console.warn("Invalid task data:",t),null;var n=P.calculateTaskPixelPosition(t,R,H,c,l,b),r=n.leftPx,o=n.widthPx,i=(null==O?void 0:O.id)===t.id,s=(null==U?void 0:U.id)===t.id,u=40*a+10;return e.createElement(S,{key:"task-".concat(t.id),task:t,leftPx:r,widthPx:o,topPx:u,isHovered:i,isDragging:s,editMode:d,showProgress:m,instanceId:me.current,onMouseDown:ke,onMouseEnter:pe,onMouseLeave:Ee,onClick:Me})}catch(e){return console.error("Error rendering task:",e,t),null}})))})),(O||U)&&e.createElement(I,{task:Z||U||O,position:G,dragType:Q,taskId:null==U?void 0:U.id,startDate:R,endDate:H,totalMonths:c,monthWidth:l,showProgress:m,instanceId:me.current,className:D,viewMode:b})):e.createElement("div",{className:"relative h-16 text-gantt-text"},"No tasks available")},U=function(t){var a=t.months,n=t.currentMonthIndex,r=(t.locale,t.className),o=void 0===r?"":r,i=t.viewMode,s=void 0===i?p.MONTH:i,c=t.unitWidth,l=void 0===c?150:c,u=[p.DAY,p.WEEK].includes(s),d=function(){if(![p.DAY,p.WEEK].includes(s)||0===a.length)return[];var e=[],t=new Date(a[0]),n=0;return a.forEach((function(a){a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()?n+=1:(e.push({date:t,span:n}),t=new Date(a),n=1)})),n>0&&e.push({date:t,span:n}),e}();return e.createElement("div",{className:"rmg-timeline ".concat(o),style:{"--gantt-unit-width":"".concat(l,"px")}},u&&e.createElement("div",{className:"flex border-b border-gantt-border"},d.map((function(t,a){return e.createElement("div",{key:"higher-level-".concat(a),className:"flex-shrink-0 p-2 font-semibold text-center text-gantt-text border-r border-gantt-border h-10",style:{width:"".concat(t.span*l,"px")},"data-timeunit-higher":t.date.toISOString()},function(e){if(!(e instanceof Date))return"";switch(s){case p.DAY:case p.WEEK:}return f(e,"MMM yyyy",{locale:void 0})}(t.date))}))),e.createElement("div",{className:"flex border-b border-gantt-border"},a.map((function(t,a){return e.createElement("div",{key:"timeunit-".concat(a),className:"".concat("w-[var(--gantt-unit-width)]"," flex-shrink-0 p-2 font-semibold text-center text-gantt-text ").concat(a===n?"bg-gantt-highlight":""," ").concat(u?"border-r border-gantt-border":""," h-10"),"data-timeunit":t.toISOString(),"data-date":(r=t,s===p.DAY?r.toISOString().slice(0,10):"")},function(e){if(!(e instanceof Date&&m(e)))return"";switch(s){case p.DAY:return f(e,"d",{locale:void 0});case p.WEEK:var t=h(e);return"W".concat(t);case p.MONTH:return f(e,"MMM yyyy",{locale:void 0});case p.QUARTER:var a=Math.floor(e.getMonth()/3)+1;return"Q".concat(a," ").concat(e.getFullYear());case p.YEAR:return e.getFullYear().toString();default:return f(e,"MMM yyyy",{locale:void 0})}}(t));var r}))))},z=function(t){var a=t.currentMonthIndex,n=t.height,r=t.markerClass,o=void 0===r?"bg-red-500":r,i=t.label,s=void 0===i?"Today":i,c=t.dayOfMonth,l=t.className,u=void 0===l?"":l,d=t.viewMode,f=void 0===d?p.MONTH:d,m=t.unitWidth,h=void 0===m?150:m;if(a<0)return null;var v=function(){var e=new Date;switch(c||e.getDate(),f){case p.DAY:return a*h+h/2;case p.WEEK:var t=e.getDay();return a*h+h*(t/7);case p.MONTH:t=e.getDay();return a*h+h*(t/7);case p.QUARTER:var n=e.getMonth()%3;return a*h+h*(n/3);case p.YEAR:var r=e.getMonth();return a*h+h*(r/12);default:return a*h+h/2}}();return e.createElement("div",{className:"absolute top-0 w-px ".concat(o," z-10 ").concat(u),style:{left:"".concat(v,"px"),height:"".concat(n,"px")},"data-testid":"today-marker"},e.createElement("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 ".concat(o," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},s))},K=function(r){var o=r.activeMode,i=r.onChange,s=r.darkMode,c=[{id:p.DAY,label:"Day"},{id:p.WEEK,label:"Week"},{id:p.MONTH,label:"Month"},{id:p.QUARTER,label:"Quarter"},{id:p.YEAR,label:"Year"}],l=a(null),u=t({left:"0px",width:"0px"}),d=u[0],f=u[1];n((function(){var e=function(){if(l.current){var e=l.current.querySelector('[aria-selected="true"]');if(e){var t=e,a=t.offsetLeft,n=t.offsetWidth;f({left:"".concat(a,"px"),width:"".concat(n,"px")})}}};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[o]);var m="\n        relative inline-flex rounded-full p-0.5\n        ".concat(s?"bg-gray-800/80":"bg-gray-100/90","\n        transition-all duration-300 ease-in-out shadow-sm\n        border ").concat(s?"border-gray-700":"border-gray-200","\n    ");return e.createElement("div",{className:"relative flex items-center"},e.createElement("div",{ref:l,className:m,role:"tablist","aria-label":"View mode options"},e.createElement("span",{className:"\n                        absolute z-0 inset-0.5 rounded-full\n                        transition-all duration-300 ease-out transform\n                        ".concat(s?"bg-indigo-600":"bg-indigo-500","\n                    "),style:d,"aria-hidden":"true"}),c.map((function(t){return e.createElement("button",{key:t.id,role:"tab","aria-selected":o===t.id,"aria-controls":"panel-".concat(t.id),className:"".concat((a=o===t.id,"\n        relative z-10 px-3 py-1 text-xs font-medium\n        transition-all duration-200 ease-in-out\n        ".concat(a?"text-white":s?"text-gray-400 hover:text-gray-200":"text-gray-500 hover:text-gray-700","\n        focus:outline-none\n    "))," rounded-full"),onClick:function(){return i(t.id)}},t.label);var a}))))},Q=function(t){var a=t.tasks,n=void 0===a?[]:a,r=t.headerLabel,o=void 0===r?"Resources":r,i=t.showIcon,s=void 0!==i&&i,c=t.showTaskCount,l=void 0!==c&&c,u=t.showDescription,d=void 0===u||u,f=t.rowHeight,m=void 0===f?40:f,h=t.className,v=void 0===h?"":h,g=t.onGroupClick,D=t.viewMode,w=Array.isArray(n)?n:[],M=D===p.DAY||D===p.WEEK;return e.createElement("div",{className:"rmg-task-list w-40 flex-shrink-0 z-10 bg-gantt-bg shadow-sm ".concat(v)},M?e.createElement(e.Fragment,null,e.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"}),e.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},o)):e.createElement("div",{className:"p-2 font-semibold text-gantt-text border-r border-b border-gantt-border h-10"},o),w.map((function(t){if(!t)return null;var a=function(e){if(!e.tasks||!Array.isArray(e.tasks))return 60;var t=R(e.tasks);return Math.max(60,t.length*m+20)}(t);return e.createElement("div",{key:"task-group-".concat(t.id||"unknown"),className:"p-2 border-r border-b border-gantt-border font-medium text-gantt-text bg-gantt-bg hover:bg-gantt-highlight transition-colors duration-150",style:{height:"".concat(a,"px")},onClick:function(){return e=t,void(g&&g(e));var e},"data-testid":"task-group-".concat(t.id||"unknown")},e.createElement("div",{className:"flex items-center"},s&&t.icon&&e.createElement("span",{className:"mr-2",dangerouslySetInnerHTML:{__html:t.icon}}),e.createElement("div",{className:"font-medium truncate"},t.name||"Unnamed")),d&&t.description&&e.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate"},t.description),l&&t.tasks&&t.tasks.length>0&&e.createElement("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1"},t.tasks.length," ",1===t.tasks.length?"task":"tasks"))})))},_=function(r){var o=r.tasks,i=void 0===o?[]:o,s=r.startDate,c=r.endDate,l=r.title,u=void 0===l?"Project Timeline":l,d=r.currentDate,f=void 0===d?new Date:d,m=r.showCurrentDateMarker,h=void 0===m||m,E=r.todayLabel,b=void 0===E?"Today":E,x=r.editMode,N=void 0===x||x,A=r.headerLabel,Y=void 0===A?"Resources":A,O=r.showProgress,C=void 0!==O&&O,L=r.darkMode,P=void 0!==L&&L,S=r.locale,I=void 0===S?"default":S,_=r.styles,q=void 0===_?{}:_,B=r.viewMode,V=void 0===B?p.MONTH:B,j=r.showViewModeSelector,G=void 0===j||j,X=r.smoothDragging,J=void 0===X||X,Z=r.movementThreshold,$=void 0===Z?3:Z,ee=r.renderTaskList,te=r.renderTask,ae=r.renderTooltip,ne=r.getTaskColor,re=r.onTaskUpdate,oe=r.onTaskClick,ie=r.onTaskSelect;r.onTaskDoubleClick;var se=r.onGroupClick,ce=r.onViewModeChange,le=r.fontSize,ue=r.rowHeight,de=void 0===ue?40:ue;r.timeStep;var fe=a(null),me=a(null),he=t(V),ve=he[0],ge=he[1],De=t([]);De[0];var we=De[1],Me=t(150),pe=Me[0],Ee=Me[1],ye=s||H(i),ke=c||F(i),be=function(e,t){var a=[],n=new Date(e);n.setHours(0,0,0,0);var r=new Date(t);for(r.setHours(23,59,59,999);n<=r;)a.push(new Date(n)),n=v(n,1);return a},xe=function(e,t){for(var a=[],n=new Date(e);n<=t;)a.push(new Date(n)),n=v(n,7);return a},Te=function(e,t){for(var a=[],n=g(new Date(e));n<=t;)a.push(new Date(n)),n=D(n,1);return a},Ne=function(e,t){for(var a=[],n=w(new Date(e));n<=t;)a.push(new Date(n)),n=M(n,1);return a},Ae=function(){switch(ve){case p.DAY:return be(ye,ke);case p.WEEK:return xe(ye,ke);case p.MONTH:return T(ye,ke);case p.QUARTER:return Te(ye,ke);case p.YEAR:return Ne(ye,ke);default:return T(ye,ke)}}(),Ye=Ae.length,Re=function(){var e=new Date;switch(ve){case p.DAY:return Ae.findIndex((function(t){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case p.WEEK:return Ae.findIndex((function(t){var a=new Date(t);return a.setDate(t.getDate()+6),e>=t&&e<=a}));case p.MONTH:return Ae.findIndex((function(t){return t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}));case p.QUARTER:var t=Math.floor(e.getMonth()/3);return Ae.findIndex((function(a){return Math.floor(a.getMonth()/3)===t&&a.getFullYear()===e.getFullYear()}));case p.YEAR:return Ae.findIndex((function(t){return t.getFullYear()===e.getFullYear()}));default:return-1}}(),He=function(e,t){if(re)try{var a=y(y({},t),{startDate:t.startDate instanceof Date?t.startDate:new Date(t.startDate),endDate:t.endDate instanceof Date?t.endDate:new Date(t.endDate)});re(e,a)}catch(e){console.error("Error in handleTaskUpdate:",e)}},Fe=function(e,t){if(oe)try{oe(e,t)}catch(e){console.error("Error in handleTaskClick:",e)}},Oe=function(e,t){if(we((function(a){return t?k(k([],a,!0),[e.id],!1):a.filter((function(t){return t!==e.id}))})),ie)try{ie(e,t)}catch(e){console.error("Error in onTaskSelect handler:",e)}},Ce=function(e){switch(ge(e),e){case p.DAY:Ee(50);break;case p.WEEK:Ee(80);break;case p.MONTH:Ee(150);break;case p.QUARTER:Ee(180);break;case p.YEAR:Ee(200);break;default:Ee(150)}ce&&ce(e)};n((function(){Ce(V)}),[V]);var Le,Pe={fontSize:le||"inherit"},Se=P?"dark":"",Ie=y(y({},{container:"",title:"",header:"",taskList:"",timeline:"",taskRow:"",todayMarker:"",tooltip:""}),q);return e.createElement("div",{ref:fe,className:"rmg-gantt-chart w-full bg-gantt-bg text-gantt-text rounded-xl shadow-lg overflow-hidden ".concat(Se," ").concat(Ie.container),style:y(y({},Pe),{"--gantt-unit-width":"".concat(pe,"px")}),"data-testid":"gantt-chart"},e.createElement("div",{className:"p-6 border-b border-gantt-border"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("h1",{className:"text-2xl font-bold text-gantt-text ".concat(Ie.title)},u),G&&e.createElement("div",{className:"flex space-x-2"},e.createElement(K,{activeMode:ve,onChange:Ce,darkMode:P})))),e.createElement("div",{className:"relative flex"},ee?ee({tasks:i,headerLabel:Y,onGroupClick:se,viewMode:ve}):e.createElement(Q,{tasks:i,headerLabel:Y,onGroupClick:se,className:Ie.taskList,viewMode:ve}),e.createElement("div",{ref:me,className:"flex-grow overflow-x-auto"},e.createElement("div",{className:"min-w-max"},e.createElement(U,{months:Ae,currentMonthIndex:Re,locale:I,className:Ie.timeline,viewMode:ve,unitWidth:pe}),e.createElement("div",{className:"relative"},h&&Re>=0&&e.createElement(z,{currentMonthIndex:Re,height:(Le=0,i.forEach((function(e){if(e&&Array.isArray(e.tasks)){var t=R(e.tasks);Le+=Math.max(60,t.length*de+20)}else Le+=60})),Le),label:b,dayOfMonth:f.getDate(),className:Ie.todayMarker,viewMode:ve,unitWidth:pe}),i.map((function(t){return t&&t.id?e.createElement(W,{key:"task-row-".concat(t.id),taskGroup:t,startDate:ye,endDate:ke,totalMonths:Ye,monthWidth:pe,editMode:N,showProgress:C,onTaskUpdate:He,onTaskClick:Fe,onTaskSelect:Oe,className:Ie.taskRow,tooltipClassName:Ie.tooltip,viewMode:ve,scrollContainerRef:me,smoothDragging:J,movementThreshold:$,renderTask:te,renderTooltip:ae,getTaskColor:ne}):null})))))))};export{L as CollisionManager,E as DateDisplayFormat,_ as GanttChart,S as TaskItem,Q as TaskList,P as TaskManager,W as TaskRow,U as Timeline,z as TodayMarker,I as Tooltip,p as ViewMode,C as calculateDuration,Y as calculateTaskPosition,R as detectTaskOverlaps,H as findEarliestDate,F as findLatestDate,x as formatDate,O as formatDateRange,b as formatMonth,N as getDaysInMonth,T as getMonthsBetween,A as getStandardDayMarkers};
//# sourceMappingURL=index.esm.js.map
