import e,{useState as t,useRef as a,useEffect as n}from"react";var r,o=function(){return o=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError,function(e){e.MONTH_YEAR="month-year",e.FULL_DATE="full-date",e.SHORT_DATE="short-date"}(r||(r={}));var l={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function i(e){return e.toLocaleString("default",{month:"short"})}function s(e,t){switch(void 0===t&&(t=r.FULL_DATE),t){case r.MONTH_YEAR:return e.toLocaleString("default",{month:"short",year:"2-digit"});case r.SHORT_DATE:return e.toLocaleString("default",{month:"short",day:"numeric"});case r.FULL_DATE:default:return e.toLocaleString("default",{month:"short",day:"numeric",year:"numeric"})}}function c(e,t){for(var a=[],n=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),l=t.getMonth(),i=n;i<=o;i++)for(var s=i===o?l:11,c=i===n?r:0;c<=s;c++)a.push(new Date(i,c,1));return a}function d(e,t){return new Date(e,t+1,0).getDate()}function u(){return[1,8,15,22,29]}function m(e,t,a){var n=c(new Date(t.getFullYear(),t.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)),r=n.length,o=e.startDate.getFullYear(),l=e.startDate.getMonth(),i=n.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===l})),s=i<0?0:i,d=e.endDate.getFullYear(),u=e.endDate.getMonth(),m=n.findIndex((function(e){return e.getFullYear()===d&&e.getMonth()===u})),f=((m<0?n.length-1:m)-s+1)/r*100;return{left:"".concat(s/r*100,"%"),width:"".concat(f,"%")}}function f(e){var t=[];return e.forEach((function(e){for(var a=!1,n=0;n<t.length;n++){if(!t[n].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){t[n].push(e),a=!0;break}}a||t.push([e])})),t}function h(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function g(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}var v=function(){function e(){}return e.detectOverlaps=function(e){if(!Array.isArray(e)||0===e.length)return[];var t=[];return e.forEach((function(e){for(var a=!1,n=0;n<t.length;n++){if(!t[n].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){t[n].push(e),a=!0;break}}a||t.push([e])})),t},e.wouldCollide=function(e,t,a){return t.some((function(t){return t.id!==e.id&&t.id!==a&&!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))},e.getPreviewArrangement=function(e,t){var a=t.map((function(t){return t.id===e.id?e:t}));return this.detectOverlaps(a)},e}(),D=function(){function e(){}return e.calculateDatesFromPosition=function(e,t,a,n,r,o){try{var l=isNaN(e)?0:e,i=isNaN(t)||t<20?20:t,s=a.getTime(),c=(n.getTime()-s)/(r*o),d=l*c,u=i*c;return{newStartDate:new Date(s+d),newEndDate:new Date(s+d+u)}}catch(e){return console.error("Error calculating dates from position:",e),{newStartDate:new Date(a),newEndDate:new Date(n)}}},e.createUpdatedTask=function(e,t,a){return o(o({},e),{startDate:new Date(t),endDate:new Date(a)})},e.calculateTaskPixelPosition=function(e,t,a,n,r){try{if(!(e.startDate instanceof Date&&e.endDate instanceof Date))throw new Error("Invalid dates in task");var o=e.startDate.getTime(),l=e.endDate.getTime(),i=t.getTime(),s=a.getTime()-i,c=(l-o)/s*100;return{leftPx:(o-i)/s*100/100*n*r,widthPx:Math.max(20,c/100*n*r)}}catch(t){return console.error("Error calculating task position:",t,e),{leftPx:0,widthPx:20}}},e.getLiveDatesFromElement=function(e,t,a,n,r){try{if(!e)return{startDate:new Date(t),endDate:new Date(a)};var o=parseFloat(e.style.left||"0"),l=parseFloat(e.style.width||"0"),i=this.calculateDatesFromPosition(o,l,t,a,n,r);return{startDate:i.newStartDate,endDate:i.newEndDate}}catch(e){return console.error("Error getting live dates:",e),{startDate:new Date(t),endDate:new Date(a)}}},e.formatDate=function(e){return e instanceof Date&&!isNaN(e.getTime())?e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Invalid date"},e.getDuration=function(e,t){try{var a=Math.abs(t.getTime()-e.getTime());return Math.ceil(a/864e5)}catch(e){return console.error("Error calculating duration:",e),0}},e}(),p=function(t){var a=t.task,n=t.leftPx,r=t.widthPx,o=t.topPx,l=t.isHovered,i=t.isDragging,s=t.editMode,c=t.onMouseDown,d=t.onMouseEnter,u=t.onMouseLeave,m=t.onClick,f=(l||i)&&s;return a&&a.id?e.createElement("div",{className:"absolute h-8 rounded ".concat(a.color||"bg-blue-500"," flex items-center px-2 text-xs text-white font-medium ").concat(s?"cursor-move":"cursor-pointer"),style:{left:"".concat(Math.max(0,n),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(o,"px")},onClick:function(e){return m(e,a)},onMouseDown:function(e){return c(e,a,"move")},onMouseEnter:function(e){return d(e,a)},onMouseLeave:u,"data-testid":"task-".concat(a.id),"data-task-id":a.id},f&&e.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-l",onMouseDown:function(e){e.stopPropagation(),c(e,a,"resize-left")}}),e.createElement("div",{className:"truncate select-none"},a.name||"Unnamed Task"),"number"==typeof a.percent&&e.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 rounded-full overflow-hidden"},e.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(a.percent,"%")}})),f&&e.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-r",onMouseDown:function(e){e.stopPropagation(),c(e,a,"resize-right")}})):(console.warn("TaskRenderer: Invalid task data",a),null)},w=function(t){var a=t.task,n=t.position,r=t.dragType,o=t.taskId,l=t.startDate,i=t.endDate,s=t.totalMonths,c=t.monthWidth,d=a.startDate,u=a.endDate;if(r&&o)try{var m=document.querySelector('[data-task-id="'.concat(o,'"]'));if(m){var f=D.getLiveDatesFromElement(m,l,i,s,c);d=f.startDate,u=f.endDate}}catch(e){console.error("Error calculating live dates for tooltip:",e)}return e.createElement("div",{className:"absolute z-20 bg-white border border-gray-200 rounded-md shadow-md p-2 text-xs select-none",style:{left:"".concat(n.x,"px"),top:"".concat(n.y-40,"px"),minWidth:"150px"}},e.createElement("div",{className:"font-bold mb-1"},a.name||"Unnamed Task"),e.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},e.createElement("div",{className:"font-semibold"},"Start:"),e.createElement("div",null,D.formatDate(d)),e.createElement("div",{className:"font-semibold"},"End:"),e.createElement("div",null,D.formatDate(u)),e.createElement("div",{className:"font-semibold"},"Duration:"),e.createElement("div",null,D.getDuration(d,u)," days"),"number"==typeof a.percent&&e.createElement(e.Fragment,null,e.createElement("div",{className:"font-semibold"},"Progress:"),e.createElement("div",null,a.percent,"%"))))},k=function(r){var o=r.person,l=r.startDate,i=r.endDate,s=r.totalMonths,c=r.monthWidth,d=r.editMode,u=void 0===d||d,m=r.onTaskUpdate,f=r.onTaskClick;if(!o||!o.id||!Array.isArray(o.tasks))return console.warn("TaskRow: Invalid person data",o),e.createElement("div",{className:"relative h-16"},"Invalid person data");var h=l instanceof Date?l:new Date,g=i instanceof Date?i:new Date,k=t(null),E=k[0],y=k[1],x=t(null),b=x[0],M=x[1],T=t(null),N=T[0],P=T[1],F=t(0),L=F[0],C=F[1],S=t({x:0,y:0}),A=S[0],U=S[1],Y=t(null),I=Y[0],O=Y[1],z=a(null),H=a(null),R=a(null),_=function(e){O(e),R.current=e},W=I?v.getPreviewArrangement(I,o.tasks):v.detectOverlaps(o.tasks),X=Math.max(60,40*W.length+20),B=function(e,t){f&&!b&&f(t,o)},j=function(e,t){b||(y(t),q(e))},G=function(){b||y(null)},q=function(e){if(z.current){var t=z.current.getBoundingClientRect();U({x:e.clientX-t.left+20,y:e.clientY-t.top})}},J=function(e){if(e instanceof MouseEvent&&"mousemove"===e.type){if(E){var t=e;if(z.current){var a=z.current.getBoundingClientRect();U({x:t.clientX-a.left+20,y:t.clientY-a.top})}}}else q(e);if(b&&N&&z.current)try{var n=e.clientX-L;if(0===n)return;var r=s*c,o=document.querySelector('[data-task-id="'.concat(b.id,'"]'));if(!o)return;var l=parseFloat(o.style.left||"0"),i=parseFloat(o.style.width||"0"),d=l,u=i;if("move"===N)d=Math.max(0,Math.min(r-i,l+n)),o.style.left="".concat(d,"px");else if("resize-left"===N){var m=i-20,f=Math.min(m,n);d=Math.max(0,l+f),u=Math.max(20,i-f),o.style.left="".concat(d,"px"),o.style.width="".concat(u,"px")}else"resize-right"===N&&(u=Math.max(20,Math.min(r-l,i+n)),o.style.width="".concat(u,"px"));var v=D.calculateDatesFromPosition(d,u,h,g,s,c),p=v.newStartDate,w=v.newEndDate,k=D.createUpdatedTask(b,p,w);O(k),_(k),console.log("Preview task updated:",k),C(e.clientX)}catch(e){console.error("Error in handleMouseMove:",e)}},K=function(e,t,a){u&&(e.preventDefault(),e.stopPropagation(),M(t),P(a),C(e.clientX),O(t),function(e){M(e),H.current=e}(t),_(t),document.addEventListener("mouseup",Q),document.addEventListener("mousemove",J))},Q=function(){try{console.log("handleMouseUp");var e=H.current,t=R.current;console.log("draggingTask (ref):",e),console.log("previewTask (ref):",t),e&&t&&m&&(console.log("Calling onTaskUpdate with:",t),m(o.id,t))}catch(e){console.error("Error in handleMouseUp:",e)}finally{M(null),P(null),O(null),H.current=null,R.current=null,document.removeEventListener("mouseup",Q),document.removeEventListener("mousemove",J)}};return n((function(){console.log("Drag operation completed with:",I),!b&&I&&m&&m(o.id,I)}),[b,I,o.id,m]),n((function(){return function(){document.removeEventListener("mouseup",Q),document.removeEventListener("mousemove",J)}}),[]),o.tasks&&0!==o.tasks.length?e.createElement("div",{className:"relative border-b border-gray-200",style:{height:"".concat(X,"px")},onMouseMove:function(e){return J(e)},onMouseLeave:function(){return y(null)},ref:z,"data-testid":"task-row-".concat(o.id)},W.map((function(t,a){return e.createElement(e.Fragment,{key:"task-row-".concat(a)},t.map((function(t){try{if(!(t&&t.id&&t.startDate instanceof Date&&t.endDate instanceof Date))return console.warn("Invalid task data:",t),null;var n=D.calculateTaskPixelPosition(t,h,g,s,c),r=n.leftPx,o=n.widthPx,l=(null==E?void 0:E.id)===t.id,i=(null==b?void 0:b.id)===t.id,d=40*a+10;return e.createElement(p,{key:"task-".concat(t.id),task:t,leftPx:r,widthPx:o,topPx:d,isHovered:l,isDragging:i,editMode:u,onMouseDown:K,onMouseEnter:j,onMouseLeave:G,onClick:B})}catch(e){return console.error("Error rendering task:",e,t),null}})))})),(E||b)&&e.createElement(w,{task:I||b||E,position:A,dragType:N,taskId:null==b?void 0:b.id,startDate:h,endDate:g,totalMonths:s,monthWidth:c})):e.createElement("div",{className:"relative h-16"},"No tasks available")},E=function(t){var r=t.people,i=void 0===r?[]:r,s=t.startDate,d=t.endDate,u=t.title,m=void 0===u?"Project Timeline":u,v=t.currentDate,D=void 0===v?new Date:v,p=t.showCurrentDateMarker,w=void 0===p||p,E=t.editMode,y=void 0===E||E,x=t.theme,b=void 0===x?l:x,M=t.onTaskUpdate,T=t.onTaskClick,N=a(null),P=a(null);n((function(){console.log("GanttChart rendered with props:",{peopleCount:null==i?void 0:i.length,startDate:s,endDate:d,onTaskUpdate:!!M,onTaskClick:!!T})}),[i,s,d,M,T]);var F=Array.isArray(i)?i:[],L=s||h(F),C=d||g(F),S=c(L,C),A=S.length,U=D.getMonth(),Y=D.getFullYear(),I=S.findIndex((function(e){return e.getMonth()===U&&e.getFullYear()===Y}));null==b||b.headerBackground,null==b||b.headerText,null==b||b.borderColor;var O,z=(null==b?void 0:b.backgroundHighlight)||"bg-blue-50",H=(null==b?void 0:b.todayMarkerColor)||"bg-red-500",R=function(e,t){if(console.log("GanttChart: handleTaskUpdate called with:",{personId:e,updatedTask:t}),M)try{var a=o(o({},t),{startDate:t.startDate instanceof Date?t.startDate:new Date(t.startDate),endDate:t.endDate instanceof Date?t.endDate:new Date(t.endDate)});M(e,a)}catch(e){console.error("Error in handleTaskUpdate:",e)}else console.warn("onTaskUpdate is not defined")},_=function(e,t){if(console.log("GanttChart: handleTaskClick called with:",{task:e,person:t}),T)try{T(e,t)}catch(e){console.error("Error in handleTaskClick:",e)}};return e.createElement("div",{ref:N,className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart"},e.createElement("div",{className:"p-6 border-b border-gray-200"},e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},m)),e.createElement("div",{className:"relative flex"},e.createElement("div",{className:"w-40 flex-shrink-0 z-10 bg-white shadow-sm"},e.createElement("div",{className:"p-2 font-semibold text-gray-700 border-r border-b border-gray-200 h-10.5"},"Team Member"),F.map((function(t){if(!t)return null;var a=f(Array.isArray(t.tasks)?t.tasks:[]),n=Math.max(60,40*a.length+20);return e.createElement("div",{key:"person-".concat(t.id||"unknown"),className:"p-2 border-r border-b border-gray-200 font-medium",style:{height:"".concat(n,"px")},"data-testid":"person-label-".concat(t.id||"unknown")},e.createElement("div",{className:"font-medium"},t.name||"Unnamed"),t.role&&e.createElement("div",{className:"text-xs text-gray-500"},t.role))}))),e.createElement("div",{ref:P,className:"flex-grow overflow-x-auto"},e.createElement("div",{className:"min-w-max"},e.createElement("div",{className:"flex border-b border-gray-200"},S.map((function(t,a){return e.createElement("div",{key:a,className:"w-[150px] flex-shrink-0 p-2 font-semibold text-center ".concat(a===I?z:""),"data-month":t.toISOString()},(n=t)instanceof Date?n.toLocaleString("default",{month:"short",year:"2-digit"}):"");var n}))),e.createElement("div",{className:"relative"},w&&I>=0&&e.createElement("div",{className:"absolute top-0 w-px ".concat(H," z-10"),style:{left:"".concat(150*(I+.5),"px"),height:"".concat((O=0,F.forEach((function(e){if(e&&Array.isArray(e.tasks)){var t=f(e.tasks);O+=Math.max(60,40*t.length+20)}else O+=60})),O),"px")},"data-testid":"today-marker"},e.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(H," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},"Today")),F.map((function(t){return t&&t.id?e.createElement(k,{key:"task-row-".concat(t.id),person:t,startDate:L,endDate:C,totalMonths:A,monthWidth:150,editMode:y,onTaskUpdate:R,onTaskClick:_}):null})))))))};export{l as DEFAULT_THEME,r as DateDisplayFormat,E as GanttChart,k as TaskRow,m as calculateTaskPosition,f as detectTaskOverlaps,h as findEarliestDate,g as findLatestDate,s as formatDate,i as formatMonth,d as getDaysInMonth,c as getMonthsBetween,u as getStandardDayMarkers};
//# sourceMappingURL=index.esm.js.map
