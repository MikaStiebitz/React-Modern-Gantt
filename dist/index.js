"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,n=t(e),r=function(){return r=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)};function o(e,t,a){if(a||2===arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}function l(t){var a=t.person,l=t.startDate,i=t.endDate;t.totalDays;var s=t.onTaskUpdate,d=t.editMode,c=void 0===d||d,u=e.useState(null),f=u[0],m=u[1],g=e.useState(null),p=g[0],h=g[1],v=e.useState(0),D=v[0],w=v[1],x=e.useState(null),y=x[0],b=x[1],E=e.useState({x:0,y:0}),T=E[0],M=E[1],k=e.useRef(null),N=function(e){return e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},S=function(e,t,a){c&&(e.preventDefault(),e.stopPropagation(),m(t),h(a),w(e.clientX),Y(e),document.addEventListener("mouseup",L),document.addEventListener("mousemove",F),console.log("Mouse down on task ".concat(t.id," with type ").concat(a)))},F=function(e){var t,n;if(e instanceof MouseEvent&&"mousemove"===e.type){var o=e;y&&M({x:o.clientX-((null===(t=k.current)||void 0===t?void 0:t.getBoundingClientRect().left)||0)+20,y:o.clientY-((null===(n=k.current)||void 0===n?void 0:n.getBoundingClientRect().top)||0)})}else Y(e);if(f&&p&&k.current){var d=k.current.getBoundingClientRect(),c=(e.clientX-D)/d.width*(i.getTime()-l.getTime()),u=new Date(f.startDate),g=new Date(f.endDate),h=f.percent;if("move"===p)u=new Date(u.getTime()+c),g=new Date(g.getTime()+c);else if("resize-start"===p)u=new Date(u.getTime()+c);else if("resize-end"===p)g=new Date(g.getTime()+c);else if("adjust-progress"===p&&void 0!==f.percent){var v=document.querySelectorAll('[data-task-id="'.concat(f.id,'"]'));if(v.length>0){var x=v[0].getBoundingClientRect(),b=x.width,E=e.clientX-x.left;h=Math.max(0,Math.min(100,E/b*100))}}if(u<l&&(u=new Date(l),"move"===p)){var T=f.endDate.getTime()-f.startDate.getTime();g=new Date(u.getTime()+T)}if(g>i&&(g=new Date(i),"move"===p)){T=f.endDate.getTime()-f.startDate.getTime();u=new Date(g.getTime()-T)}g<u&&("resize-start"===p?u=new Date(g):g=new Date(u));var N=r(r({},f),{startDate:u,endDate:g,percent:h});m(N),s(a.id,N),w(e.clientX),console.log("Task updated during drag: Start=".concat(u.toISOString(),", End=").concat(g.toISOString()))}},L=function(){f&&p&&(s(a.id,f),console.log("Mouse up - Task updated: ".concat(f.id))),m(null),h(null),document.removeEventListener("mouseup",L),document.removeEventListener("mousemove",F)},Y=function(e){if(k.current){var t=k.current.getBoundingClientRect();M({x:e.clientX-t.left+20,y:e.clientY-t.top})}};e.useEffect((function(){return function(){document.removeEventListener("mouseup",L),document.removeEventListener("mousemove",F)}}),[]);var C,O,R,z=(C=a.tasks,O=o([],C,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),R=[],O.forEach((function(e){for(var t=!1,a=0;a<R.length;a++){for(var n=!0,r=0,o=R[a];r<o.length;r++){var l=o[r];if(!(e.endDate<=l.startDate||e.startDate>=l.endDate)){n=!1;break}}if(n){R[a].push(e),t=!0;break}}t||R.push([e])})),R),A=Math.max(60,40*z.length);return a&&a.tasks&&0!==a.tasks.length?n.default.createElement("div",{className:"relative select-none",style:{height:"".concat(A,"px")},onMouseMove:function(e){return F(e)},onMouseLeave:function(){return b(null)},ref:k},z.map((function(e,t){return e.map((function(e){var a,r,o,s=function(e){var t=e.startDate.getTime(),a=e.endDate.getTime(),n=l.getTime(),r=i.getTime()-n,o=Math.max(0,t-n)/r,s=Math.min(1,(a-n)/r)-o;return{left:"".concat(100*o,"%"),width:"".concat(100*s,"%")}}(e),d=s.left,u=s.width,m=y===e,g=f===e,p=(m||g)&&c;return n.default.createElement(n.default.Fragment,{key:e.id},n.default.createElement("div",{className:"absolute h-8 rounded-md ".concat(e.color," z-10 flex items-center justify-between text-xs text-white font-semibold ").concat(c?"cursor-move":"cursor-default"," task-bar select-none"),"data-task-id":e.id,style:{left:d,width:u,top:"".concat(40*t+4,"px")},onMouseDown:c?function(t){return function(e,t){c&&(e.preventDefault(),e.stopPropagation(),console.log("Direct task div mousedown on ".concat(t.id)),S(e,t,"move"))}(t,e)}:void 0,onMouseEnter:function(){return b(e)}},n.default.createElement("div",{className:"truncate px-2 py-1 flex-grow"},e.name),p&&n.default.createElement("div",{className:"absolute left-0 w-1.5 h-[90%] bg-white rounded-md cursor-ew-resize",onMouseDown:function(t){t.stopPropagation(),S(t,e,"resize-start")}}),p&&n.default.createElement("div",{className:"absolute right-0 w-1.5 h-[90%] bg-white rounded-md cursor-ew-resize",onMouseDown:function(t){t.stopPropagation(),S(t,e,"resize-end")}}),void 0!==e.percent&&n.default.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1.5 bg-black bg-opacity-20 rounded-full overflow-hidden"},n.default.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(e.percent,"%")}}),p&&n.default.createElement("div",{className:"absolute top-1/2 h-3 w-3 bg-white rounded-full -translate-y-1/2 cursor-ew-resize border border-gray-400",style:{left:"calc(".concat(e.percent,"% - 4px)")},onMouseDown:function(t){t.stopPropagation(),S(t,e,"adjust-progress")}}))),(m||g)&&n.default.createElement("div",{className:"absolute z-20 bg-white border border-gray-200 rounded-md shadow-md p-2 text-xs select-none",style:{left:"".concat(T.x,"px"),top:"".concat(T.y-40,"px")}},n.default.createElement("div",{className:"font-bold"},e.name),n.default.createElement("div",null,"Start: ",N(e.startDate)),n.default.createElement("div",null,"End: ",N(e.endDate)),n.default.createElement("div",null,"Duration: ",(a=e.startDate,r=e.endDate,o=Math.abs(r.getTime()-a.getTime()),Math.ceil(o/864e5))," days"),void 0!==e.percent&&n.default.createElement("div",null,"Progress: ",Math.round(e.percent),"%")))}))}))):n.default.createElement("div",{className:"relative h-16"},"No tasks available")}"function"==typeof SuppressedError&&SuppressedError,exports.DateDisplayFormat=void 0,(a=exports.DateDisplayFormat||(exports.DateDisplayFormat={})).MONTH_YEAR="month-year",a.FULL_DATE="full-date",a.SHORT_DATE="short-date";var i={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function s(e,t){for(var a=[],n=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),l=t.getMonth(),i=n;i<=o;i++)for(var s=i===o?l:11,d=i===n?r:0;d<=s;d++)a.push(new Date(i,d,1));return a}function d(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function c(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}exports.DEFAULT_THEME=i,exports.GanttChart=function(t){var a=t.people,r=t.startDate,o=t.endDate,u=t.title,f=void 0===u?"Project Timeline":u,m=t.currentDate,g=void 0===m?new Date:m,p=t.showCurrentDateMarker,h=void 0===p||p,v=t.editMode,D=void 0===v||v,w=t.theme,x=void 0===w?i:w,y=t.onTaskUpdate;t.onTaskClick;var b=r||d(a),E=o||c(a),T=s(b,E);T.length;var M=Math.round((E.getTime()-b.getTime())/864e5),k=g.getMonth(),N=g.getFullYear(),S=T.findIndex((function(e){return e.getMonth()===k&&e.getFullYear()===N})),F=e.useRef(null),L=function(e,t){console.log("GanttChart received update for task ".concat(t.id," in person ").concat(e)),console.log("New dates: ".concat(t.startDate.toISOString()," - ").concat(t.endDate.toISOString())),y?y(e,t):console.warn("No onTaskUpdate handler provided to GanttChart")};x.headerBackground,x.headerText,x.borderColor;var Y=x.backgroundHighlight||"bg-blue-50",C=x.todayMarkerColor||"bg-red-500";return n.default.createElement("div",{ref:F,className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart"},n.default.createElement("div",{className:"p-6 border-b border-gray-200"},n.default.createElement("h1",{className:"text-2xl font-bold text-gray-800"},f)),n.default.createElement("div",{className:"p-4"},n.default.createElement("div",{className:"flex border-b border-gray-200"},n.default.createElement("div",{className:"w-40 flex-shrink-0 p-2 font-semibold text-gray-700 border-r border-gray-200"},"Team Member"),n.default.createElement("div",{className:"flex-grow flex"},T.map((function(e,t){return n.default.createElement("div",{key:t,className:"flex-1 p-2 font-semibold text-center ".concat(t===S?Y:""),"data-month":e.toISOString()},e.toLocaleString("default",{month:"short",year:"2-digit"}))})))),n.default.createElement("div",{className:"relative"},h&&S>=0&&n.default.createElement("div",{className:"absolute top-0 w-px ".concat(C," z-10"),style:{left:"".concat((S+.5)/T.length*100,"%"),height:"100%"},"data-testid":"today-marker"},n.default.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(C," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},"Today")),a.map((function(e){return n.default.createElement("div",{key:e.id,className:"flex border-b border-gray-200 hover:bg-gray-50","data-testid":"person-row-".concat(e.id)},n.default.createElement("div",{className:"w-40 flex-shrink-0 p-2 border-r border-gray-200"},n.default.createElement("div",{className:"font-medium"},e.name),e.role&&n.default.createElement("div",{className:"text-xs text-gray-500"},e.role)),n.default.createElement("div",{className:"flex-grow"},n.default.createElement(l,{person:e,startDate:b,endDate:E,totalDays:M,onTaskUpdate:L,editMode:D})))})))))},exports.TaskRow=l,exports.calculateTaskPosition=function(e,t,a){var n=s(new Date(t.getFullYear(),t.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)),r=n.length,o=e.startDate.getFullYear(),l=e.startDate.getMonth(),i=n.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===l})),d=i<0?0:i,c=e.endDate.getFullYear(),u=e.endDate.getMonth(),f=n.findIndex((function(e){return e.getFullYear()===c&&e.getMonth()===u})),m=((f<0?n.length-1:f)-d+1)/r*100;return{left:"".concat(d/r*100,"%"),width:"".concat(m,"%")}},exports.detectTaskOverlaps=function(e){var t=o([],e,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),a=[];return t.forEach((function(e){for(var t=!1,n=0;n<a.length;n++){if(a[n].every((function(t){return e.startDate>=t.endDate||e.endDate<=t.startDate}))){a[n].push(e),t=!0;break}}t||a.push([e])})),a},exports.findEarliestDate=d,exports.findLatestDate=c,exports.formatDate=function(e,t){switch(void 0===t&&(t=exports.DateDisplayFormat.FULL_DATE),t){case exports.DateDisplayFormat.MONTH_YEAR:return e.toLocaleString("default",{month:"short",year:"2-digit"});case exports.DateDisplayFormat.SHORT_DATE:return e.toLocaleString("default",{month:"short",day:"numeric"});case exports.DateDisplayFormat.FULL_DATE:default:return e.toLocaleString("default",{month:"short",day:"numeric",year:"numeric"})}},exports.formatMonth=function(e){return e.toLocaleString("default",{month:"short"})},exports.getDaysInMonth=function(e,t){return new Date(e,t+1,0).getDate()},exports.getMonthsBetween=s,exports.getStandardDayMarkers=function(){return[1,8,15,22,29]};
//# sourceMappingURL=index.js.map
