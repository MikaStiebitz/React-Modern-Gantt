"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,n=t(e),r=function(){return r=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError,exports.DateDisplayFormat=void 0,(a=exports.DateDisplayFormat||(exports.DateDisplayFormat={})).MONTH_YEAR="month-year",a.FULL_DATE="full-date",a.SHORT_DATE="short-date";var o={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function l(e,t){for(var a=[],n=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),l=t.getMonth(),i=n;i<=o;i++)for(var s=i===o?l:11,c=i===n?r:0;c<=s;c++)a.push(new Date(i,c,1));return a}function i(e){var t=[];return e.forEach((function(e){for(var a=!1,n=0;n<t.length;n++){if(!t[n].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){t[n].push(e),a=!0;break}}a||t.push([e])})),t}function s(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function c(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}var u=function(){function e(){}return e.detectOverlaps=function(e){if(!Array.isArray(e)||0===e.length)return[];var t=[];return e.forEach((function(e){for(var a=!1,n=0;n<t.length;n++){if(!t[n].some((function(t){return!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))){t[n].push(e),a=!0;break}}a||t.push([e])})),t},e.wouldCollide=function(e,t,a){return t.some((function(t){return t.id!==e.id&&t.id!==a&&!(e.startDate>=t.endDate||e.endDate<=t.startDate)}))},e.getPreviewArrangement=function(e,t){var a=t.map((function(t){return t.id===e.id?e:t}));return this.detectOverlaps(a)},e}(),d=function(){function e(){}return e.calculateDatesFromPosition=function(e,t,a,n,r,o){try{var l=isNaN(e)?0:e,i=isNaN(t)||t<20?20:t,s=a.getTime(),c=(n.getTime()-s)/(r*o),u=l*c,d=i*c;return{newStartDate:new Date(s+u),newEndDate:new Date(s+u+d)}}catch(e){return console.error("Error calculating dates from position:",e),{newStartDate:new Date(a),newEndDate:new Date(n)}}},e.createUpdatedTask=function(e,t,a){return r(r({},e),{startDate:new Date(t),endDate:new Date(a)})},e.calculateTaskPixelPosition=function(e,t,a,n,r){try{if(!(e.startDate instanceof Date&&e.endDate instanceof Date))throw new Error("Invalid dates in task");var o=e.startDate.getTime(),l=e.endDate.getTime(),i=t.getTime(),s=a.getTime()-i,c=(l-o)/s*100;return{leftPx:(o-i)/s*100/100*n*r,widthPx:Math.max(20,c/100*n*r)}}catch(t){return console.error("Error calculating task position:",t,e),{leftPx:0,widthPx:20}}},e.getLiveDatesFromElement=function(e,t,a,n,r){try{if(!e)return{startDate:new Date(t),endDate:new Date(a)};var o=parseFloat(e.style.left||"0"),l=parseFloat(e.style.width||"0"),i=this.calculateDatesFromPosition(o,l,t,a,n,r);return{startDate:i.newStartDate,endDate:i.newEndDate}}catch(e){return console.error("Error getting live dates:",e),{startDate:new Date(t),endDate:new Date(a)}}},e.formatDate=function(e){return e instanceof Date&&!isNaN(e.getTime())?e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Invalid date"},e.getDuration=function(e,t){try{var a=Math.abs(t.getTime()-e.getTime());return Math.ceil(a/864e5)}catch(e){return console.error("Error calculating duration:",e),0}},e}(),f=function(e){var t=e.task,a=e.leftPx,r=e.widthPx,o=e.topPx,l=e.isHovered,i=e.isDragging,s=e.editMode,c=e.onMouseDown,u=e.onMouseEnter,d=e.onMouseLeave,f=e.onClick,m=(l||i)&&s;return t&&t.id?n.default.createElement("div",{className:"absolute h-8 rounded ".concat(t.color||"bg-blue-500"," flex items-center px-2 text-xs text-white font-medium ").concat(s?"cursor-move":"cursor-pointer"),style:{left:"".concat(Math.max(0,a),"px"),width:"".concat(Math.max(20,r),"px"),top:"".concat(o,"px")},onClick:function(e){return f(e,t)},onMouseDown:function(e){return c(e,t,"move")},onMouseEnter:function(e){return u(e,t)},onMouseLeave:d,"data-testid":"task-".concat(t.id),"data-task-id":t.id},m&&n.default.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-l",onMouseDown:function(e){e.stopPropagation(),c(e,t,"resize-left")}}),n.default.createElement("div",{className:"truncate select-none"},t.name||"Unnamed Task"),"number"==typeof t.percent&&n.default.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 rounded-full overflow-hidden"},n.default.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(t.percent,"%")}})),m&&n.default.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-r",onMouseDown:function(e){e.stopPropagation(),c(e,t,"resize-right")}})):(console.warn("TaskRenderer: Invalid task data",t),null)},m=function(e){var t=e.task,a=e.position,r=e.dragType,o=e.taskId,l=e.startDate,i=e.endDate,s=e.totalMonths,c=e.monthWidth,u=t.startDate,f=t.endDate;try{var m=o||t.id,h=document.querySelector('[data-task-id="'.concat(m,'"]'));if(h&&(r||h.style.left||h.style.width)){var D=d.getLiveDatesFromElement(h,l,i,s,c);u=D.startDate,f=D.endDate}}catch(e){console.error("Error calculating live dates for tooltip:",e)}return n.default.createElement("div",{className:"absolute z-20 bg-white border border-gray-200 rounded-md shadow-md p-2 text-xs select-none",style:{left:"".concat(a.x,"px"),top:"".concat(a.y-40,"px"),minWidth:"150px"}},n.default.createElement("div",{className:"font-bold mb-1"},t.name||"Unnamed Task"),n.default.createElement("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1"},n.default.createElement("div",{className:"font-semibold"},"Start:"),n.default.createElement("div",null,d.formatDate(u)),n.default.createElement("div",{className:"font-semibold"},"End:"),n.default.createElement("div",null,d.formatDate(f)),n.default.createElement("div",{className:"font-semibold"},"Duration:"),n.default.createElement("div",null,d.getDuration(u,f)," days"),"number"==typeof t.percent&&n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"font-semibold"},"Progress:"),n.default.createElement("div",null,t.percent,"%"))))},h=function(t){var a=t.person,r=t.startDate,o=t.endDate,l=t.totalMonths,i=t.monthWidth,s=t.editMode,c=void 0===s||s,h=t.onTaskUpdate,D=t.onTaskClick;if(!a||!a.id||!Array.isArray(a.tasks))return console.warn("TaskRow: Invalid person data",a),n.default.createElement("div",{className:"relative h-16"},"Invalid person data");var v=r instanceof Date?r:new Date,g=o instanceof Date?o:new Date,p=e.useState(null),x=p[0],w=p[1],y=e.useState(null),E=y[0],k=y[1],b=e.useState(null),M=b[0],T=b[1],N=e.useState(0),F=N[0],P=N[1],S=e.useState({x:0,y:0}),L=S[0],A=S[1],C=e.useState(null),U=C[0],Y=C[1],R=e.useRef(null),I=e.useRef(null),O=e.useRef(null),_=function(e){Y(e),O.current=e},z=U?u.getPreviewArrangement(U,a.tasks):u.detectOverlaps(a.tasks),H=Math.max(60,40*z.length+20),j=function(e,t){D&&!E&&D(t,a)},B=function(e,t){E||(w(t),X(e))},W=function(){E||w(null)},X=function(e){if(R.current){var t=R.current.getBoundingClientRect();A({x:e.clientX-t.left+20,y:e.clientY-t.top})}},q=function(e){if(e instanceof MouseEvent&&"mousemove"===e.type){if(x){var t=e;if(R.current){var a=R.current.getBoundingClientRect();A({x:t.clientX-a.left+20,y:t.clientY-a.top})}}}else X(e);if(E&&M&&R.current)try{var n=e.clientX-F;if(0===n)return;var r=l*i,o=document.querySelector('[data-task-id="'.concat(E.id,'"]'));if(!o)return;var s=parseFloat(o.style.left||"0"),c=parseFloat(o.style.width||"0"),u=s,f=c;if("move"===M)u=Math.max(0,Math.min(r-c,s+n)),o.style.left="".concat(u,"px");else if("resize-left"===M){var m=c-20,h=Math.min(m,n);u=Math.max(0,s+h),f=Math.max(20,c-h),o.style.left="".concat(u,"px"),o.style.width="".concat(f,"px")}else"resize-right"===M&&(f=Math.max(20,Math.min(r-s,c+n)),o.style.width="".concat(f,"px"));var D=d.calculateDatesFromPosition(u,f,v,g,l,i),p=D.newStartDate,w=D.newEndDate,y=d.createUpdatedTask(E,p,w);Y(y),_(y),P(e.clientX)}catch(e){console.error("Error in handleMouseMove:",e)}},G=function(e,t,a){c&&(e.preventDefault(),e.stopPropagation(),k(t),T(a),P(e.clientX),Y(t),function(e){k(e),I.current=e}(t),_(t),document.addEventListener("mouseup",J),document.addEventListener("mousemove",q))},J=function(){try{var e=I.current,t=O.current;e&&t&&h&&h(a.id,t)}catch(e){console.error("Error in handleMouseUp:",e)}finally{k(null),T(null),Y(null),I.current=null,O.current=null,document.removeEventListener("mouseup",J),document.removeEventListener("mousemove",q)}};return e.useEffect((function(){!E&&U&&h&&h(a.id,U)}),[E,U,a.id,h]),e.useEffect((function(){return function(){document.removeEventListener("mouseup",J),document.removeEventListener("mousemove",q)}}),[]),a.tasks&&0!==a.tasks.length?n.default.createElement("div",{className:"relative border-b border-gray-200",style:{height:"".concat(H,"px")},onMouseMove:function(e){return q(e)},onMouseLeave:function(){return w(null)},ref:R,"data-testid":"task-row-".concat(a.id)},z.map((function(e,t){return n.default.createElement(n.default.Fragment,{key:"task-row-".concat(t)},e.map((function(e){try{if(!(e&&e.id&&e.startDate instanceof Date&&e.endDate instanceof Date))return console.warn("Invalid task data:",e),null;var a=d.calculateTaskPixelPosition(e,v,g,l,i),r=a.leftPx,o=a.widthPx,s=(null==x?void 0:x.id)===e.id,u=(null==E?void 0:E.id)===e.id,m=40*t+10;return n.default.createElement(f,{key:"task-".concat(e.id),task:e,leftPx:r,widthPx:o,topPx:m,isHovered:s,isDragging:u,editMode:c,onMouseDown:G,onMouseEnter:B,onMouseLeave:W,onClick:j})}catch(t){return console.error("Error rendering task:",t,e),null}})))})),(x||E)&&n.default.createElement(m,{task:U||E||x,position:L,dragType:M,taskId:null==E?void 0:E.id,startDate:v,endDate:g,totalMonths:l,monthWidth:i})):n.default.createElement("div",{className:"relative h-16"},"No tasks available")};exports.DEFAULT_THEME=o,exports.GanttChart=function(t){var a=t.people,u=void 0===a?[]:a,d=t.startDate,f=t.endDate,m=t.title,D=void 0===m?"Project Timeline":m,v=t.currentDate,g=void 0===v?new Date:v,p=t.showCurrentDateMarker,x=void 0===p||p,w=t.editMode,y=void 0===w||w,E=t.theme,k=void 0===E?o:E,b=t.onTaskUpdate,M=t.onTaskClick,T=e.useRef(null),N=e.useRef(null),F=Array.isArray(u)?u:[],P=d||s(F),S=f||c(F),L=l(P,S),A=L.length,C=g.getMonth(),U=g.getFullYear(),Y=L.findIndex((function(e){return e.getMonth()===C&&e.getFullYear()===U}));null==k||k.headerBackground,null==k||k.headerText,null==k||k.borderColor;var R,I=(null==k?void 0:k.backgroundHighlight)||"bg-blue-50",O=(null==k?void 0:k.todayMarkerColor)||"bg-red-500",_=function(e,t){if(b)try{var a=r(r({},t),{startDate:t.startDate instanceof Date?t.startDate:new Date(t.startDate),endDate:t.endDate instanceof Date?t.endDate:new Date(t.endDate)});b(e,a)}catch(e){console.error("Error in handleTaskUpdate:",e)}else console.warn("onTaskUpdate is not defined")},z=function(e,t){if(M)try{M(e,t)}catch(e){console.error("Error in handleTaskClick:",e)}};return n.default.createElement("div",{ref:T,className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart"},n.default.createElement("div",{className:"p-6 border-b border-gray-200"},n.default.createElement("h1",{className:"text-2xl font-bold text-gray-800"},D)),n.default.createElement("div",{className:"relative flex"},n.default.createElement("div",{className:"w-40 flex-shrink-0 z-10 bg-white shadow-sm"},n.default.createElement("div",{className:"p-2 font-semibold text-gray-700 border-r border-b border-gray-200 h-10.5"},"Team Member"),F.map((function(e){if(!e)return null;var t=i(Array.isArray(e.tasks)?e.tasks:[]),a=Math.max(60,40*t.length+20);return n.default.createElement("div",{key:"person-".concat(e.id||"unknown"),className:"p-2 border-r border-b border-gray-200 font-medium",style:{height:"".concat(a,"px")},"data-testid":"person-label-".concat(e.id||"unknown")},n.default.createElement("div",{className:"font-medium"},e.name||"Unnamed"),e.role&&n.default.createElement("div",{className:"text-xs text-gray-500"},e.role))}))),n.default.createElement("div",{ref:N,className:"flex-grow overflow-x-auto"},n.default.createElement("div",{className:"min-w-max"},n.default.createElement("div",{className:"flex border-b border-gray-200"},L.map((function(e,t){return n.default.createElement("div",{key:t,className:"w-[150px] flex-shrink-0 p-2 font-semibold text-center ".concat(t===Y?I:""),"data-month":e.toISOString()},(a=e)instanceof Date?a.toLocaleString("default",{month:"short",year:"2-digit"}):"");var a}))),n.default.createElement("div",{className:"relative"},x&&Y>=0&&n.default.createElement("div",{className:"absolute top-0 w-px ".concat(O," z-10"),style:{left:"".concat(150*(Y+.5),"px"),height:"".concat((R=0,F.forEach((function(e){if(e&&Array.isArray(e.tasks)){var t=i(e.tasks);R+=Math.max(60,40*t.length+20)}else R+=60})),R),"px")},"data-testid":"today-marker"},n.default.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(O," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},"Today")),F.map((function(e){return e&&e.id?n.default.createElement(h,{key:"task-row-".concat(e.id),person:e,startDate:P,endDate:S,totalMonths:A,monthWidth:150,editMode:y,onTaskUpdate:_,onTaskClick:z}):null})))))))},exports.TaskRow=h,exports.calculateTaskPosition=function(e,t,a){var n=l(new Date(t.getFullYear(),t.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)),r=n.length,o=e.startDate.getFullYear(),i=e.startDate.getMonth(),s=n.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===i})),c=s<0?0:s,u=e.endDate.getFullYear(),d=e.endDate.getMonth(),f=n.findIndex((function(e){return e.getFullYear()===u&&e.getMonth()===d})),m=((f<0?n.length-1:f)-c+1)/r*100;return{left:"".concat(c/r*100,"%"),width:"".concat(m,"%")}},exports.detectTaskOverlaps=i,exports.findEarliestDate=s,exports.findLatestDate=c,exports.formatDate=function(e,t){switch(void 0===t&&(t=exports.DateDisplayFormat.FULL_DATE),t){case exports.DateDisplayFormat.MONTH_YEAR:return e.toLocaleString("default",{month:"short",year:"2-digit"});case exports.DateDisplayFormat.SHORT_DATE:return e.toLocaleString("default",{month:"short",day:"numeric"});case exports.DateDisplayFormat.FULL_DATE:default:return e.toLocaleString("default",{month:"short",day:"numeric",year:"numeric"})}},exports.formatMonth=function(e){return e.toLocaleString("default",{month:"short"})},exports.getDaysInMonth=function(e,t){return new Date(e,t+1,0).getDate()},exports.getMonthsBetween=l,exports.getStandardDayMarkers=function(){return[1,8,15,22,29]};
//# sourceMappingURL=index.js.map
