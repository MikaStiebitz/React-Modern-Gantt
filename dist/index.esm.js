import e,{useState as t,useRef as a,useEffect as r}from"react";var n=function(){return n=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},n.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var o={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function l(e){return e.toLocaleString("default",{month:"short"})}function i(e,t){for(var a=[],r=e.getFullYear(),n=e.getMonth(),o=t.getFullYear(),l=t.getMonth(),i=r;i<=o;i++)for(var s=i===o?l:11,c=i===r?n:0;c<=s;c++)a.push(new Date(i,c,1));return a}function s(e,t,a){var r=i(new Date(t.getFullYear(),t.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)),n=r.length,o=e.startDate.getFullYear(),l=e.startDate.getMonth(),s=r.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===l})),c=s<0?0:s,d=e.endDate.getFullYear(),u=e.endDate.getMonth(),g=r.findIndex((function(e){return e.getFullYear()===d&&e.getMonth()===u})),m=((g<0?r.length-1:g)-c+1)/n*100;return{left:"".concat(c/n*100,"%"),width:"".concat(m,"%")}}function c(e){var t=function(e,t,a){if(a||2===arguments.length)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}([],e,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),a=[];return t.forEach((function(e){for(var t=!1,r=0;r<a.length;r++){var n=a[r][a[r].length-1];if(e.startDate>=n.endDate){a[r].push(e),t=!0;break}}t||a.push([e])})),a}function d(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function u(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}var g=function(a){var r=a.people,n=a.startDate,l=a.endDate,g=a.title,m=void 0===g?"Project Timeline":g,f=a.currentDate,h=void 0===f?new Date:f,v=a.showCurrentDateMarker,p=void 0===v||v,y=a.editMode,k=void 0===y||y,b=a.theme,w=void 0===b?o:b;a.onTaskUpdate;var x=a.onTaskClick,D=t(null),E=D[0],M=D[1],N=t({x:0,y:0}),I=N[0],F=N[1],Y=n||d(r),L=l||u(r),T=i(Y,L),S=h.getMonth(),C=h.getFullYear(),z=T.findIndex((function(e){return e.getMonth()===S&&e.getFullYear()===C})),W=function(){M(null)};w.headerBackground,w.headerText,w.borderColor;var X=w.backgroundHighlight||"bg-blue-50",B=w.todayMarkerColor||"bg-red-500";return e.createElement("div",{className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart",onMouseMove:function(e){E&&F({x:e.clientX,y:e.clientY})}},e.createElement("div",{className:"p-6 border-b border-gray-200"},e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},m)),e.createElement("div",{className:"p-4"},e.createElement("div",{className:"flex border-b border-gray-200"},e.createElement("div",{className:"w-40 flex-shrink-0 p-2 font-semibold text-gray-700 border-r border-gray-200"},"Team Member"),e.createElement("div",{className:"flex-grow flex"},T.map((function(t,a){return e.createElement("div",{key:a,className:"flex-1 p-2 font-semibold text-center ".concat(a===z?X:""),"data-month":t.toISOString()},t.toLocaleString("default",{month:"short",year:"2-digit"}))})))),r.map((function(t){var a=c(t.tasks),n=Math.max(60,30*a.length+15);return e.createElement("div",{key:t.id,className:"flex border-b border-gray-200 hover:bg-gray-50","data-testid":"person-row-".concat(t.id)},e.createElement("div",{className:"w-40 flex-shrink-0 p-2 border-r border-gray-200",style:{height:"".concat(n,"px")}},e.createElement("div",{className:"font-medium"},t.name),t.role&&e.createElement("div",{className:"text-xs text-gray-500"},t.role)),e.createElement("div",{className:"flex-grow relative",style:{height:"".concat(n,"px")}},a.map((function(a,r){return e.createElement(e.Fragment,{key:r},a.map((function(a){var n=s(a,Y,L),o=n.left,l=n.width;return e.createElement("div",{key:a.id,className:"absolute h-8 rounded ".concat(a.color," flex items-center px-2 text-xs text-white font-medium ").concat(k?"cursor-move":"cursor-pointer"),style:{left:o,width:l,top:"".concat(30*r+15,"px")},onClick:function(e){return function(e,t,a){x&&x(t,a)}(0,a,t)},onMouseEnter:function(e){return function(e,t,a){M({task:t,person:a}),F({x:e.clientX,y:e.clientY})}(e,a,t)},onMouseLeave:W,"data-testid":"task-".concat(a.id),"data-task-id":a.id},e.createElement("div",{className:"truncate"},a.name),void 0!==a.percent&&e.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 rounded-full overflow-hidden"},e.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(a.percent,"%")}})))})))})),p&&z>=0&&n>0&&e.createElement("div",{className:"absolute top-0 bottom-0 w-px ".concat(B," z-10"),style:{left:"".concat((z+.5)/T.length*100,"%")},"data-testid":"today-marker"},t===r[0]&&e.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(B," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},"Today"))))}))),E&&e.createElement("div",{className:"fixed z-50 bg-white shadow-lg rounded-md border border-gray-200 p-3 text-xs",style:{left:"".concat(I.x+10,"px"),top:"".concat(I.y-80,"px"),minWidth:"200px"}},e.createElement("div",{className:"font-bold mb-1 text-sm"},E.task.name),e.createElement("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1"},e.createElement("div",{className:"font-semibold"},"Start:"),e.createElement("div",null,E.task.startDate.toLocaleDateString()),e.createElement("div",{className:"font-semibold"},"End:"),e.createElement("div",null,E.task.endDate.toLocaleDateString()),void 0!==E.task.percent&&e.createElement(e.Fragment,null,e.createElement("div",{className:"font-semibold"},"Progress:"),e.createElement("div",null,E.task.percent,"%")))))},m=function(o){var l=o.people,s=o.startDate,c=o.endDate,d=o.onTaskUpdate,u=t({isDragging:!1,personId:null,taskId:null,dragType:null,startX:0,startLeft:0,startWidth:0,task:null}),g=u[0],m=u[1],h=a(null),v=i(s,c),p=v.length,y=function(e,t,a,r){e.preventDefault(),e.stopPropagation();var n=document.querySelector('[data-task-id="'.concat(a,'"]'));if(n&&h.current){var o=l.find((function(e){return e.id===t}));if(o){var i=o.tasks.find((function(e){return e.id===a}));if(i){var s=h.current.getBoundingClientRect(),c=n.getBoundingClientRect(),d=(c.left-s.left)/s.width*100,u=c.width/s.width*100;m({isDragging:!0,personId:t,taskId:a,dragType:r,startX:e.clientX,startLeft:d,startWidth:u,task:i}),document.addEventListener("mousemove",k),document.addEventListener("mouseup",b),console.log("Started dragging:",{personId:t,taskId:a,dragType:r})}}}},k=function(e){if(g.isDragging&&h.current){var t=h.current.getBoundingClientRect(),a=(e.clientX-g.startX)/t.width*100,r=document.querySelector('[data-task-id="'.concat(g.taskId,'"]'));if(r)if("move"===g.dragType){var n=g.startLeft+a,o=Math.max(0,Math.min(100-g.startWidth,n));r.style.left="".concat(o,"%")}else if("resize-left"===g.dragType){var l=g.startWidth-5,i=Math.min(l,a),s=(n=g.startLeft+i,g.startWidth-i);n>=0&&s>=5&&(r.style.left="".concat(n,"%"),r.style.width="".concat(s,"%"))}else if("resize-right"===g.dragType){s=Math.max(5,g.startWidth+a);var c=100-g.startLeft,d=Math.min(c,s);r.style.width="".concat(d,"%")}}},b=function(){if(g.isDragging&&g.taskId&&g.personId&&g.task){var e=document.querySelector('[data-task-id="'.concat(g.taskId,'"]'));if(e&&h.current){var t=parseFloat(e.style.left),a=parseFloat(e.style.width),r=Math.floor(t/100*p),o=Math.ceil(a/100*p);if(r>=0&&r<v.length){var l=v[r],i=r+o-1;i>=v.length&&(i=v.length-1);var s=v[i],c=new Date(l.getFullYear(),l.getMonth(),Math.min(g.task.startDate.getDate(),f(l.getFullYear(),l.getMonth()))),u=new Date(s.getFullYear(),s.getMonth(),Math.min(g.task.endDate.getDate(),f(s.getFullYear(),s.getMonth()))),m=n(n({},g.task),{startDate:c,endDate:u});console.log("Updating task:",{personId:g.personId,taskId:g.taskId,from:{start:g.task.startDate,end:g.task.endDate},to:{start:c,end:u}}),d&&d(g.personId,m)}w()}else w()}else w()},w=function(){m({isDragging:!1,personId:null,taskId:null,dragType:null,startX:0,startLeft:0,startWidth:0,task:null}),document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",b)};return r((function(){return function(){document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",b)}}),[]),e.createElement("div",{ref:h,className:"absolute inset-0 pointer-events-none","data-testid":"task-editor"},l.map((function(t){return e.createElement("div",{key:t.id,className:"w-full h-full relative"},t.tasks.map((function(a){var r=document.querySelectorAll('[data-task-id="'.concat(a.id,'"]'));if(!r.length)return null;var n=r[0];if(!n)return null;if(n.getBoundingClientRect(),!h.current)return null;h.current.getBoundingClientRect();var o=n.style.left||"0%",l=n.style.width||"0%",i=n.style.top||"0px";return e.createElement("div",{key:a.id,className:"absolute pointer-events-auto cursor-move",style:{left:o,width:l,top:i,height:"32px"},onMouseDown:function(e){return y(e,t.id,a.id,"move")}},e.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize",onMouseDown:function(e){e.stopPropagation(),y(e,t.id,a.id,"resize-left")}}),e.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize",onMouseDown:function(e){e.stopPropagation(),y(e,t.id,a.id,"resize-right")}}))})))})))};function f(e,t){return new Date(e,t+1,0).getDate()}export{o as DEFAULT_THEME,g as GanttChart,m as TaskEditor,s as calculateTaskPosition,c as detectTaskOverlaps,d as findEarliestDate,u as findLatestDate,l as formatMonth,i as getMonthsBetween};
//# sourceMappingURL=index.esm.js.map
