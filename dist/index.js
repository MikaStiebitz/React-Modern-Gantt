"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=t(e),r=function(){return r=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},r.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var n={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function o(e,t){for(var a=[],r=e.getFullYear(),n=e.getMonth(),o=t.getFullYear(),l=t.getMonth(),s=r;s<=o;s++)for(var d=s===o?l:11,i=s===r?n:0;i<=d;i++)a.push(new Date(s,i,1));return a}function l(e,t,a){var r=o(new Date(t.getFullYear(),t.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)),n=r.length,l=e.startDate.getFullYear(),s=e.startDate.getMonth(),d=r.findIndex((function(e){return e.getFullYear()===l&&e.getMonth()===s})),i=d<0?0:d,u=e.endDate.getFullYear(),c=e.endDate.getMonth(),f=r.findIndex((function(e){return e.getFullYear()===u&&e.getMonth()===c})),g=((f<0?r.length-1:f)-i+1)/n*100;return{left:"".concat(i/n*100,"%"),width:"".concat(g,"%")}}function s(e){var t=function(e,t,a){if(a||2===arguments.length)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}([],e,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),a=[];return t.forEach((function(e){for(var t=!1,r=0;r<a.length;r++){var n=a[r][a[r].length-1];if(e.startDate>=n.endDate){a[r].push(e),t=!0;break}}t||a.push([e])})),a}function d(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function i(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}function u(e,t){return new Date(e,t+1,0).getDate()}exports.DEFAULT_THEME=n,exports.GanttChart=function(t){var r=t.people,u=t.startDate,c=t.endDate,f=t.title,g=void 0===f?"Project Timeline":f,m=t.currentDate,h=void 0===m?new Date:m,p=t.showCurrentDateMarker,v=void 0===p||p,y=t.editMode,x=void 0===y||y,k=t.theme,b=void 0===k?n:k;t.onTaskUpdate;var w=t.onTaskClick,D=e.useState(null),E=D[0],M=D[1],N=e.useState({x:0,y:0}),T=N[0],F=N[1],I=u||d(r),L=c||i(r),Y=o(I,L),S=h.getMonth(),C=h.getFullYear(),z=Y.findIndex((function(e){return e.getMonth()===S&&e.getFullYear()===C})),B=function(){M(null)};b.headerBackground,b.headerText,b.borderColor;var P=b.backgroundHighlight||"bg-blue-50",W=b.todayMarkerColor||"bg-red-500";return a.default.createElement("div",{className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart",onMouseMove:function(e){E&&F({x:e.clientX,y:e.clientY})}},a.default.createElement("div",{className:"p-6 border-b border-gray-200"},a.default.createElement("h1",{className:"text-2xl font-bold text-gray-800"},g)),a.default.createElement("div",{className:"p-4"},a.default.createElement("div",{className:"flex border-b border-gray-200"},a.default.createElement("div",{className:"w-40 flex-shrink-0 p-2 font-semibold text-gray-700 border-r border-gray-200"},"Team Member"),a.default.createElement("div",{className:"flex-grow flex"},Y.map((function(e,t){return a.default.createElement("div",{key:t,className:"flex-1 p-2 font-semibold text-center ".concat(t===z?P:""),"data-month":e.toISOString()},e.toLocaleString("default",{month:"short",year:"2-digit"}))})))),r.map((function(e){var t=s(e.tasks),n=Math.max(60,30*t.length+15);return a.default.createElement("div",{key:e.id,className:"flex border-b border-gray-200 hover:bg-gray-50","data-testid":"person-row-".concat(e.id)},a.default.createElement("div",{className:"w-40 flex-shrink-0 p-2 border-r border-gray-200",style:{height:"".concat(n,"px")}},a.default.createElement("div",{className:"font-medium"},e.name),e.role&&a.default.createElement("div",{className:"text-xs text-gray-500"},e.role)),a.default.createElement("div",{className:"flex-grow relative",style:{height:"".concat(n,"px")}},t.map((function(t,r){return a.default.createElement(a.default.Fragment,{key:r},t.map((function(t){var n=l(t,I,L),o=n.left,s=n.width;return a.default.createElement("div",{key:t.id,className:"absolute h-8 rounded ".concat(t.color," flex items-center px-2 text-xs text-white font-medium ").concat(x?"cursor-move":"cursor-pointer"),style:{left:o,width:s,top:"".concat(30*r+15,"px")},onClick:function(a){return function(e,t,a){w&&w(t,a)}(0,t,e)},onMouseEnter:function(a){return function(e,t,a){M({task:t,person:a}),F({x:e.clientX,y:e.clientY})}(a,t,e)},onMouseLeave:B,"data-testid":"task-".concat(t.id),"data-task-id":t.id},a.default.createElement("div",{className:"truncate"},t.name),void 0!==t.percent&&a.default.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 rounded-full overflow-hidden"},a.default.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(t.percent,"%")}})))})))})),v&&z>=0&&n>0&&a.default.createElement("div",{className:"absolute top-0 bottom-0 w-px ".concat(W," z-10"),style:{left:"".concat((z+.5)/Y.length*100,"%")},"data-testid":"today-marker"},e===r[0]&&a.default.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(W," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},"Today"))))}))),E&&a.default.createElement("div",{className:"fixed z-50 bg-white shadow-lg rounded-md border border-gray-200 p-3 text-xs",style:{left:"".concat(T.x+10,"px"),top:"".concat(T.y-80,"px"),minWidth:"200px"}},a.default.createElement("div",{className:"font-bold mb-1 text-sm"},E.task.name),a.default.createElement("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1"},a.default.createElement("div",{className:"font-semibold"},"Start:"),a.default.createElement("div",null,E.task.startDate.toLocaleDateString()),a.default.createElement("div",{className:"font-semibold"},"End:"),a.default.createElement("div",null,E.task.endDate.toLocaleDateString()),void 0!==E.task.percent&&a.default.createElement(a.default.Fragment,null,a.default.createElement("div",{className:"font-semibold"},"Progress:"),a.default.createElement("div",null,E.task.percent,"%")))))},exports.TaskEditor=function(t){var n=t.people,l=t.startDate,s=t.endDate,d=t.onTaskUpdate,i=e.useState({isDragging:!1,personId:null,taskId:null,dragType:null,startX:0,startLeft:0,startWidth:0,task:null}),c=i[0],f=i[1],g=e.useRef(null),m=o(l,s),h=m.length,p=function(e,t,a,r){e.preventDefault(),e.stopPropagation();var o=document.querySelector('[data-task-id="'.concat(a,'"]'));if(o&&g.current){var l=n.find((function(e){return e.id===t}));if(l){var s=l.tasks.find((function(e){return e.id===a}));if(s){var d=g.current.getBoundingClientRect(),i=o.getBoundingClientRect(),u=(i.left-d.left)/d.width*100,c=i.width/d.width*100;f({isDragging:!0,personId:t,taskId:a,dragType:r,startX:e.clientX,startLeft:u,startWidth:c,task:s}),document.addEventListener("mousemove",v),document.addEventListener("mouseup",y),console.log("Started dragging:",{personId:t,taskId:a,dragType:r})}}}},v=function(e){if(c.isDragging&&g.current){var t=g.current.getBoundingClientRect(),a=(e.clientX-c.startX)/t.width*100,r=document.querySelector('[data-task-id="'.concat(c.taskId,'"]'));if(r)if("move"===c.dragType){var n=c.startLeft+a,o=Math.max(0,Math.min(100-c.startWidth,n));r.style.left="".concat(o,"%")}else if("resize-left"===c.dragType){var l=c.startWidth-5,s=Math.min(l,a),d=(n=c.startLeft+s,c.startWidth-s);n>=0&&d>=5&&(r.style.left="".concat(n,"%"),r.style.width="".concat(d,"%"))}else if("resize-right"===c.dragType){d=Math.max(5,c.startWidth+a);var i=100-c.startLeft,u=Math.min(i,d);r.style.width="".concat(u,"%")}}},y=function(){if(c.isDragging&&c.taskId&&c.personId&&c.task){var e=document.querySelector('[data-task-id="'.concat(c.taskId,'"]'));if(e&&g.current){var t=parseFloat(e.style.left),a=parseFloat(e.style.width),n=Math.floor(t/100*h),o=Math.ceil(a/100*h);if(n>=0&&n<m.length){var l=m[n],s=n+o-1;s>=m.length&&(s=m.length-1);var i=m[s],f=new Date(l.getFullYear(),l.getMonth(),Math.min(c.task.startDate.getDate(),u(l.getFullYear(),l.getMonth()))),p=new Date(i.getFullYear(),i.getMonth(),Math.min(c.task.endDate.getDate(),u(i.getFullYear(),i.getMonth()))),v=r(r({},c.task),{startDate:f,endDate:p});console.log("Updating task:",{personId:c.personId,taskId:c.taskId,from:{start:c.task.startDate,end:c.task.endDate},to:{start:f,end:p}}),d&&d(c.personId,v)}x()}else x()}else x()},x=function(){f({isDragging:!1,personId:null,taskId:null,dragType:null,startX:0,startLeft:0,startWidth:0,task:null}),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",y)};return e.useEffect((function(){return function(){document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",y)}}),[]),a.default.createElement("div",{ref:g,className:"absolute inset-0 pointer-events-none","data-testid":"task-editor"},n.map((function(e){return a.default.createElement("div",{key:e.id,className:"w-full h-full relative"},e.tasks.map((function(t){var r=document.querySelectorAll('[data-task-id="'.concat(t.id,'"]'));if(!r.length)return null;var n=r[0];if(!n)return null;if(n.getBoundingClientRect(),!g.current)return null;g.current.getBoundingClientRect();var o=n.style.left||"0%",l=n.style.width||"0%",s=n.style.top||"0px";return a.default.createElement("div",{key:t.id,className:"absolute pointer-events-auto cursor-move",style:{left:o,width:l,top:s,height:"32px"},onMouseDown:function(a){return p(a,e.id,t.id,"move")}},a.default.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize",onMouseDown:function(a){a.stopPropagation(),p(a,e.id,t.id,"resize-left")}}),a.default.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize",onMouseDown:function(a){a.stopPropagation(),p(a,e.id,t.id,"resize-right")}}))})))})))},exports.calculateTaskPosition=l,exports.detectTaskOverlaps=s,exports.findEarliestDate=d,exports.findLatestDate=i,exports.formatMonth=function(e){return e.toLocaleString("default",{month:"short"})},exports.getMonthsBetween=o;
//# sourceMappingURL=index.js.map
