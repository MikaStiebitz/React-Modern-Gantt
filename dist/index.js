"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,n=t(e),r=function(){return r=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)};function o(e,t,a){if(a||2===arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,exports.DateDisplayFormat=void 0,(a=exports.DateDisplayFormat||(exports.DateDisplayFormat={})).MONTH_YEAR="month-year",a.FULL_DATE="full-date",a.SHORT_DATE="short-date";var l={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function i(e,t){for(var a=[],n=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),l=t.getMonth(),i=n;i<=o;i++)for(var s=i===o?l:11,c=i===n?r:0;c<=s;c++)a.push(new Date(i,c,1));return a}function s(e,t,a){var n=i(new Date(t.getFullYear(),t.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)),r=n.length,o=e.startDate.getFullYear(),l=e.startDate.getMonth(),s=n.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===l})),c=s<0?0:s,u=e.endDate.getFullYear(),d=e.endDate.getMonth(),f=n.findIndex((function(e){return e.getFullYear()===u&&e.getMonth()===d})),m=((f<0?n.length-1:f)-c+1)/r*100;return{left:"".concat(c/r*100,"%"),width:"".concat(m,"%")}}function c(e){var t=o([],e,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),a=[];return t.forEach((function(e){for(var t=!1,n=0;n<a.length;n++){if(a[n].every((function(t){return e.startDate>=t.endDate||e.endDate<=t.startDate}))){a[n].push(e),t=!0;break}}t||a.push([e])})),a}function u(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function d(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}function f(e,t){return new Date(e,t+1,0).getDate()}exports.DEFAULT_THEME=l,exports.GanttChart=function(t){var a=t.people,o=t.startDate,m=t.endDate,g=t.title,h=void 0===g?"Project Timeline":g,p=t.currentDate,v=void 0===p?new Date:p,D=t.showCurrentDateMarker,w=void 0===D||D,x=t.editMode,y=void 0===x||x,b=t.theme,E=void 0===b?l:b,M=t.onTaskUpdate,k=t.onTaskClick,T=e.useState(null),N=T[0],S=T[1],F=e.useState({x:0,y:0}),L=F[0],Y=F[1],z=e.useState(null),C=z[0],P=z[1],R=e.useState(null),O=R[0],A=R[1],X=e.useState(0),_=X[0],B=X[1],j=e.useRef(null),H=o||u(a),I=m||d(a),U=i(H,I),q=U.length,G=v.getMonth(),W=v.getFullYear(),J=U.findIndex((function(e){return e.getMonth()===G&&e.getFullYear()===W})),K=function(){C||S(null)},Q=function(e,t,a,n){y&&(e.preventDefault(),e.stopPropagation(),P({task:t,person:a}),A(n),B(e.clientX),document.addEventListener("mouseup",V))},V=function(){if(C&&O&&j.current){var e=document.querySelector('[data-task-id="'.concat(C.task.id,'"]'));if(e){var t=parseFloat(e.style.left),a=parseFloat(e.style.width),n=Math.floor(t/100*q),o=Math.ceil(a/100*q);if(n>=0&&n<U.length){var l=U[n],i=n+o-1;i>=U.length&&(i=U.length-1);var s=U[i],c=new Date(l.getFullYear(),l.getMonth(),Math.min(C.task.startDate.getDate(),f(l.getFullYear(),l.getMonth()))),u=new Date(s.getFullYear(),s.getMonth(),Math.min(C.task.endDate.getDate(),f(s.getFullYear(),s.getMonth()))),d=r(r({},C.task),{startDate:c,endDate:u});M&&M(C.person.id,d)}}}P(null),A(null),document.removeEventListener("mouseup",V)};E.headerBackground,E.headerText,E.borderColor;var Z,$=E.backgroundHighlight||"bg-blue-50",ee=E.todayMarkerColor||"bg-red-500";return n.default.createElement("div",{ref:j,className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart",onMouseMove:function(e){if(N&&Y({x:e.clientX,y:e.clientY}),C&&O&&j.current){var t=j.current.getBoundingClientRect(),a=(e.clientX-_)/t.width*100,n=document.querySelector('[data-task-id="'.concat(C.task.id,'"]'));if(!n)return;var r=parseFloat(n.style.left),o=parseFloat(n.style.width);if(C.task.endDate.getTime(),C.task.startDate.getTime(),"move"===O){var l=Math.max(0,Math.min(100-o,r+a));n.style.left="".concat(l,"%")}else if("resize-left"===O){var i=o-5,s=Math.min(i,a),c=(l=Math.max(0,r+s),Math.max(5,o-s));n.style.left="".concat(l,"%"),n.style.width="".concat(c,"%")}else if("resize-right"===O){c=Math.max(5,Math.min(100-r,o+a));n.style.width="".concat(c,"%")}B(e.clientX)}}},n.default.createElement("div",{className:"p-6 border-b border-gray-200"},n.default.createElement("h1",{className:"text-2xl font-bold text-gray-800"},h)),n.default.createElement("div",{className:"p-4"},n.default.createElement("div",{className:"flex border-b border-gray-200"},n.default.createElement("div",{className:"w-40 flex-shrink-0 p-2 font-semibold text-gray-700 border-r border-gray-200"},"Team Member"),n.default.createElement("div",{className:"flex-grow flex"},U.map((function(e,t){return n.default.createElement("div",{key:t,className:"flex-1 p-2 font-semibold text-center ".concat(t===J?$:""),"data-month":e.toISOString()},e.toLocaleString("default",{month:"short",year:"2-digit"}))})))),n.default.createElement("div",{className:"relative"},w&&J>=0&&n.default.createElement("div",{className:"absolute top-0 w-px ".concat(ee," z-10"),style:{left:"".concat((J+.5)/U.length*100,"%"),height:"".concat((Z=0,a.forEach((function(e){var t=c(e.tasks);Z+=Math.max(60,30*t.length+15)})),Z),"px")},"data-testid":"today-marker"},n.default.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(ee," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},"Today")),a.map((function(e){var t=c(e.tasks),a=Math.max(60,30*t.length+15);return n.default.createElement("div",{key:e.id,className:"flex border-b border-gray-200 hover:bg-gray-50","data-testid":"person-row-".concat(e.id)},n.default.createElement("div",{className:"w-40 flex-shrink-0 p-2 border-r border-gray-200",style:{height:"".concat(a,"px")}},n.default.createElement("div",{className:"font-medium"},e.name),e.role&&n.default.createElement("div",{className:"text-xs text-gray-500"},e.role)),n.default.createElement("div",{className:"flex-grow relative",style:{height:"".concat(a,"px")}},t.map((function(t,a){return n.default.createElement(n.default.Fragment,{key:a},t.map((function(t){var r=s(t,H,I),o=r.left,l=r.width,i=(null==N?void 0:N.task.id)===t.id,c=(null==C?void 0:C.task.id)===t.id,u=(i||c)&&y;return n.default.createElement("div",{key:t.id,className:"absolute h-8 rounded ".concat(t.color," flex items-center px-2 text-xs text-white font-medium ").concat(y?"cursor-move":"cursor-pointer"),style:{left:o,width:l,top:"".concat(30*a+15,"px")},onClick:function(a){return function(e,t,a){k&&!C&&k(t,a)}(0,t,e)},onMouseDown:function(a){return Q(a,t,e,"move")},onMouseEnter:function(a){return function(e,t,a){C||(S({task:t,person:a}),Y({x:e.clientX,y:e.clientY}))}(a,t,e)},onMouseLeave:K,"data-testid":"task-".concat(t.id),"data-task-id":t.id},u&&n.default.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-l",onMouseDown:function(a){a.stopPropagation(),Q(a,t,e,"resize-left")}}),n.default.createElement("div",{className:"truncate"},t.name),void 0!==t.percent&&n.default.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1 bg-black bg-opacity-20 rounded-full overflow-hidden"},n.default.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(t.percent,"%")}})),u&&n.default.createElement("div",{className:"absolute right-0 top-0 bottom-0 w-2 bg-white bg-opacity-30 cursor-ew-resize rounded-r",onMouseDown:function(a){a.stopPropagation(),Q(a,t,e,"resize-right")}}))})))}))))})))),N&&!C&&n.default.createElement("div",{className:"fixed z-50 bg-white shadow-lg rounded-md border border-gray-200 p-3 text-xs",style:{left:"".concat(L.x+10,"px"),top:"".concat(L.y-80,"px"),minWidth:"200px"}},n.default.createElement("div",{className:"font-bold mb-1 text-sm"},N.task.name),n.default.createElement("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1"},n.default.createElement("div",{className:"font-semibold"},"Start:"),n.default.createElement("div",null,N.task.startDate.toLocaleDateString()),n.default.createElement("div",{className:"font-semibold"},"End:"),n.default.createElement("div",null,N.task.endDate.toLocaleDateString()),void 0!==N.task.percent&&n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"font-semibold"},"Progress:"),n.default.createElement("div",null,N.task.percent,"%")))))},exports.TaskRow=function(t){var a=t.person,l=t.startDate,i=t.endDate;t.totalDays;var s=t.onTaskUpdate,c=t.editMode,u=void 0===c||c,d=e.useState(null),f=d[0],m=d[1],g=e.useState(null),h=g[0],p=g[1],v=e.useState(0),D=v[0],w=v[1],x=e.useState(null),y=x[0],b=x[1],E=e.useState({x:0,y:0}),M=E[0],k=E[1],T=e.useRef(null),N=function(e){return e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},S=function(e,t,a){u&&(e.preventDefault(),e.stopPropagation(),m(t),p(a),w(e.clientX),Y(e),document.addEventListener("mouseup",L),document.addEventListener("mousemove",F),console.log("Mouse down on task ".concat(t.id," with type ").concat(a)))},F=function(e){var t,n;if(e instanceof MouseEvent&&"mousemove"===e.type){var o=e;y&&k({x:o.clientX-((null===(t=T.current)||void 0===t?void 0:t.getBoundingClientRect().left)||0)+20,y:o.clientY-((null===(n=T.current)||void 0===n?void 0:n.getBoundingClientRect().top)||0)})}else Y(e);if(f&&h&&T.current){var c=T.current.getBoundingClientRect(),u=(e.clientX-D)/c.width*(i.getTime()-l.getTime()),d=new Date(f.startDate),g=new Date(f.endDate),p=f.percent;if("move"===h)d=new Date(d.getTime()+u),g=new Date(g.getTime()+u);else if("resize-start"===h)d=new Date(d.getTime()+u);else if("resize-end"===h)g=new Date(g.getTime()+u);else if("adjust-progress"===h&&void 0!==f.percent){var v=document.querySelectorAll('[data-task-id="'.concat(f.id,'"]'));if(v.length>0){var x=v[0].getBoundingClientRect(),b=x.width,E=e.clientX-x.left;p=Math.max(0,Math.min(100,E/b*100))}}if(d<l&&(d=new Date(l),"move"===h)){var M=f.endDate.getTime()-f.startDate.getTime();g=new Date(d.getTime()+M)}if(g>i&&(g=new Date(i),"move"===h)){M=f.endDate.getTime()-f.startDate.getTime();d=new Date(g.getTime()-M)}g<d&&("resize-start"===h?d=new Date(g):g=new Date(d));var N=r(r({},f),{startDate:d,endDate:g,percent:p});m(N),s(a.id,N),w(e.clientX),console.log("Task updated during drag: Start=".concat(d.toISOString(),", End=").concat(g.toISOString()))}},L=function(){f&&h&&(s(a.id,f),console.log("Mouse up - Task updated: ".concat(f.id))),m(null),p(null),document.removeEventListener("mouseup",L),document.removeEventListener("mousemove",F)},Y=function(e){if(T.current){var t=T.current.getBoundingClientRect();k({x:e.clientX-t.left+20,y:e.clientY-t.top})}};e.useEffect((function(){return function(){document.removeEventListener("mouseup",L),document.removeEventListener("mousemove",F)}}),[]);var z,C,P,R=(z=a.tasks,C=o([],z,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),P=[],C.forEach((function(e){for(var t=!1,a=0;a<P.length;a++){for(var n=!0,r=0,o=P[a];r<o.length;r++){var l=o[r];if(!(e.endDate<=l.startDate||e.startDate>=l.endDate)){n=!1;break}}if(n){P[a].push(e),t=!0;break}}t||P.push([e])})),P),O=Math.max(60,40*R.length);return a&&a.tasks&&0!==a.tasks.length?n.default.createElement("div",{className:"relative select-none",style:{height:"".concat(O,"px")},onMouseMove:function(e){return F(e)},onMouseLeave:function(){return b(null)},ref:T},R.map((function(e,t){return e.map((function(e){var a,r,o,s=function(e){var t=e.startDate.getTime(),a=e.endDate.getTime(),n=l.getTime(),r=i.getTime()-n,o=Math.max(0,t-n)/r,s=Math.min(1,(a-n)/r)-o;return{left:"".concat(100*o,"%"),width:"".concat(100*s,"%")}}(e),c=s.left,d=s.width,m=y===e,g=f===e,h=(m||g)&&u;return n.default.createElement(n.default.Fragment,{key:e.id},n.default.createElement("div",{className:"absolute h-8 rounded-md ".concat(e.color," z-10 flex items-center justify-between text-xs text-white font-semibold ").concat(u?"cursor-move":"cursor-default"," task-bar select-none"),"data-task-id":e.id,style:{left:c,width:d,top:"".concat(40*t+4,"px")},onMouseDown:u?function(t){return function(e,t){u&&(e.preventDefault(),e.stopPropagation(),console.log("Direct task div mousedown on ".concat(t.id)),S(e,t,"move"))}(t,e)}:void 0,onMouseEnter:function(){return b(e)}},n.default.createElement("div",{className:"truncate px-2 py-1 flex-grow"},e.name),h&&n.default.createElement("div",{className:"absolute left-0 w-1.5 h-[90%] bg-white rounded-md cursor-ew-resize",onMouseDown:function(t){t.stopPropagation(),S(t,e,"resize-start")}}),h&&n.default.createElement("div",{className:"absolute right-0 w-1.5 h-[90%] bg-white rounded-md cursor-ew-resize",onMouseDown:function(t){t.stopPropagation(),S(t,e,"resize-end")}}),void 0!==e.percent&&n.default.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1.5 bg-black bg-opacity-20 rounded-full overflow-hidden"},n.default.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(e.percent,"%")}}),h&&n.default.createElement("div",{className:"absolute top-1/2 h-3 w-3 bg-white rounded-full -translate-y-1/2 cursor-ew-resize border border-gray-400",style:{left:"calc(".concat(e.percent,"% - 4px)")},onMouseDown:function(t){t.stopPropagation(),S(t,e,"adjust-progress")}}))),(m||g)&&n.default.createElement("div",{className:"absolute z-20 bg-white border border-gray-200 rounded-md shadow-md p-2 text-xs select-none",style:{left:"".concat(M.x,"px"),top:"".concat(M.y-40,"px")}},n.default.createElement("div",{className:"font-bold"},e.name),n.default.createElement("div",null,"Start: ",N(e.startDate)),n.default.createElement("div",null,"End: ",N(e.endDate)),n.default.createElement("div",null,"Duration: ",(a=e.startDate,r=e.endDate,o=Math.abs(r.getTime()-a.getTime()),Math.ceil(o/864e5))," days"),void 0!==e.percent&&n.default.createElement("div",null,"Progress: ",Math.round(e.percent),"%")))}))}))):n.default.createElement("div",{className:"relative h-16"},"No tasks available")},exports.calculateTaskPosition=s,exports.detectTaskOverlaps=c,exports.findEarliestDate=u,exports.findLatestDate=d,exports.formatDate=function(e,t){switch(void 0===t&&(t=exports.DateDisplayFormat.FULL_DATE),t){case exports.DateDisplayFormat.MONTH_YEAR:return e.toLocaleString("default",{month:"short",year:"2-digit"});case exports.DateDisplayFormat.SHORT_DATE:return e.toLocaleString("default",{month:"short",day:"numeric"});case exports.DateDisplayFormat.FULL_DATE:default:return e.toLocaleString("default",{month:"short",day:"numeric",year:"numeric"})}},exports.formatMonth=function(e){return e.toLocaleString("default",{month:"short"})},exports.getDaysInMonth=function(e,t){return new Date(e,t+1,0).getDate()},exports.getMonthsBetween=i,exports.getStandardDayMarkers=function(){return[1,8,15,22,29]};
//# sourceMappingURL=index.js.map
