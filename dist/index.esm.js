import e,{useState as t,useRef as n,useEffect as a}from"react";var r,o=function(){return o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};function i(e,t,n){if(n||2===arguments.length)for(var a,r=0,o=t.length;r<o;r++)!a&&r in t||(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}function l(r){var l=r.person,c=r.startDate,s=r.endDate;r.totalDays;var d=r.onTaskUpdate,u=r.editMode,m=void 0===u||u,g=t(null),f=g[0],h=g[1],v=t(null),p=v[0],D=v[1],w=t(0),b=w[0],y=w[1],E=t(null),x=E[0],T=E[1],M=t({x:0,y:0}),k=M[0],N=M[1],S=n(null),L=function(e){return e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},F=function(e,t,n){m&&(e.preventDefault(),e.stopPropagation(),h(t),D(n),y(e.clientX),O(e),document.addEventListener("mouseup",C),document.addEventListener("mousemove",Y),console.log("Mouse down on task ".concat(t.id," with type ").concat(n)))},Y=function(e){var t,n;if(e instanceof MouseEvent&&"mousemove"===e.type){var a=e;x&&N({x:a.clientX-((null===(t=S.current)||void 0===t?void 0:t.getBoundingClientRect().left)||0)+20,y:a.clientY-((null===(n=S.current)||void 0===n?void 0:n.getBoundingClientRect().top)||0)})}else O(e);if(f&&p&&S.current){var r=S.current.getBoundingClientRect(),i=(e.clientX-b)/r.width*(s.getTime()-c.getTime()),u=new Date(f.startDate),m=new Date(f.endDate),g=f.percent;if("move"===p)u=new Date(u.getTime()+i),m=new Date(m.getTime()+i);else if("resize-start"===p)u=new Date(u.getTime()+i);else if("resize-end"===p)m=new Date(m.getTime()+i);else if("adjust-progress"===p&&void 0!==f.percent){var v=document.querySelectorAll('[data-task-id="'.concat(f.id,'"]'));if(v.length>0){var D=v[0].getBoundingClientRect(),w=D.width,E=e.clientX-D.left;g=Math.max(0,Math.min(100,E/w*100))}}if(u<c&&(u=new Date(c),"move"===p)){var T=f.endDate.getTime()-f.startDate.getTime();m=new Date(u.getTime()+T)}if(m>s&&(m=new Date(s),"move"===p)){T=f.endDate.getTime()-f.startDate.getTime();u=new Date(m.getTime()-T)}m<u&&("resize-start"===p?u=new Date(m):m=new Date(u));var M=o(o({},f),{startDate:u,endDate:m,percent:g});h(M),d(l.id,M),y(e.clientX),console.log("Task updated during drag: Start=".concat(u.toISOString(),", End=").concat(m.toISOString()))}},C=function(){f&&p&&(d(l.id,f),console.log("Mouse up - Task updated: ".concat(f.id))),h(null),D(null),document.removeEventListener("mouseup",C),document.removeEventListener("mousemove",Y)},O=function(e){if(S.current){var t=S.current.getBoundingClientRect();N({x:e.clientX-t.left+20,y:e.clientY-t.top})}};a((function(){return function(){document.removeEventListener("mouseup",C),document.removeEventListener("mousemove",Y)}}),[]);var z,A,R,I=(z=l.tasks,A=i([],z,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),R=[],A.forEach((function(e){for(var t=!1,n=0;n<R.length;n++){for(var a=!0,r=0,o=R[n];r<o.length;r++){var i=o[r];if(!(e.endDate<=i.startDate||e.startDate>=i.endDate)){a=!1;break}}if(a){R[n].push(e),t=!0;break}}t||R.push([e])})),R),P=Math.max(60,40*I.length);return l&&l.tasks&&0!==l.tasks.length?e.createElement("div",{className:"relative select-none",style:{height:"".concat(P,"px")},onMouseMove:function(e){return Y(e)},onMouseLeave:function(){return T(null)},ref:S},I.map((function(t,n){return t.map((function(t){var a,r,o,i=function(e){var t=e.startDate.getTime(),n=e.endDate.getTime(),a=c.getTime(),r=s.getTime()-a,o=Math.max(0,t-a)/r,i=Math.min(1,(n-a)/r)-o;return{left:"".concat(100*o,"%"),width:"".concat(100*i,"%")}}(t),l=i.left,d=i.width,u=x===t,g=f===t,h=(u||g)&&m;return e.createElement(e.Fragment,{key:t.id},e.createElement("div",{className:"absolute h-8 rounded-md ".concat(t.color," z-10 flex items-center justify-between text-xs text-white font-semibold ").concat(m?"cursor-move":"cursor-default"," task-bar select-none"),"data-task-id":t.id,style:{left:l,width:d,top:"".concat(40*n+4,"px")},onMouseDown:m?function(e){return function(e,t){m&&(e.preventDefault(),e.stopPropagation(),console.log("Direct task div mousedown on ".concat(t.id)),F(e,t,"move"))}(e,t)}:void 0,onMouseEnter:function(){return T(t)}},e.createElement("div",{className:"truncate px-2 py-1 flex-grow"},t.name),h&&e.createElement("div",{className:"absolute left-0 w-1.5 h-[90%] bg-white rounded-md cursor-ew-resize",onMouseDown:function(e){e.stopPropagation(),F(e,t,"resize-start")}}),h&&e.createElement("div",{className:"absolute right-0 w-1.5 h-[90%] bg-white rounded-md cursor-ew-resize",onMouseDown:function(e){e.stopPropagation(),F(e,t,"resize-end")}}),void 0!==t.percent&&e.createElement("div",{className:"absolute bottom-1 left-1 right-1 h-1.5 bg-black bg-opacity-20 rounded-full overflow-hidden"},e.createElement("div",{className:"h-full bg-white rounded-full",style:{width:"".concat(t.percent,"%")}}),h&&e.createElement("div",{className:"absolute top-1/2 h-3 w-3 bg-white rounded-full -translate-y-1/2 cursor-ew-resize border border-gray-400",style:{left:"calc(".concat(t.percent,"% - 4px)")},onMouseDown:function(e){e.stopPropagation(),F(e,t,"adjust-progress")}}))),(u||g)&&e.createElement("div",{className:"absolute z-20 bg-white border border-gray-200 rounded-md shadow-md p-2 text-xs select-none",style:{left:"".concat(k.x,"px"),top:"".concat(k.y-40,"px")}},e.createElement("div",{className:"font-bold"},t.name),e.createElement("div",null,"Start: ",L(t.startDate)),e.createElement("div",null,"End: ",L(t.endDate)),e.createElement("div",null,"Duration: ",(a=t.startDate,r=t.endDate,o=Math.abs(r.getTime()-a.getTime()),Math.ceil(o/864e5))," days"),void 0!==t.percent&&e.createElement("div",null,"Progress: ",Math.round(t.percent),"%")))}))}))):e.createElement("div",{className:"relative h-16"},"No tasks available")}"function"==typeof SuppressedError&&SuppressedError,function(e){e.MONTH_YEAR="month-year",e.FULL_DATE="full-date",e.SHORT_DATE="short-date"}(r||(r={}));var c={headerBackground:"bg-white",headerText:"text-gray-700",backgroundHighlight:"bg-blue-50",borderColor:"border-gray-200",todayMarkerColor:"bg-red-500"};function s(e){return e.toLocaleString("default",{month:"short"})}function d(e,t){switch(void 0===t&&(t=r.FULL_DATE),t){case r.MONTH_YEAR:return e.toLocaleString("default",{month:"short",year:"2-digit"});case r.SHORT_DATE:return e.toLocaleString("default",{month:"short",day:"numeric"});case r.FULL_DATE:default:return e.toLocaleString("default",{month:"short",day:"numeric",year:"numeric"})}}function u(e,t){for(var n=[],a=e.getFullYear(),r=e.getMonth(),o=t.getFullYear(),i=t.getMonth(),l=a;l<=o;l++)for(var c=l===o?i:11,s=l===a?r:0;s<=c;s++)n.push(new Date(l,s,1));return n}function m(e,t){return new Date(e,t+1,0).getDate()}function g(){return[1,8,15,22,29]}function f(e,t,n){var a=u(new Date(t.getFullYear(),t.getMonth(),1),new Date(n.getFullYear(),n.getMonth()+1,0)),r=a.length,o=e.startDate.getFullYear(),i=e.startDate.getMonth(),l=a.findIndex((function(e){return e.getFullYear()===o&&e.getMonth()===i})),c=l<0?0:l,s=e.endDate.getFullYear(),d=e.endDate.getMonth(),m=a.findIndex((function(e){return e.getFullYear()===s&&e.getMonth()===d})),g=((m<0?a.length-1:m)-c+1)/r*100;return{left:"".concat(c/r*100,"%"),width:"".concat(g,"%")}}function h(e){var t=i([],e,!0).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),n=[];return t.forEach((function(e){for(var t=!1,a=0;a<n.length;a++){if(n[a].every((function(t){return e.startDate>=t.endDate||e.endDate<=t.startDate}))){n[a].push(e),t=!0;break}}t||n.push([e])})),n}function v(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.startDate<t&&(t=new Date(e.startDate))}))})),new Date(t.getFullYear(),t.getMonth(),1)}function p(e){var t=new Date;return e.forEach((function(e){e.tasks.forEach((function(e){e.endDate>t&&(t=new Date(e.endDate))}))})),new Date(t.getFullYear(),t.getMonth()+1,0)}var D=function(t){var a=t.people,r=t.startDate,o=t.endDate,i=t.title,s=void 0===i?"Project Timeline":i,d=t.currentDate,m=void 0===d?new Date:d,g=t.showCurrentDateMarker,f=void 0===g||g,h=t.editMode,D=void 0===h||h,w=t.theme,b=void 0===w?c:w,y=t.onTaskUpdate;t.onTaskClick;var E=r||v(a),x=o||p(a),T=u(E,x);T.length;var M=Math.round((x.getTime()-E.getTime())/864e5),k=m.getMonth(),N=m.getFullYear(),S=T.findIndex((function(e){return e.getMonth()===k&&e.getFullYear()===N})),L=n(null),F=function(e,t){console.log("GanttChart received update for task ".concat(t.id," in person ").concat(e)),console.log("New dates: ".concat(t.startDate.toISOString()," - ").concat(t.endDate.toISOString())),y?y(e,t):console.warn("No onTaskUpdate handler provided to GanttChart")};b.headerBackground,b.headerText,b.borderColor;var Y=b.backgroundHighlight||"bg-blue-50",C=b.todayMarkerColor||"bg-red-500";return e.createElement("div",{ref:L,className:"w-full bg-white rounded-xl shadow-lg overflow-hidden","data-testid":"gantt-chart"},e.createElement("div",{className:"p-6 border-b border-gray-200"},e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},s)),e.createElement("div",{className:"p-4"},e.createElement("div",{className:"flex border-b border-gray-200"},e.createElement("div",{className:"w-40 flex-shrink-0 p-2 font-semibold text-gray-700 border-r border-gray-200"},"Team Member"),e.createElement("div",{className:"flex-grow flex"},T.map((function(t,n){return e.createElement("div",{key:n,className:"flex-1 p-2 font-semibold text-center ".concat(n===S?Y:""),"data-month":t.toISOString()},t.toLocaleString("default",{month:"short",year:"2-digit"}))})))),e.createElement("div",{className:"relative"},f&&S>=0&&e.createElement("div",{className:"absolute top-0 w-px ".concat(C," z-10"),style:{left:"".concat((S+.5)/T.length*100,"%"),height:"100%"},"data-testid":"today-marker"},e.createElement("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 ".concat(C," px-1 py-0.5 rounded text-xs text-white whitespace-nowrap")},"Today")),a.map((function(t){return e.createElement("div",{key:t.id,className:"flex border-b border-gray-200 hover:bg-gray-50","data-testid":"person-row-".concat(t.id)},e.createElement("div",{className:"w-40 flex-shrink-0 p-2 border-r border-gray-200"},e.createElement("div",{className:"font-medium"},t.name),t.role&&e.createElement("div",{className:"text-xs text-gray-500"},t.role)),e.createElement("div",{className:"flex-grow"},e.createElement(l,{person:t,startDate:E,endDate:x,totalDays:M,onTaskUpdate:F,editMode:D})))})))))};export{c as DEFAULT_THEME,r as DateDisplayFormat,D as GanttChart,l as TaskRow,f as calculateTaskPosition,h as detectTaskOverlaps,v as findEarliestDate,p as findLatestDate,d as formatDate,s as formatMonth,m as getDaysInMonth,u as getMonthsBetween,g as getStandardDayMarkers};
//# sourceMappingURL=index.esm.js.map
